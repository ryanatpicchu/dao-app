import{I as yi,a as qt,A as Uy,U as ky,L as Vy,c as B,N as A,e as Ze,h as Gi,_ as Ky,j as Nc,k as Hy,R as By,l as On,s as Gy,m as Wy,n as Yy,o as Jy,t as Fn,V as Oc,v as Qy,D as Zy,w as Xy,x as yu,Z as Fc,$ as em,y as tm,z as im,B as Wr,J as Mt,E as rm,G as sm,H as Ln,K as Un,M as kn,O,Q as mu,S as nt,T as nm,X as am,Y as di,a0 as ge,a1 as Re,a2 as Vn,a3 as Tt,a4 as $t,a5 as Et,a6 as $e,a7 as om,a8 as gi,a9 as wu,aa as Kn,ab as cm,ac as um,ad as hm,ae as _u,af as lm,ag as bu,ah as Eu,ai as fi,aj as Dn,ak as Iu,al as Hr,am as vi,an as Br,ao as pm,ap as dm,aq as gm,ar as fm,as as vm,at as _n,au as Dc,av as ym,aw as mm,ax as wm,ay as $c,az as _m,aA as bm,aB as Em,aC as Im,aD as Pm,aE as Sm,aF as Cm,aG as xm,aH as Am,aI as Tc,aJ as Rm,aK as Gr,aL as Pu,aM as bn,aN as Nm,aO as Om}from"./index.710421da.js";class Fm extends yi{constructor(r){super(),this.opts=r,this.protocol="wc",this.version=2}}class Dm extends yi{constructor(r,i){super(),this.core=r,this.logger=i,this.records=new Map}}class $m{constructor(r,i){this.logger=r,this.core=i}}class Tm extends yi{constructor(r,i){super(),this.relayer=r,this.logger=i}}class qm extends yi{constructor(r){super()}}class jm{constructor(r,i,n,a){this.core=r,this.logger=i,this.name=n}}class Mm extends yi{constructor(r,i){super(),this.relayer=r,this.logger=i}}class zm extends yi{constructor(r,i){super(),this.core=r,this.logger=i}}class Lm{constructor(r,i){this.projectId=r,this.logger=i}}class Um{constructor(r){this.opts=r,this.protocol="wc",this.version=2}}class km{constructor(r){this.client=r}}function Vm(p,r){if(p.length>=255)throw new TypeError("Alphabet too long");for(var i=new Uint8Array(256),n=0;n<i.length;n++)i[n]=255;for(var a=0;a<p.length;a++){var h=p.charAt(a),g=h.charCodeAt(0);if(i[g]!==255)throw new TypeError(h+" is ambiguous");i[g]=a}var m=p.length,b=p.charAt(0),S=Math.log(m)/Math.log(256),$=Math.log(256)/Math.log(m);function V(T){if(T instanceof Uint8Array||(ArrayBuffer.isView(T)?T=new Uint8Array(T.buffer,T.byteOffset,T.byteLength):Array.isArray(T)&&(T=Uint8Array.from(T))),!(T instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(T.length===0)return"";for(var te=0,re=0,se=0,Ie=T.length;se!==Ie&&T[se]===0;)se++,te++;for(var Q=(Ie-se)*$+1>>>0,G=new Uint8Array(Q);se!==Ie;){for(var ne=T[se],Pe=0,he=Q-1;(ne!==0||Pe<re)&&he!==-1;he--,Pe++)ne+=256*G[he]>>>0,G[he]=ne%m>>>0,ne=ne/m>>>0;if(ne!==0)throw new Error("Non-zero carry");re=Pe,se++}for(var Se=Q-re;Se!==Q&&G[Se]===0;)Se++;for(var It=b.repeat(te);Se<Q;++Se)It+=p.charAt(G[Se]);return It}function M(T){if(typeof T!="string")throw new TypeError("Expected String");if(T.length===0)return new Uint8Array;var te=0;if(T[te]!==" "){for(var re=0,se=0;T[te]===b;)re++,te++;for(var Ie=(T.length-te)*S+1>>>0,Q=new Uint8Array(Ie);T[te];){var G=i[T.charCodeAt(te)];if(G===255)return;for(var ne=0,Pe=Ie-1;(G!==0||ne<se)&&Pe!==-1;Pe--,ne++)G+=m*Q[Pe]>>>0,Q[Pe]=G%256>>>0,G=G/256>>>0;if(G!==0)throw new Error("Non-zero carry");se=ne,te++}if(T[te]!==" "){for(var he=Ie-se;he!==Ie&&Q[he]===0;)he++;for(var Se=new Uint8Array(re+(Ie-he)),It=re;he!==Ie;)Se[It++]=Q[he++];return Se}}}function Z(T){var te=M(T);if(te)return te;throw new Error(`Non-${r} character`)}return{encode:V,decodeUnsafe:M,decode:Z}}var Km=Vm,Hm=Km;const Su=p=>{if(p instanceof Uint8Array&&p.constructor.name==="Uint8Array")return p;if(p instanceof ArrayBuffer)return new Uint8Array(p);if(ArrayBuffer.isView(p))return new Uint8Array(p.buffer,p.byteOffset,p.byteLength);throw new Error("Unknown type, must be binary type")},Bm=p=>new TextEncoder().encode(p),Gm=p=>new TextDecoder().decode(p);class Wm{constructor(r,i,n){this.name=r,this.prefix=i,this.baseEncode=n}encode(r){if(r instanceof Uint8Array)return`${this.prefix}${this.baseEncode(r)}`;throw Error("Unknown type, must be binary type")}}class Ym{constructor(r,i,n){if(this.name=r,this.prefix=i,i.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i.codePointAt(0),this.baseDecode=n}decode(r){if(typeof r=="string"){if(r.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(r)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(r.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(r){return Cu(this,r)}}class Jm{constructor(r){this.decoders=r}or(r){return Cu(this,r)}decode(r){const i=r[0],n=this.decoders[i];if(n)return n.decode(r);throw RangeError(`Unable to decode multibase string ${JSON.stringify(r)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Cu=(p,r)=>new Jm({...p.decoders||{[p.prefix]:p},...r.decoders||{[r.prefix]:r}});class Qm{constructor(r,i,n,a){this.name=r,this.prefix=i,this.baseEncode=n,this.baseDecode=a,this.encoder=new Wm(r,i,n),this.decoder=new Ym(r,i,a)}encode(r){return this.encoder.encode(r)}decode(r){return this.decoder.decode(r)}}const Jr=({name:p,prefix:r,encode:i,decode:n})=>new Qm(p,r,i,n),Wi=({prefix:p,name:r,alphabet:i})=>{const{encode:n,decode:a}=Hm(i,r);return Jr({prefix:p,name:r,encode:n,decode:h=>Su(a(h))})},Zm=(p,r,i,n)=>{const a={};for(let $=0;$<r.length;++$)a[r[$]]=$;let h=p.length;for(;p[h-1]==="=";)--h;const g=new Uint8Array(h*i/8|0);let m=0,b=0,S=0;for(let $=0;$<h;++$){const V=a[p[$]];if(V===void 0)throw new SyntaxError(`Non-${n} character`);b=b<<i|V,m+=i,m>=8&&(m-=8,g[S++]=255&b>>m)}if(m>=i||255&b<<8-m)throw new SyntaxError("Unexpected end of data");return g},Xm=(p,r,i)=>{const n=r[r.length-1]==="=",a=(1<<i)-1;let h="",g=0,m=0;for(let b=0;b<p.length;++b)for(m=m<<8|p[b],g+=8;g>i;)g-=i,h+=r[a&m>>g];if(g&&(h+=r[a&m<<i-g]),n)for(;h.length*i&7;)h+="=";return h},_e=({name:p,prefix:r,bitsPerChar:i,alphabet:n})=>Jr({prefix:r,name:p,encode(a){return Xm(a,n,i)},decode(a){return Zm(a,n,i,p)}}),ew=Jr({prefix:"\0",name:"identity",encode:p=>Gm(p),decode:p=>Bm(p)});var tw=Object.freeze({__proto__:null,identity:ew});const iw=_e({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var rw=Object.freeze({__proto__:null,base2:iw});const sw=_e({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var nw=Object.freeze({__proto__:null,base8:sw});const aw=Wi({prefix:"9",name:"base10",alphabet:"0123456789"});var ow=Object.freeze({__proto__:null,base10:aw});const cw=_e({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uw=_e({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hw=Object.freeze({__proto__:null,base16:cw,base16upper:uw});const lw=_e({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),pw=_e({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dw=_e({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gw=_e({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),fw=_e({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),vw=_e({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),yw=_e({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),mw=_e({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),ww=_e({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var _w=Object.freeze({__proto__:null,base32:lw,base32upper:pw,base32pad:dw,base32padupper:gw,base32hex:fw,base32hexupper:vw,base32hexpad:yw,base32hexpadupper:mw,base32z:ww});const bw=Wi({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Ew=Wi({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Iw=Object.freeze({__proto__:null,base36:bw,base36upper:Ew});const Pw=Wi({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Sw=Wi({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Cw=Object.freeze({__proto__:null,base58btc:Pw,base58flickr:Sw});const xw=_e({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Aw=_e({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rw=_e({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Nw=_e({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ow=Object.freeze({__proto__:null,base64:xw,base64pad:Aw,base64url:Rw,base64urlpad:Nw});const xu=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Fw=xu.reduce((p,r,i)=>(p[i]=r,p),[]),Dw=xu.reduce((p,r,i)=>(p[r.codePointAt(0)]=i,p),[]);function $w(p){return p.reduce((r,i)=>(r+=Fw[i],r),"")}function Tw(p){const r=[];for(const i of p){const n=Dw[i.codePointAt(0)];if(n===void 0)throw new Error(`Non-base256emoji character: ${i}`);r.push(n)}return new Uint8Array(r)}const qw=Jr({prefix:"\u{1F680}",name:"base256emoji",encode:$w,decode:Tw});var jw=Object.freeze({__proto__:null,base256emoji:qw}),Mw=Au,qc=128,zw=127,Lw=~zw,Uw=Math.pow(2,31);function Au(p,r,i){r=r||[],i=i||0;for(var n=i;p>=Uw;)r[i++]=p&255|qc,p/=128;for(;p&Lw;)r[i++]=p&255|qc,p>>>=7;return r[i]=p|0,Au.bytes=i-n+1,r}var kw=$n,Vw=128,jc=127;function $n(p,n){var i=0,n=n||0,a=0,h=n,g,m=p.length;do{if(h>=m)throw $n.bytes=0,new RangeError("Could not decode varint");g=p[h++],i+=a<28?(g&jc)<<a:(g&jc)*Math.pow(2,a),a+=7}while(g>=Vw);return $n.bytes=h-n,i}var Kw=Math.pow(2,7),Hw=Math.pow(2,14),Bw=Math.pow(2,21),Gw=Math.pow(2,28),Ww=Math.pow(2,35),Yw=Math.pow(2,42),Jw=Math.pow(2,49),Qw=Math.pow(2,56),Zw=Math.pow(2,63),Xw=function(p){return p<Kw?1:p<Hw?2:p<Bw?3:p<Gw?4:p<Ww?5:p<Yw?6:p<Jw?7:p<Qw?8:p<Zw?9:10},e1={encode:Mw,decode:kw,encodingLength:Xw},Ru=e1;const Mc=(p,r,i=0)=>(Ru.encode(p,r,i),r),zc=p=>Ru.encodingLength(p),Tn=(p,r)=>{const i=r.byteLength,n=zc(p),a=n+zc(i),h=new Uint8Array(a+i);return Mc(p,h,0),Mc(i,h,n),h.set(r,a),new t1(p,i,r,h)};class t1{constructor(r,i,n,a){this.code=r,this.size=i,this.digest=n,this.bytes=a}}const Nu=({name:p,code:r,encode:i})=>new i1(p,r,i);class i1{constructor(r,i,n){this.name=r,this.code=i,this.encode=n}digest(r){if(r instanceof Uint8Array){const i=this.encode(r);return i instanceof Uint8Array?Tn(this.code,i):i.then(n=>Tn(this.code,n))}else throw Error("Unknown type, must be binary type")}}const Ou=p=>async r=>new Uint8Array(await crypto.subtle.digest(p,r)),r1=Nu({name:"sha2-256",code:18,encode:Ou("SHA-256")}),s1=Nu({name:"sha2-512",code:19,encode:Ou("SHA-512")});var n1=Object.freeze({__proto__:null,sha256:r1,sha512:s1});const Fu=0,a1="identity",Du=Su,o1=p=>Tn(Fu,Du(p)),c1={code:Fu,name:a1,encode:Du,digest:o1};var u1=Object.freeze({__proto__:null,identity:c1});new TextEncoder,new TextDecoder;const Lc={...tw,...rw,...nw,...ow,...hw,..._w,...Iw,...Cw,...Ow,...jw};({...n1,...u1});function $u(p){return globalThis.Buffer!=null?new Uint8Array(p.buffer,p.byteOffset,p.byteLength):p}function h1(p=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?$u(globalThis.Buffer.allocUnsafe(p)):new Uint8Array(p)}function Tu(p,r,i,n){return{name:p,prefix:r,encoder:{name:p,prefix:r,encode:i},decoder:{decode:n}}}const Uc=Tu("utf8","u",p=>"u"+new TextDecoder("utf8").decode(p),p=>new TextEncoder().encode(p.substring(1))),En=Tu("ascii","a",p=>{let r="a";for(let i=0;i<p.length;i++)r+=String.fromCharCode(p[i]);return r},p=>{p=p.substring(1);const r=h1(p.length);for(let i=0;i<p.length;i++)r[i]=p.charCodeAt(i);return r}),l1={utf8:Uc,"utf-8":Uc,hex:Lc.base16,latin1:En,ascii:En,binary:En,...Lc};function p1(p,r="utf8"){const i=l1[r];if(!i)throw new Error(`Unsupported encoding "${r}"`);return(r==="utf8"||r==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?$u(globalThis.Buffer.from(p,"utf-8")):i.decoder.decode(`${i.prefix}${p}`)}const qu="wc",d1=2,Hn="core",jt=`${qu}@2:${Hn}:`,g1={name:Hn,logger:"error"},f1={database:":memory:"},v1="crypto",kc="client_ed25519_seed",y1=O.ONE_DAY,m1="keychain",w1="0.3",_1="messages",b1="0.3",E1=O.SIX_HOURS,I1="publisher",ju="irn",P1="error",Mu="wss://relay.walletconnect.com",Vc="wss://relay.walletconnect.org",S1="relayer",ue={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},C1="_subscription",Li={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},x1=O.ONE_SECOND/2,A1="2.9.2",R1=1e4,N1="0.3",O1="WALLETCONNECT_CLIENT_ID",lt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},F1="subscription",D1="0.3",$1=O.FIVE_SECONDS*1e3,T1="pairing",q1="0.3",Ui={wc_pairingDelete:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:O.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:O.ONE_DAY,prompt:!1,tag:0},res:{ttl:O.ONE_DAY,prompt:!1,tag:0}}},ht={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},j1="history",M1="0.3",z1="expirer",Je={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},L1="0.3",In="verify-api",Kc="https://verify.walletconnect.com";class U1{constructor(r,i){this.core=r,this.logger=i,this.keychain=new Map,this.name=m1,this.version=w1,this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{if(!this.initialized){const n=await this.getKeyChain();typeof n<"u"&&(this.keychain=n),this.initialized=!0}},this.has=n=>(this.isInitialized(),this.keychain.has(n)),this.set=async(n,a)=>{this.isInitialized(),this.keychain.set(n,a),await this.persist()},this.get=n=>{this.isInitialized();const a=this.keychain.get(n);if(typeof a>"u"){const{message:h}=A("NO_MATCHING_KEY",`${this.name}: ${n}`);throw new Error(h)}return a},this.del=async n=>{this.isInitialized(),this.keychain.delete(n),await this.persist()},this.core=r,this.logger=B.generateChildLogger(i,this.name)}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setKeyChain(r){await this.core.storage.setItem(this.storageKey,bu(r))}async getKeyChain(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Eu(r):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class k1{constructor(r,i,n){this.core=r,this.logger=i,this.name=v1,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=a=>(this.isInitialized(),this.keychain.has(a)),this.getClientId=async()=>{this.isInitialized();const a=await this.getClientSeed(),h=Nc(a);return Hy(h.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const a=By();return this.setPrivateKey(a.publicKey,a.privateKey)},this.signJWT=async a=>{this.isInitialized();const h=await this.getClientSeed(),g=Nc(h),m=On();return await Gy(m,a,y1,g)},this.generateSharedKey=(a,h,g)=>{this.isInitialized();const m=this.getPrivateKey(a),b=Wy(m,h);return this.setSymKey(b,g)},this.setSymKey=async(a,h)=>{this.isInitialized();const g=h||Yy(a);return await this.keychain.set(g,a),g},this.deleteKeyPair=async a=>{this.isInitialized(),await this.keychain.del(a)},this.deleteSymKey=async a=>{this.isInitialized(),await this.keychain.del(a)},this.encode=async(a,h,g)=>{this.isInitialized();const m=Jy(g),b=Fn(h);if(Oc(m)){const M=m.senderPublicKey,Z=m.receiverPublicKey;a=await this.generateSharedKey(M,Z)}const S=this.getSymKey(a),{type:$,senderPublicKey:V}=m;return Qy({type:$,symKey:S,message:b,senderPublicKey:V})},this.decode=async(a,h,g)=>{this.isInitialized();const m=Zy(h,g);if(Oc(m)){const b=m.receiverPublicKey,S=m.senderPublicKey;a=await this.generateSharedKey(b,S)}try{const b=this.getSymKey(a),S=Xy({symKey:b,encoded:h});return yu(S)}catch(b){this.logger.error(`Failed to decode message from topic: '${a}', clientId: '${await this.getClientId()}'`),this.logger.error(b)}},this.getPayloadType=a=>{const h=Fc(a);return em(h.type)},this.getPayloadSenderPublicKey=a=>{const h=Fc(a);return h.senderPublicKey?tm(h.senderPublicKey,im):void 0},this.core=r,this.logger=B.generateChildLogger(i,this.name),this.keychain=n||new U1(this.core,this.logger)}get context(){return B.getLoggerContext(this.logger)}async setPrivateKey(r,i){return await this.keychain.set(r,i),r}getPrivateKey(r){return this.keychain.get(r)}async getClientSeed(){let r="";try{r=this.keychain.get(kc)}catch{r=On(),await this.keychain.set(kc,r)}return p1(r,"base16")}getSymKey(r){return this.keychain.get(r)}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class V1 extends $m{constructor(r,i){super(r,i),this.logger=r,this.core=i,this.messages=new Map,this.name=_1,this.version=b1,this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const n=await this.getRelayerMessages();typeof n<"u"&&(this.messages=n),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(n){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(n)}finally{this.initialized=!0}}},this.set=async(n,a)=>{this.isInitialized();const h=fi(a);let g=this.messages.get(n);return typeof g>"u"&&(g={}),typeof g[h]<"u"||(g[h]=a,this.messages.set(n,g),await this.persist()),h},this.get=n=>{this.isInitialized();let a=this.messages.get(n);return typeof a>"u"&&(a={}),a},this.has=(n,a)=>{this.isInitialized();const h=this.get(n),g=fi(a);return typeof h[g]<"u"},this.del=async n=>{this.isInitialized(),this.messages.delete(n),await this.persist()},this.logger=B.generateChildLogger(r,this.name),this.core=i}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}async setRelayerMessages(r){await this.core.storage.setItem(this.storageKey,bu(r))}async getRelayerMessages(){const r=await this.core.storage.getItem(this.storageKey);return typeof r<"u"?Eu(r):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class K1 extends Tm{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.events=new Ze.exports.EventEmitter,this.name=I1,this.queue=new Map,this.publishTimeout=O.toMiliseconds(O.TEN_SECONDS),this.queueTimeout=O.toMiliseconds(O.FIVE_SECONDS),this.needsTransportRestart=!1,this.publish=async(n,a,h)=>{this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}});try{const g=h?.ttl||E1,m=Dn(h),b=h?.prompt||!1,S=h?.tag||0,$=h?.id||Iu().toString(),V={topic:n,message:a,opts:{ttl:g,relay:m,prompt:b,tag:S,id:$}},M=setTimeout(()=>this.queue.set($,V),this.queueTimeout);try{await await Wr(this.rpcPublish(n,a,g,m,b,S,$),this.publishTimeout),clearTimeout(M),this.relayer.events.emit(ue.publish,V)}catch{this.logger.debug("Publishing Payload stalled"),this.needsTransportRestart=!0;return}this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:n,message:a,opts:h}})}catch(g){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(g),g}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.relayer=r,this.logger=B.generateChildLogger(i,this.name),this.registerEventListeners()}get context(){return B.getLoggerContext(this.logger)}rpcPublish(r,i,n,a,h,g,m){var b,S,$,V;const M={method:Hr(a.protocol).publish,params:{topic:r,message:i,ttl:n,prompt:h,tag:g},id:m};return qt((b=M.params)==null?void 0:b.prompt)&&((S=M.params)==null||delete S.prompt),qt(($=M.params)==null?void 0:$.tag)&&((V=M.params)==null||delete V.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:M}),this.relayer.request(M)}onPublish(r){this.queue.delete(r)}checkQueue(){this.queue.forEach(async r=>{const{topic:i,message:n,opts:a}=r;await this.publish(i,n,a)})}registerEventListeners(){this.relayer.core.heartbeat.on(Gi.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(ue.connection_stalled);return}this.checkQueue()}),this.relayer.on(ue.message_ack,r=>{this.onPublish(r.id.toString())})}}class H1{constructor(){this.map=new Map,this.set=(r,i)=>{const n=this.get(r);this.exists(r,i)||this.map.set(r,[...n,i])},this.get=r=>this.map.get(r)||[],this.exists=(r,i)=>this.get(r).includes(i),this.delete=(r,i)=>{if(typeof i>"u"){this.map.delete(r);return}if(!this.map.has(r))return;const n=this.get(r);if(!this.exists(r,i))return;const a=n.filter(h=>h!==i);if(!a.length){this.map.delete(r);return}this.map.set(r,a)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var B1=Object.defineProperty,G1=Object.defineProperties,W1=Object.getOwnPropertyDescriptors,Hc=Object.getOwnPropertySymbols,Y1=Object.prototype.hasOwnProperty,J1=Object.prototype.propertyIsEnumerable,Bc=(p,r,i)=>r in p?B1(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,ki=(p,r)=>{for(var i in r||(r={}))Y1.call(r,i)&&Bc(p,i,r[i]);if(Hc)for(var i of Hc(r))J1.call(r,i)&&Bc(p,i,r[i]);return p},Pn=(p,r)=>G1(p,W1(r));class Q1 extends Mm{constructor(r,i){super(r,i),this.relayer=r,this.logger=i,this.subscriptions=new Map,this.topicMap=new H1,this.events=new Ze.exports.EventEmitter,this.name=F1,this.version=D1,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=jt,this.subscribeTimeout=1e4,this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restart(),this.registerEventListeners(),this.onEnable(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}});try{const h=Dn(a),g={topic:n,relay:h};this.pending.set(n,g);const m=await this.rpcSubscribe(n,h);return this.onSubscribe(m,g),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:n,opts:a}}),m}catch(h){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(h),h}},this.unsubscribe=async(n,a)=>{await this.restartToComplete(),this.isInitialized(),typeof a?.id<"u"?await this.unsubscribeById(n,a.id,a):await this.unsubscribeByTopic(n,a)},this.isSubscribed=async n=>this.topics.includes(n)?!0:await new Promise((a,h)=>{const g=new O.Watch;g.start(this.pendingSubscriptionWatchLabel);const m=setInterval(()=>{!this.pending.has(n)&&this.topics.includes(n)&&(clearInterval(m),g.stop(this.pendingSubscriptionWatchLabel),a(!0)),g.elapsed(this.pendingSubscriptionWatchLabel)>=$1&&(clearInterval(m),g.stop(this.pendingSubscriptionWatchLabel),h(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=r,this.logger=B.generateChildLogger(i,this.name),this.clientId=""}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(r,i){let n=!1;try{n=this.getSubscription(r).topic===i}catch{}return n}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(r,i){const n=this.topicMap.get(r);await Promise.all(n.map(async a=>await this.unsubscribeById(r,a,i)))}async unsubscribeById(r,i,n){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}});try{const a=Dn(n);await this.rpcUnsubscribe(r,i,a);const h=Re("USER_DISCONNECTED",`${this.name}, ${r}`);await this.onUnsubscribe(r,i,h),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:r,id:i,opts:n}})}catch(a){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(a),a}}async rpcSubscribe(r,i){const n={method:Hr(i.protocol).subscribe,params:{topic:r}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{await await Wr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(ue.connection_stalled)}return fi(r+this.clientId)}async rpcBatchSubscribe(r){if(!r.length)return;const i=r[0].relay,n={method:Hr(i.protocol).batchSubscribe,params:{topics:r.map(a=>a.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n});try{return await await Wr(this.relayer.request(n),this.subscribeTimeout)}catch{this.logger.debug("Outgoing Relay Payload stalled"),this.relayer.events.emit(ue.connection_stalled)}}rpcUnsubscribe(r,i,n){const a={method:Hr(n.protocol).unsubscribe,params:{topic:r,id:i}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:a}),this.relayer.request(a)}onSubscribe(r,i){this.setSubscription(r,Pn(ki({},i),{id:r})),this.pending.delete(i.topic)}onBatchSubscribe(r){r.length&&r.forEach(i=>{this.setSubscription(i.id,ki({},i)),this.pending.delete(i.topic)})}async onUnsubscribe(r,i,n){this.events.removeAllListeners(i),this.hasSubscription(i,r)&&this.deleteSubscription(i,n),await this.relayer.messages.del(r)}async setRelayerSubscriptions(r){await this.relayer.core.storage.setItem(this.storageKey,r)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(r,i){this.subscriptions.has(r)||(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:r,subscription:i}),this.addSubscription(r,i))}addSubscription(r,i){this.subscriptions.set(r,ki({},i)),this.topicMap.set(i.topic,r),this.events.emit(lt.created,i)}getSubscription(r){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:r});const i=this.subscriptions.get(r);if(!i){const{message:n}=A("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}deleteSubscription(r,i){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:r,reason:i});const n=this.getSubscription(r);this.subscriptions.delete(r),this.topicMap.delete(n.topic,r),this.events.emit(lt.deleted,Pn(ki({},n),{reason:i}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(lt.sync)}async reset(){if(this.cached.length){const r=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let i=0;i<r;i++){const n=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(n)}}this.events.emit(lt.resubscribed)}async restore(){try{const r=await this.getRelayerSubscriptions();if(typeof r>"u"||!r.length)return;if(this.subscriptions.size){const{message:i}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(r){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(r)}}async batchSubscribe(r){if(!r.length)return;const i=await this.rpcBatchSubscribe(r);vi(i)&&this.onBatchSubscribe(i.map((n,a)=>Pn(ki({},r[a]),{id:n})))}async onConnect(){this.restartInProgress||(await this.restart(),this.onEnable())}onDisconnect(){this.onDisable()}async checkPending(){if(this.relayer.transportExplicitlyClosed)return;const r=[];this.pending.forEach(i=>{r.push(i)}),await this.batchSubscribe(r)}registerEventListeners(){this.relayer.core.heartbeat.on(Gi.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.relayer.on(ue.connect,async()=>{await this.onConnect()}),this.relayer.on(ue.disconnect,()=>{this.onDisconnect()}),this.events.on(lt.created,async r=>{const i=lt.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()}),this.events.on(lt.deleted,async r=>{const i=lt.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}async restartToComplete(){this.restartInProgress&&await new Promise(r=>{const i=setInterval(()=>{this.restartInProgress||(clearInterval(i),r())},this.pollingInterval)})}}var Z1=Object.defineProperty,Gc=Object.getOwnPropertySymbols,X1=Object.prototype.hasOwnProperty,e0=Object.prototype.propertyIsEnumerable,Wc=(p,r,i)=>r in p?Z1(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,t0=(p,r)=>{for(var i in r||(r={}))X1.call(r,i)&&Wc(p,i,r[i]);if(Gc)for(var i of Gc(r))e0.call(r,i)&&Wc(p,i,r[i]);return p};class i0 extends qm{constructor(r){super(r),this.protocol="wc",this.version=2,this.events=new Ze.exports.EventEmitter,this.name=S1,this.transportExplicitlyClosed=!1,this.initialized=!1,this.reconnecting=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled"],this.request=async i=>{this.logger.debug("Publishing Request Payload");try{return await this.toEstablishConnection(),await this.provider.request(i)}catch(n){throw this.logger.debug("Failed to Publish Request"),this.logger.error(n),n}},this.core=r.core,this.logger=typeof r.logger<"u"&&typeof r.logger!="string"?B.generateChildLogger(r.logger,this.name):B.pino(B.getDefaultLoggerOptions({level:r.logger||P1})),this.messages=new V1(this.logger,r.core),this.subscriber=new Q1(this,this.logger),this.publisher=new K1(this,this.logger),this.relayUrl=r?.relayUrl||Mu,this.projectId=r.projectId,this.provider={}}async init(){this.logger.trace("Initialized"),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${Vc}...`),await this.restartTransport(Vc)}this.registerEventListeners(),this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},R1)}get context(){return B.getLoggerContext(this.logger)}get connected(){return this.provider.connection.connected}get connecting(){return this.provider.connection.connecting}async publish(r,i,n){this.isInitialized(),await this.publisher.publish(r,i,n),await this.recordMessageEvent({topic:r,message:i,publishedAt:Date.now()})}async subscribe(r,i){var n;this.isInitialized();let a=((n=this.subscriber.topicMap.get(r))==null?void 0:n[0])||"";return a||(await Promise.all([new Promise(h=>{this.subscriber.once(lt.created,g=>{g.topic===r&&h()})}),new Promise(async h=>{a=await this.subscriber.subscribe(r,i),h()})]),a)}async unsubscribe(r,i){this.isInitialized(),await this.subscriber.unsubscribe(r,i)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async transportClose(){this.transportExplicitlyClosed=!0,this.connected&&(await this.provider.disconnect(),this.events.emit(ue.transport_closed))}async transportOpen(r){if(this.transportExplicitlyClosed=!1,!this.reconnecting){this.relayUrl=r||this.relayUrl,this.reconnecting=!0;try{await Promise.all([new Promise(i=>{this.initialized||i(),this.subscriber.once(lt.resubscribed,()=>{i()})}),await Promise.race([new Promise(async(i,n)=>{await Wr(this.provider.connect(),1e4,`Socket stalled when trying to connect to ${this.relayUrl}`).catch(a=>n(a)).then(()=>i()).finally(()=>this.removeListener(ue.transport_closed,this.rejectTransportOpen))}),new Promise(i=>this.once(ue.transport_closed,this.rejectTransportOpen))])])}catch(i){this.logger.error(i);const n=i;if(!this.isConnectionStalled(n.message))throw i;this.events.emit(ue.transport_closed)}finally{this.reconnecting=!1}}}async restartTransport(r){this.transportExplicitlyClosed||this.reconnecting||(this.relayUrl=r||this.relayUrl,this.connected&&await Promise.all([new Promise(i=>{this.provider.once(Li.disconnect,()=>{i()})}),this.transportClose()]),await this.createProvider(),await this.transportOpen())}isConnectionStalled(r){return this.staleConnectionErrors.some(i=>r.includes(i))}rejectTransportOpen(){throw new Error("Attempt to connect to relay via `transportOpen` has stalled. Retrying...")}async createProvider(){const r=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Mt(new rm(sm({sdkVersion:A1,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:r,useOnCloseEvent:!0}))),this.registerProviderListeners()}async recordMessageEvent(r){const{topic:i,message:n}=r;await this.messages.set(i,n)}async shouldIgnoreMessageEvent(r){const{topic:i,message:n}=r;if(!n||n.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${n}`),!0;if(!await this.subscriber.isSubscribed(i))return this.logger.debug(`Ignoring message for non-subscribed topic ${i}`),!0;const a=this.messages.has(i,n);return a&&this.logger.debug(`Ignoring duplicate message: ${n}`),a}async onProviderPayload(r){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:r}),Ln(r)){if(!r.method.endsWith(C1))return;const i=r.params,{topic:n,message:a,publishedAt:h}=i.data,g={topic:n,message:a,publishedAt:h};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(t0({type:"event",event:i.id},g)),this.events.emit(i.id,g),await this.acknowledgePayload(r),await this.onMessageEvent(g)}else Un(r)&&this.events.emit(ue.message_ack,r)}async onMessageEvent(r){await this.shouldIgnoreMessageEvent(r)||(this.events.emit(ue.message,r),await this.recordMessageEvent(r))}async acknowledgePayload(r){const i=kn(r.id,!0);await this.provider.connection.send(i)}registerProviderListeners(){this.provider.on(Li.payload,r=>this.onProviderPayload(r)),this.provider.on(Li.connect,()=>{this.events.emit(ue.connect)}),this.provider.on(Li.disconnect,()=>{this.onProviderDisconnect()}),this.provider.on(Li.error,r=>{this.logger.error(r),this.events.emit(ue.error,r)})}registerEventListeners(){this.events.on(ue.connection_stalled,async()=>{await this.restartTransport()})}onProviderDisconnect(){this.events.emit(ue.disconnect),this.attemptToReconnect()}attemptToReconnect(){this.transportExplicitlyClosed||setTimeout(async()=>{await this.restartTransport()},O.toMiliseconds(x1))}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}async toEstablishConnection(){if(!this.connected){if(this.connecting)return await new Promise(r=>{const i=setInterval(()=>{this.connected&&(clearInterval(i),r())},this.connectionStatusPollingInterval)});await this.restartTransport()}}}var r0=Object.defineProperty,Yc=Object.getOwnPropertySymbols,s0=Object.prototype.hasOwnProperty,n0=Object.prototype.propertyIsEnumerable,Jc=(p,r,i)=>r in p?r0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Qc=(p,r)=>{for(var i in r||(r={}))s0.call(r,i)&&Jc(p,i,r[i]);if(Yc)for(var i of Yc(r))n0.call(r,i)&&Jc(p,i,r[i]);return p};class Qr extends jm{constructor(r,i,n,a=jt,h=void 0){super(r,i,n,a),this.core=r,this.logger=i,this.name=n,this.map=new Map,this.version=N1,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(g=>{this.getKey&&g!==null&&!qt(g)?this.map.set(this.getKey(g),g):Uy(g)?this.map.set(g.id,g):ky(g)&&this.map.set(g.topic,g)}),this.cached=[],this.initialized=!0)},this.set=async(g,m)=>{this.isInitialized(),this.map.has(g)?await this.update(g,m):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:g,value:m}),this.map.set(g,m),await this.persist())},this.get=g=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:g}),this.getData(g)),this.getAll=g=>(this.isInitialized(),g?this.values.filter(m=>Object.keys(g).every(b=>Vy(m[b],g[b]))):this.values),this.update=async(g,m)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:g,update:m});const b=Qc(Qc({},this.getData(g)),m);this.map.set(g,b),await this.persist()},this.delete=async(g,m)=>{this.isInitialized(),this.map.has(g)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:g,reason:m}),this.map.delete(g),await this.persist())},this.logger=B.generateChildLogger(i,this.name),this.storagePrefix=a,this.getKey=h}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}async setDataStore(r){await this.core.storage.setItem(this.storageKey,r)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(r){const i=this.map.get(r);if(!i){const{message:n}=A("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}async persist(){await this.setDataStore(this.values)}async restore(){try{const r=await this.getDataStore();if(typeof r>"u"||!r.length)return;if(this.map.size){const{message:i}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(r){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(r)}}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class a0{constructor(r,i){this.core=r,this.logger=i,this.name=T1,this.version=q1,this.events=new Ze.exports,this.initialized=!1,this.storagePrefix=jt,this.ignoredPayloadTypes=[mu],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:n})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...n])]},this.create=async()=>{this.isInitialized();const n=On(),a=await this.core.crypto.setSymKey(n),h=nt(O.FIVE_MINUTES),g={protocol:ju},m={topic:a,expiry:h,relay:g,active:!1},b=nm({protocol:this.core.protocol,version:this.core.version,topic:a,symKey:n,relay:g});return await this.pairings.set(a,m),await this.core.relayer.subscribe(a),this.core.expirer.set(a,h),{topic:a,uri:b}},this.pair=async n=>{this.isInitialized(),this.isValidPair(n);const{topic:a,symKey:h,relay:g}=am(n.uri);if(this.pairings.keys.includes(a))throw new Error(`Pairing already exists: ${a}`);if(this.core.crypto.hasKeys(a))throw new Error(`Keychain already exists: ${a}`);const m=nt(O.FIVE_MINUTES),b={topic:a,relay:g,expiry:m,active:!1};return await this.pairings.set(a,b),await this.core.crypto.setSymKey(h,a),await this.core.relayer.subscribe(a,{relay:g}),this.core.expirer.set(a,m),n.activatePairing&&await this.activate({topic:a}),b},this.activate=async({topic:n})=>{this.isInitialized();const a=nt(O.THIRTY_DAYS);await this.pairings.update(n,{active:!0,expiry:a}),this.core.expirer.set(n,a)},this.ping=async n=>{this.isInitialized(),await this.isValidPing(n);const{topic:a}=n;if(this.pairings.keys.includes(a)){const h=await this.sendRequest(a,"wc_pairingPing",{}),{done:g,resolve:m,reject:b}=di();this.events.once(ge("pairing_ping",h),({error:S})=>{S?b(S):m()}),await g()}},this.updateExpiry=async({topic:n,expiry:a})=>{this.isInitialized(),await this.pairings.update(n,{expiry:a})},this.updateMetadata=async({topic:n,metadata:a})=>{this.isInitialized(),await this.pairings.update(n,{peerMetadata:a})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async n=>{this.isInitialized(),await this.isValidDisconnect(n);const{topic:a}=n;this.pairings.keys.includes(a)&&(await this.sendRequest(a,"wc_pairingDelete",Re("USER_DISCONNECTED")),await this.deletePairing(a))},this.sendRequest=async(n,a,h)=>{const g=Kn(a,h),m=await this.core.crypto.encode(n,g),b=Ui[a].req;return this.core.history.set(n,g),this.core.relayer.publish(n,m,b),g.id},this.sendResult=async(n,a,h)=>{const g=kn(n,h),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,n),S=Ui[b.request.method].res;await this.core.relayer.publish(a,m,S),await this.core.history.resolve(g)},this.sendError=async(n,a,h)=>{const g=Vn(n,h),m=await this.core.crypto.encode(a,g),b=await this.core.history.get(a,n),S=Ui[b.request.method]?Ui[b.request.method].res:Ui.unregistered_method.res;await this.core.relayer.publish(a,m,S),await this.core.history.resolve(g)},this.deletePairing=async(n,a)=>{await this.core.relayer.unsubscribe(n),await Promise.all([this.pairings.delete(n,Re("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(n),a?Promise.resolve():this.core.expirer.del(n)])},this.cleanup=async()=>{const n=this.pairings.getAll().filter(a=>Tt(a.expiry));await Promise.all(n.map(a=>this.deletePairing(a.topic)))},this.onRelayEventRequest=n=>{const{topic:a,payload:h}=n;switch(h.method){case"wc_pairingPing":return this.onPairingPingRequest(a,h);case"wc_pairingDelete":return this.onPairingDeleteRequest(a,h);default:return this.onUnknownRpcMethodRequest(a,h)}},this.onRelayEventResponse=async n=>{const{topic:a,payload:h}=n,g=(await this.core.history.get(a,h.id)).request.method;switch(g){case"wc_pairingPing":return this.onPairingPingResponse(a,h);default:return this.onUnknownRpcMethodResponse(g)}},this.onPairingPingRequest=async(n,a)=>{const{id:h}=a;try{this.isValidPing({topic:n}),await this.sendResult(h,n,!0),this.events.emit("pairing_ping",{id:h,topic:n})}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onPairingPingResponse=(n,a)=>{const{id:h}=a;setTimeout(()=>{$t(a)?this.events.emit(ge("pairing_ping",h),{}):Et(a)&&this.events.emit(ge("pairing_ping",h),{error:a.error})},500)},this.onPairingDeleteRequest=async(n,a)=>{const{id:h}=a;try{this.isValidDisconnect({topic:n}),await this.deletePairing(n),this.events.emit("pairing_delete",{id:h,topic:n})}catch(g){await this.sendError(h,n,g),this.logger.error(g)}},this.onUnknownRpcMethodRequest=async(n,a)=>{const{id:h,method:g}=a;try{if(this.registeredMethods.includes(g))return;const m=Re("WC_METHOD_UNSUPPORTED",g);await this.sendError(h,n,m),this.logger.error(m)}catch(m){await this.sendError(h,n,m),this.logger.error(m)}},this.onUnknownRpcMethodResponse=n=>{this.registeredMethods.includes(n)||this.logger.error(Re("WC_METHOD_UNSUPPORTED",n))},this.isValidPair=n=>{if(!$e(n)){const{message:a}=A("MISSING_OR_INVALID",`pair() params: ${n}`);throw new Error(a)}if(!om(n.uri)){const{message:a}=A("MISSING_OR_INVALID",`pair() uri: ${n.uri}`);throw new Error(a)}},this.isValidPing=async n=>{if(!$e(n)){const{message:h}=A("MISSING_OR_INVALID",`ping() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidDisconnect=async n=>{if(!$e(n)){const{message:h}=A("MISSING_OR_INVALID",`disconnect() params: ${n}`);throw new Error(h)}const{topic:a}=n;await this.isValidPairingTopic(a)},this.isValidPairingTopic=async n=>{if(!gi(n,!1)){const{message:a}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${n}`);throw new Error(a)}if(!this.pairings.keys.includes(n)){const{message:a}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${n}`);throw new Error(a)}if(Tt(this.pairings.get(n).expiry)){await this.deletePairing(n);const{message:a}=A("EXPIRED",`pairing topic: ${n}`);throw new Error(a)}},this.core=r,this.logger=B.generateChildLogger(i,this.name),this.pairings=new Qr(this.core,this.logger,this.name,this.storagePrefix)}get context(){return B.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.core.relayer.on(ue.message,async r=>{const{topic:i,message:n}=r;if(!this.pairings.keys.includes(i)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(n)))return;const a=await this.core.crypto.decode(i,n);try{Ln(a)?(this.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):Un(a)&&(await this.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.core.history.delete(i,a.id))}catch(h){this.logger.error(h)}})}registerExpirerEvents(){this.core.expirer.on(Je.expired,async r=>{const{topic:i}=wu(r.target);i&&this.pairings.keys.includes(i)&&(await this.deletePairing(i,!0),this.events.emit("pairing_expire",{topic:i}))})}}class o0 extends Dm{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.records=new Map,this.events=new Ze.exports.EventEmitter,this.name=j1,this.version=M1,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.records.set(n.id,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(n,a,h)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:n,request:a,chainId:h}),this.records.has(a.id))return;const g={id:a.id,topic:n,request:{method:a.method,params:a.params||null},chainId:h,expiry:nt(O.THIRTY_DAYS)};this.records.set(g.id,g),this.events.emit(ht.created,g)},this.resolve=async n=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:n}),!this.records.has(n.id))return;const a=await this.getRecord(n.id);typeof a.response>"u"&&(a.response=Et(n)?{error:n.error}:{result:n.result},this.records.set(a.id,a),this.events.emit(ht.updated,a))},this.get=async(n,a)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:n,id:a}),await this.getRecord(a)),this.delete=(n,a)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:a}),this.values.forEach(h=>{if(h.topic===n){if(typeof a<"u"&&h.id!==a)return;this.records.delete(h.id),this.events.emit(ht.deleted,h)}})},this.exists=async(n,a)=>(this.isInitialized(),this.records.has(a)?(await this.getRecord(a)).topic===n:!1),this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=B.generateChildLogger(i,this.name)}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const r=[];return this.values.forEach(i=>{if(typeof i.response<"u")return;const n={topic:i.topic,request:Kn(i.request.method,i.request.params,i.id),chainId:i.chainId};return r.push(n)}),r}async setJsonRpcRecords(r){await this.core.storage.setItem(this.storageKey,r)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(r){this.isInitialized();const i=this.records.get(r);if(!i){const{message:n}=A("NO_MATCHING_KEY",`${this.name}: ${r}`);throw new Error(n)}return i}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(ht.sync)}async restore(){try{const r=await this.getJsonRpcRecords();if(typeof r>"u"||!r.length)return;if(this.records.size){const{message:i}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(r){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(r)}}registerEventListeners(){this.events.on(ht.created,r=>{const i=ht.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(ht.updated,r=>{const i=ht.updated;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.events.on(ht.deleted,r=>{const i=ht.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,record:r}),this.persist()}),this.core.heartbeat.on(Gi.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(r=>{O.toMiliseconds(r.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${r.id}`),this.delete(r.topic,r.id))})}catch(r){this.logger.warn(r)}}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class c0 extends zm{constructor(r,i){super(r,i),this.core=r,this.logger=i,this.expirations=new Map,this.events=new Ze.exports.EventEmitter,this.name=z1,this.version=L1,this.cached=[],this.initialized=!1,this.storagePrefix=jt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(n=>this.expirations.set(n.target,n)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=n=>{try{const a=this.formatTarget(n);return typeof this.getExpiration(a)<"u"}catch{return!1}},this.set=(n,a)=>{this.isInitialized();const h=this.formatTarget(n),g={target:h,expiry:a};this.expirations.set(h,g),this.checkExpiry(h,g),this.events.emit(Je.created,{target:h,expiration:g})},this.get=n=>{this.isInitialized();const a=this.formatTarget(n);return this.getExpiration(a)},this.del=n=>{if(this.isInitialized(),this.has(n)){const a=this.formatTarget(n),h=this.getExpiration(a);this.expirations.delete(a),this.events.emit(Je.deleted,{target:a,expiration:h})}},this.on=(n,a)=>{this.events.on(n,a)},this.once=(n,a)=>{this.events.once(n,a)},this.off=(n,a)=>{this.events.off(n,a)},this.removeListener=(n,a)=>{this.events.removeListener(n,a)},this.logger=B.generateChildLogger(i,this.name)}get context(){return B.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(r){if(typeof r=="string")return cm(r);if(typeof r=="number")return um(r);const{message:i}=A("UNKNOWN_TYPE",`Target type: ${typeof r}`);throw new Error(i)}async setExpirations(r){await this.core.storage.setItem(this.storageKey,r)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Je.sync)}async restore(){try{const r=await this.getExpirations();if(typeof r>"u"||!r.length)return;if(this.expirations.size){const{message:i}=A("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(i),new Error(i)}this.cached=r,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(r){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(r)}}getExpiration(r){const i=this.expirations.get(r);if(!i){const{message:n}=A("NO_MATCHING_KEY",`${this.name}: ${r}`);throw this.logger.error(n),new Error(n)}return i}checkExpiry(r,i){const{expiry:n}=i;O.toMiliseconds(n)-Date.now()<=0&&this.expire(r,i)}expire(r,i){this.expirations.delete(r),this.events.emit(Je.expired,{target:r,expiration:i})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((r,i)=>this.checkExpiry(i,r))}registerEventListeners(){this.core.heartbeat.on(Gi.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Je.created,r=>{const i=Je.created;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Je.expired,r=>{const i=Je.expired;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()}),this.events.on(Je.deleted,r=>{const i=Je.deleted;this.logger.info(`Emitting ${i}`),this.logger.debug({type:"event",event:i,data:r}),this.persist()})}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}}class u0 extends Lm{constructor(r,i){super(r,i),this.projectId=r,this.logger=i,this.name=In,this.initialized=!1,this.init=async n=>{hm()||!_u()||(this.verifyUrl=n?.verifyUrl||Kc,await this.createIframe())},this.register=async n=>{var a;if(this.initialized||await this.init(),!!this.iframe)try{(a=this.iframe.contentWindow)==null||a.postMessage(n.attestationId,this.verifyUrl),this.logger.info(`postMessage sent: ${n.attestationId} ${this.verifyUrl}`)}catch{}},this.resolve=async n=>{var a;if(this.isDevEnv)return"";this.logger.info(`resolving attestation: ${n.attestationId}`);const h=this.startAbortTimer(O.FIVE_SECONDS),g=await fetch(`${this.verifyUrl}/attestation/${n.attestationId}`,{signal:this.abortController.signal});return clearTimeout(h),g.status===200?(a=await g.json())==null?void 0:a.origin:""},this.createIframe=async()=>{try{await Promise.race([new Promise((n,a)=>{if(document.getElementById(In))return n();const h=document.createElement("iframe");h.setAttribute("id",In),h.setAttribute("src",`${this.verifyUrl}/${this.projectId}`),h.style.display="none",h.addEventListener("load",()=>{this.initialized=!0,n()}),h.addEventListener("error",g=>{a(g)}),document.body.append(h),this.iframe=h}),new Promise(n=>{setTimeout(()=>n("iframe load timeout"),O.toMiliseconds(O.ONE_SECOND/2))})])}catch(n){this.logger.error(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.error(n)}},this.logger=B.generateChildLogger(i,this.name),this.verifyUrl=Kc,this.abortController=new AbortController,this.isDevEnv=lm()&&{NX_RIVET_KEY:"3acd48cc26e847f38560081935d2ffbd",NX_GRAPH_API_KEY_MAINNET:"",NX_ETHERSCAN_KEY:"MKNHEWBSRVKMI2BKACPZBH9DP72B6PURMS",NX_ARBISCAN_KEY:"",NX_GNOSISSCAN_KEY:"",NX_POLYGONSCAN_KEY:"",NX_OPTIMISMSCAN_KEY:"",NX_WALLET_CONNECT_ID:"c686a28c71a25d43ac128813eae837de",NX_OPTIMISM_ALCHEMY_KEY:"",NX_ARBITRUM_ALCHEMY_KEY:"",NX_POLYGONPOS_ALCHEMY_KEY:""}.IS_VITEST}get context(){return B.getLoggerContext(this.logger)}startAbortTimer(r){return setTimeout(()=>this.abortController.abort(),O.toMiliseconds(r))}}var h0=Object.defineProperty,Zc=Object.getOwnPropertySymbols,l0=Object.prototype.hasOwnProperty,p0=Object.prototype.propertyIsEnumerable,Xc=(p,r,i)=>r in p?h0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,eu=(p,r)=>{for(var i in r||(r={}))l0.call(r,i)&&Xc(p,i,r[i]);if(Zc)for(var i of Zc(r))p0.call(r,i)&&Xc(p,i,r[i]);return p};class Bn extends Fm{constructor(r){super(r),this.protocol=qu,this.version=d1,this.name=Hn,this.events=new Ze.exports.EventEmitter,this.initialized=!1,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.projectId=r?.projectId,this.relayUrl=r?.relayUrl||Mu;const i=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:B.pino(B.getDefaultLoggerOptions({level:r?.logger||g1.logger}));this.logger=B.generateChildLogger(i,this.name),this.heartbeat=new Gi.HeartBeat,this.crypto=new k1(this,this.logger,r?.keychain),this.history=new o0(this,this.logger),this.expirer=new c0(this,this.logger),this.storage=r!=null&&r.storage?r.storage:new Ky(eu(eu({},f1),r?.storageOptions)),this.relayer=new i0({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new a0(this,this.logger),this.verify=new u0(this.projectId||"",this.logger)}static async init(r){const i=new Bn(r);await i.initialize();const n=await i.crypto.getClientId();return await i.storage.setItem(O1,n),i}get context(){return B.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(r){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,r),this.logger.error(r.message),r}}}const d0=Bn,zu="wc",Lu=2,Uu="client",Gn=`${zu}@${Lu}:${Uu}:`,Sn={name:Uu,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},tu="WALLETCONNECT_DEEPLINK_CHOICE",g0="proposal",ku="Proposal expired",f0="session",kr=O.SEVEN_DAYS,v0="engine",Vi={wc_sessionPropose:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1104},res:{ttl:O.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1106},res:{ttl:O.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:O.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:O.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:O.ONE_DAY,prompt:!1,tag:1112},res:{ttl:O.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1114},res:{ttl:O.THIRTY_SECONDS,prompt:!1,tag:1115}}},Cn={min:O.FIVE_MINUTES,max:O.SEVEN_DAYS},Ki={idle:"idle",active:"active"},y0="request",m0=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var w0=Object.defineProperty,_0=Object.defineProperties,b0=Object.getOwnPropertyDescriptors,iu=Object.getOwnPropertySymbols,E0=Object.prototype.hasOwnProperty,I0=Object.prototype.propertyIsEnumerable,ru=(p,r,i)=>r in p?w0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Ye=(p,r)=>{for(var i in r||(r={}))E0.call(r,i)&&ru(p,i,r[i]);if(iu)for(var i of iu(r))I0.call(r,i)&&ru(p,i,r[i]);return p},xn=(p,r)=>_0(p,b0(r));class P0 extends km{constructor(r){super(r),this.name=v0,this.events=new Ze.exports,this.initialized=!1,this.ignoredPayloadTypes=[mu],this.requestQueue={state:Ki.idle,requests:[]},this.requestQueueDelay=O.ONE_SECOND,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.client.core.pairing.register({methods:Object.keys(Vi)}),this.initialized=!0,setTimeout(()=>{this.requestQueue.requests=this.getPendingSessionRequests(),this.processRequestQueue()},O.toMiliseconds(this.requestQueueDelay)))},this.connect=async i=>{this.isInitialized();const n=xn(Ye({},i),{requiredNamespaces:i.requiredNamespaces||{},optionalNamespaces:i.optionalNamespaces||{}});await this.isValidConnect(n);const{pairingTopic:a,requiredNamespaces:h,optionalNamespaces:g,sessionProperties:m,relays:b}=n;let S=a,$,V=!1;if(S&&(V=this.client.core.pairing.pairings.get(S).active),!S||!V){const{topic:Q,uri:G}=await this.client.core.pairing.create();S=Q,$=G}const M=await this.client.core.crypto.generateKeyPair(),Z=Ye({requiredNamespaces:h,optionalNamespaces:g,relays:b??[{protocol:ju}],proposer:{publicKey:M,metadata:this.client.metadata}},m&&{sessionProperties:m}),{reject:T,resolve:te,done:re}=di(O.FIVE_MINUTES,ku);if(this.events.once(ge("session_connect"),async({error:Q,session:G})=>{if(Q)T(Q);else if(G){G.self.publicKey=M;const ne=xn(Ye({},G),{requiredNamespaces:G.requiredNamespaces,optionalNamespaces:G.optionalNamespaces});await this.client.session.set(G.topic,ne),await this.setExpiry(G.topic,G.expiry),S&&await this.client.core.pairing.updateMetadata({topic:S,metadata:G.peer.metadata}),te(ne)}}),!S){const{message:Q}=A("NO_MATCHING_KEY",`connect() pairing topic: ${S}`);throw new Error(Q)}const se=await this.sendRequest(S,"wc_sessionPropose",Z),Ie=nt(O.FIVE_MINUTES);return await this.setProposal(se,Ye({id:se,expiry:Ie},Z)),{uri:$,approval:re}},this.pair=async i=>(this.isInitialized(),await this.client.core.pairing.pair(i)),this.approve=async i=>{this.isInitialized(),await this.isValidApprove(i);const{id:n,relayProtocol:a,namespaces:h,sessionProperties:g}=i,m=this.client.proposal.get(n);let{pairingTopic:b,proposer:S,requiredNamespaces:$,optionalNamespaces:V}=m;b=b||"",Br($)||($=pm(h,"approve()"));const M=await this.client.core.crypto.generateKeyPair(),Z=S.publicKey,T=await this.client.core.crypto.generateSharedKey(M,Z);b&&n&&(await this.client.core.pairing.updateMetadata({topic:b,metadata:S.metadata}),await this.sendResult(n,b,{relay:{protocol:a??"irn"},responderPublicKey:M}),await this.client.proposal.delete(n,Re("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:b}));const te=Ye({relay:{protocol:a??"irn"},namespaces:h,requiredNamespaces:$,optionalNamespaces:V,pairingTopic:b,controller:{publicKey:M,metadata:this.client.metadata},expiry:nt(kr)},g&&{sessionProperties:g});await this.client.core.relayer.subscribe(T),await this.sendRequest(T,"wc_sessionSettle",te);const re=xn(Ye({},te),{topic:T,pairingTopic:b,acknowledged:!1,self:te.controller,peer:{publicKey:S.publicKey,metadata:S.metadata},controller:M});return await this.client.session.set(T,re),await this.setExpiry(T,nt(kr)),{topic:T,acknowledged:()=>new Promise(se=>setTimeout(()=>se(this.client.session.get(T)),500))}},this.reject=async i=>{this.isInitialized(),await this.isValidReject(i);const{id:n,reason:a}=i,{pairingTopic:h}=this.client.proposal.get(n);h&&(await this.sendError(n,h,a),await this.client.proposal.delete(n,Re("USER_DISCONNECTED")))},this.update=async i=>{this.isInitialized(),await this.isValidUpdate(i);const{topic:n,namespaces:a}=i,h=await this.sendRequest(n,"wc_sessionUpdate",{namespaces:a}),{done:g,resolve:m,reject:b}=di();return this.events.once(ge("session_update",h),({error:S})=>{S?b(S):m()}),await this.client.session.update(n,{namespaces:a}),{acknowledged:g}},this.extend=async i=>{this.isInitialized(),await this.isValidExtend(i);const{topic:n}=i,a=await this.sendRequest(n,"wc_sessionExtend",{}),{done:h,resolve:g,reject:m}=di();return this.events.once(ge("session_extend",a),({error:b})=>{b?m(b):g()}),await this.setExpiry(n,nt(kr)),{acknowledged:h}},this.request=async i=>{this.isInitialized(),await this.isValidRequest(i);const{chainId:n,request:a,topic:h,expiry:g}=i,m=await this.sendRequest(h,"wc_sessionRequest",{request:a,chainId:n},g),{done:b,resolve:S,reject:$}=di(g);this.events.once(ge("session_request",m),({error:M,result:Z})=>{M?$(M):S(Z)}),this.client.events.emit("session_request_sent",{topic:h,request:a,chainId:n,id:m});const V=await this.client.core.storage.getItem(tu);return dm({id:m,topic:h,wcDeepLink:V}),await b()},this.respond=async i=>{this.isInitialized(),await this.isValidRespond(i);const{topic:n,response:a}=i,{id:h}=a;$t(a)?await this.sendResult(h,n,a.result):Et(a)&&await this.sendError(h,n,a.error),this.cleanupAfterResponse(i)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const a=await this.sendRequest(n,"wc_sessionPing",{}),{done:h,resolve:g,reject:m}=di();this.events.once(ge("session_ping",a),({error:b})=>{b?m(b):g()}),await h()}else this.client.core.pairing.pairings.keys.includes(n)&&await this.client.core.pairing.ping({topic:n})},this.emit=async i=>{this.isInitialized(),await this.isValidEmit(i);const{topic:n,event:a,chainId:h}=i;await this.sendRequest(n,"wc_sessionEvent",{event:a,chainId:h})},this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;if(this.client.session.keys.includes(n)){const a=Iu().toString();let h;const g=m=>{m?.id.toString()===a&&(this.client.core.relayer.events.removeListener(ue.message_ack,g),h())};await Promise.all([new Promise(m=>{h=m,this.client.core.relayer.on(ue.message_ack,g)}),this.sendRequest(n,"wc_sessionDelete",Re("USER_DISCONNECTED"),void 0,a)]),await this.deleteSession(n)}else await this.client.core.pairing.disconnect({topic:n})},this.find=i=>(this.isInitialized(),this.client.session.getAll().filter(n=>gm(n,i))),this.getPendingSessionRequests=()=>(this.isInitialized(),this.client.pendingRequest.getAll()),this.cleanupDuplicatePairings=async i=>{if(i.pairingTopic)try{const n=this.client.core.pairing.pairings.get(i.pairingTopic),a=this.client.core.pairing.pairings.getAll().filter(h=>{var g,m;return((g=h.peerMetadata)==null?void 0:g.url)&&((m=h.peerMetadata)==null?void 0:m.url)===i.peer.metadata.url&&h.topic&&h.topic!==n.topic});if(a.length===0)return;this.client.logger.info(`Cleaning up ${a.length} duplicate pairing(s)`),await Promise.all(a.map(h=>this.client.core.pairing.disconnect({topic:h.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(n){this.client.logger.error(n)}},this.deleteSession=async(i,n)=>{const{self:a}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),this.client.session.delete(i,Re("USER_DISCONNECTED")),this.client.core.crypto.keychain.has(a.publicKey)&&await this.client.core.crypto.deleteKeyPair(a.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(tu).catch(h=>this.client.logger.warn(h))},this.deleteProposal=async(i,n)=>{await Promise.all([this.client.proposal.delete(i,Re("USER_DISCONNECTED")),n?Promise.resolve():this.client.core.expirer.del(i)])},this.deletePendingSessionRequest=async(i,n,a=!1)=>{await Promise.all([this.client.pendingRequest.delete(i,n),a?Promise.resolve():this.client.core.expirer.del(i)]),this.requestQueue.requests=this.requestQueue.requests.filter(h=>h.id!==i),a&&(this.requestQueue.state=Ki.idle)},this.setExpiry=async(i,n)=>{this.client.session.keys.includes(i)&&await this.client.session.update(i,{expiry:n}),this.client.core.expirer.set(i,n)},this.setProposal=async(i,n)=>{await this.client.proposal.set(i,n),this.client.core.expirer.set(i,n.expiry)},this.setPendingSessionRequest=async i=>{const n=Vi.wc_sessionRequest.req.ttl,{id:a,topic:h,params:g}=i;await this.client.pendingRequest.set(a,{id:a,topic:h,params:g}),n&&this.client.core.expirer.set(a,nt(n))},this.sendRequest=async(i,n,a,h,g)=>{const m=Kn(n,a);if(_u()&&m0.includes(n)){const $=fi(JSON.stringify(m));await this.client.core.verify.register({attestationId:$})}const b=await this.client.core.crypto.encode(i,m),S=Vi[n].req;return h&&(S.ttl=h),g&&(S.id=g),this.client.core.history.set(i,m),this.client.core.relayer.publish(i,b,S),m.id},this.sendResult=async(i,n,a)=>{const h=kn(i,a),g=await this.client.core.crypto.encode(n,h),m=await this.client.core.history.get(n,i),b=Vi[m.request.method].res;this.client.core.relayer.publish(n,g,b),await this.client.core.history.resolve(h)},this.sendError=async(i,n,a)=>{const h=Vn(i,a),g=await this.client.core.crypto.encode(n,h),m=await this.client.core.history.get(n,i),b=Vi[m.request.method].res;this.client.core.relayer.publish(n,g,b),await this.client.core.history.resolve(h)},this.cleanup=async()=>{const i=[],n=[];this.client.session.getAll().forEach(a=>{Tt(a.expiry)&&i.push(a.topic)}),this.client.proposal.getAll().forEach(a=>{Tt(a.expiry)&&n.push(a.id)}),await Promise.all([...i.map(a=>this.deleteSession(a)),...n.map(a=>this.deleteProposal(a))])},this.onRelayEventRequest=i=>{const{topic:n,payload:a}=i,h=a.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeRequest(n,a);case"wc_sessionSettle":return this.onSessionSettleRequest(n,a);case"wc_sessionUpdate":return this.onSessionUpdateRequest(n,a);case"wc_sessionExtend":return this.onSessionExtendRequest(n,a);case"wc_sessionPing":return this.onSessionPingRequest(n,a);case"wc_sessionDelete":return this.onSessionDeleteRequest(n,a);case"wc_sessionRequest":return this.onSessionRequest(n,a);case"wc_sessionEvent":return this.onSessionEventRequest(n,a);default:return this.client.logger.info(`Unsupported request method ${h}`)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:a}=i,h=(await this.client.core.history.get(n,a.id)).request.method;switch(h){case"wc_sessionPropose":return this.onSessionProposeResponse(n,a);case"wc_sessionSettle":return this.onSessionSettleResponse(n,a);case"wc_sessionUpdate":return this.onSessionUpdateResponse(n,a);case"wc_sessionExtend":return this.onSessionExtendResponse(n,a);case"wc_sessionPing":return this.onSessionPingResponse(n,a);case"wc_sessionRequest":return this.onSessionRequestResponse(n,a);default:return this.client.logger.info(`Unsupported response method ${h}`)}},this.onRelayEventUnknownPayload=i=>{const{topic:n}=i,{message:a}=A("MISSING_OR_INVALID",`Decoded payload on topic ${n} is not identifiable as a JSON-RPC request or a response.`);throw new Error(a)},this.onSessionProposeRequest=async(i,n)=>{const{params:a,id:h}=n;try{this.isValidConnect(Ye({},n.params));const g=nt(O.FIVE_MINUTES),m=Ye({id:h,pairingTopic:i,expiry:g},a);await this.setProposal(h,m);const b=fi(JSON.stringify(n)),S=await this.getVerifyContext(b,m.proposer.metadata);this.client.events.emit("session_proposal",{id:h,params:m,verifyContext:S})}catch(g){await this.sendError(h,i,g),this.client.logger.error(g)}},this.onSessionProposeResponse=async(i,n)=>{const{id:a}=n;if($t(n)){const{result:h}=n;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:h});const g=this.client.proposal.get(a);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:g});const m=g.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:m});const b=h.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:b});const S=await this.client.core.crypto.generateSharedKey(m,b);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:S});const $=await this.client.core.relayer.subscribe(S);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:$}),await this.client.core.pairing.activate({topic:i})}else Et(n)&&(await this.client.proposal.delete(a,Re("USER_DISCONNECTED")),this.events.emit(ge("session_connect"),{error:n.error}))},this.onSessionSettleRequest=async(i,n)=>{const{id:a,params:h}=n;try{this.isValidSessionSettleRequest(h);const{relay:g,controller:m,expiry:b,namespaces:S,requiredNamespaces:$,optionalNamespaces:V,sessionProperties:M,pairingTopic:Z}=n.params,T=Ye({topic:i,relay:g,expiry:b,namespaces:S,acknowledged:!0,pairingTopic:Z,requiredNamespaces:$,optionalNamespaces:V,controller:m.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:m.publicKey,metadata:m.metadata}},M&&{sessionProperties:M});await this.sendResult(n.id,i,!0),this.events.emit(ge("session_connect"),{session:T}),this.cleanupDuplicatePairings(T)}catch(g){await this.sendError(a,i,g),this.client.logger.error(g)}},this.onSessionSettleResponse=async(i,n)=>{const{id:a}=n;$t(n)?(await this.client.session.update(i,{acknowledged:!0}),this.events.emit(ge("session_approve",a),{})):Et(n)&&(await this.client.session.delete(i,Re("USER_DISCONNECTED")),this.events.emit(ge("session_approve",a),{error:n.error}))},this.onSessionUpdateRequest=async(i,n)=>{const{params:a,id:h}=n;try{this.isValidUpdate(Ye({topic:i},a)),await this.client.session.update(i,{namespaces:a.namespaces}),await this.sendResult(h,i,!0),this.client.events.emit("session_update",{id:h,topic:i,params:a})}catch(g){await this.sendError(h,i,g),this.client.logger.error(g)}},this.onSessionUpdateResponse=(i,n)=>{const{id:a}=n;$t(n)?this.events.emit(ge("session_update",a),{}):Et(n)&&this.events.emit(ge("session_update",a),{error:n.error})},this.onSessionExtendRequest=async(i,n)=>{const{id:a}=n;try{this.isValidExtend({topic:i}),await this.setExpiry(i,nt(kr)),await this.sendResult(a,i,!0),this.client.events.emit("session_extend",{id:a,topic:i})}catch(h){await this.sendError(a,i,h),this.client.logger.error(h)}},this.onSessionExtendResponse=(i,n)=>{const{id:a}=n;$t(n)?this.events.emit(ge("session_extend",a),{}):Et(n)&&this.events.emit(ge("session_extend",a),{error:n.error})},this.onSessionPingRequest=async(i,n)=>{const{id:a}=n;try{this.isValidPing({topic:i}),await this.sendResult(a,i,!0),this.client.events.emit("session_ping",{id:a,topic:i})}catch(h){await this.sendError(a,i,h),this.client.logger.error(h)}},this.onSessionPingResponse=(i,n)=>{const{id:a}=n;setTimeout(()=>{$t(n)?this.events.emit(ge("session_ping",a),{}):Et(n)&&this.events.emit(ge("session_ping",a),{error:n.error})},500)},this.onSessionDeleteRequest=async(i,n)=>{const{id:a}=n;try{this.isValidDisconnect({topic:i,reason:n.params}),await Promise.all([new Promise(h=>{this.client.core.relayer.once(ue.publish,async()=>{h(await this.deleteSession(i))})}),this.sendResult(a,i,!0)]),this.client.events.emit("session_delete",{id:a,topic:i})}catch(h){this.client.logger.error(h)}},this.onSessionRequest=async(i,n)=>{const{id:a,params:h}=n;try{this.isValidRequest(Ye({topic:i},h)),await this.setPendingSessionRequest({id:a,topic:i,params:h}),this.addRequestToQueue({id:a,topic:i,params:h}),await this.processRequestQueue()}catch(g){await this.sendError(a,i,g),this.client.logger.error(g)}},this.onSessionRequestResponse=(i,n)=>{const{id:a}=n;$t(n)?this.events.emit(ge("session_request",a),{result:n.result}):Et(n)&&this.events.emit(ge("session_request",a),{error:n.error})},this.onSessionEventRequest=async(i,n)=>{const{id:a,params:h}=n;try{this.isValidEmit(Ye({topic:i},h)),this.client.events.emit("session_event",{id:a,topic:i,params:h})}catch(g){await this.sendError(a,i,g),this.client.logger.error(g)}},this.addRequestToQueue=i=>{this.requestQueue.requests.push(i)},this.cleanupAfterResponse=i=>{this.deletePendingSessionRequest(i.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.requestQueue.state=Ki.idle,this.processRequestQueue()},O.toMiliseconds(this.requestQueueDelay))},this.processRequestQueue=async()=>{if(this.requestQueue.state===Ki.active){this.client.logger.info("session request queue is already active.");return}const i=this.requestQueue.requests[0];if(!i){this.client.logger.info("session request queue is empty.");return}try{const{id:n,topic:a,params:h}=i,g=fi(JSON.stringify({id:n,params:h})),m=this.client.session.get(a),b=await this.getVerifyContext(g,m.peer.metadata);this.requestQueue.state=Ki.active,this.client.events.emit("session_request",{id:n,topic:a,params:h,verifyContext:b})}catch(n){this.client.logger.error(n)}},this.isValidConnect=async i=>{if(!$e(i)){const{message:b}=A("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(i)}`);throw new Error(b)}const{pairingTopic:n,requiredNamespaces:a,optionalNamespaces:h,sessionProperties:g,relays:m}=i;if(qt(n)||await this.isValidPairingTopic(n),!fm(m,!0)){const{message:b}=A("MISSING_OR_INVALID",`connect() relays: ${m}`);throw new Error(b)}!qt(a)&&Br(a)!==0&&this.validateNamespaces(a,"requiredNamespaces"),!qt(h)&&Br(h)!==0&&this.validateNamespaces(h,"optionalNamespaces"),qt(g)||this.validateSessionProps(g,"sessionProperties")},this.validateNamespaces=(i,n)=>{const a=vm(i,"connect()",n);if(a)throw new Error(a.message)},this.isValidApprove=async i=>{if(!$e(i))throw new Error(A("MISSING_OR_INVALID",`approve() params: ${i}`).message);const{id:n,namespaces:a,relayProtocol:h,sessionProperties:g}=i;await this.isValidProposalId(n);const m=this.client.proposal.get(n),b=_n(a,"approve()");if(b)throw new Error(b.message);const S=Dc(m.requiredNamespaces,a,"approve()");if(S)throw new Error(S.message);if(!gi(h,!0)){const{message:$}=A("MISSING_OR_INVALID",`approve() relayProtocol: ${h}`);throw new Error($)}qt(g)||this.validateSessionProps(g,"sessionProperties")},this.isValidReject=async i=>{if(!$e(i)){const{message:h}=A("MISSING_OR_INVALID",`reject() params: ${i}`);throw new Error(h)}const{id:n,reason:a}=i;if(await this.isValidProposalId(n),!ym(a)){const{message:h}=A("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidSessionSettleRequest=i=>{if(!$e(i)){const{message:S}=A("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${i}`);throw new Error(S)}const{relay:n,controller:a,namespaces:h,expiry:g}=i;if(!mm(n)){const{message:S}=A("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(S)}const m=wm(a,"onSessionSettleRequest()");if(m)throw new Error(m.message);const b=_n(h,"onSessionSettleRequest()");if(b)throw new Error(b.message);if(Tt(g)){const{message:S}=A("EXPIRED","onSessionSettleRequest()");throw new Error(S)}},this.isValidUpdate=async i=>{if(!$e(i)){const{message:b}=A("MISSING_OR_INVALID",`update() params: ${i}`);throw new Error(b)}const{topic:n,namespaces:a}=i;await this.isValidSessionTopic(n);const h=this.client.session.get(n),g=_n(a,"update()");if(g)throw new Error(g.message);const m=Dc(h.requiredNamespaces,a,"update()");if(m)throw new Error(m.message)},this.isValidExtend=async i=>{if(!$e(i)){const{message:a}=A("MISSING_OR_INVALID",`extend() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionTopic(n)},this.isValidRequest=async i=>{if(!$e(i)){const{message:b}=A("MISSING_OR_INVALID",`request() params: ${i}`);throw new Error(b)}const{topic:n,request:a,chainId:h,expiry:g}=i;await this.isValidSessionTopic(n);const{namespaces:m}=this.client.session.get(n);if(!$c(m,h)){const{message:b}=A("MISSING_OR_INVALID",`request() chainId: ${h}`);throw new Error(b)}if(!_m(a)){const{message:b}=A("MISSING_OR_INVALID",`request() ${JSON.stringify(a)}`);throw new Error(b)}if(!bm(m,h,a.method)){const{message:b}=A("MISSING_OR_INVALID",`request() method: ${a.method}`);throw new Error(b)}if(g&&!Em(g,Cn)){const{message:b}=A("MISSING_OR_INVALID",`request() expiry: ${g}. Expiry must be a number (in seconds) between ${Cn.min} and ${Cn.max}`);throw new Error(b)}},this.isValidRespond=async i=>{if(!$e(i)){const{message:h}=A("MISSING_OR_INVALID",`respond() params: ${i}`);throw new Error(h)}const{topic:n,response:a}=i;if(await this.isValidSessionTopic(n),!Im(a)){const{message:h}=A("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(a)}`);throw new Error(h)}},this.isValidPing=async i=>{if(!$e(i)){const{message:a}=A("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.isValidEmit=async i=>{if(!$e(i)){const{message:m}=A("MISSING_OR_INVALID",`emit() params: ${i}`);throw new Error(m)}const{topic:n,event:a,chainId:h}=i;await this.isValidSessionTopic(n);const{namespaces:g}=this.client.session.get(n);if(!$c(g,h)){const{message:m}=A("MISSING_OR_INVALID",`emit() chainId: ${h}`);throw new Error(m)}if(!Pm(a)){const{message:m}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}if(!Sm(g,h,a.name)){const{message:m}=A("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(a)}`);throw new Error(m)}},this.isValidDisconnect=async i=>{if(!$e(i)){const{message:a}=A("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(a)}const{topic:n}=i;await this.isValidSessionOrPairingTopic(n)},this.getVerifyContext=async(i,n)=>{const a={verified:{verifyUrl:n.verifyUrl||"",validation:"UNKNOWN",origin:n.url||""}};try{const h=await this.client.core.verify.resolve({attestationId:i,verifyUrl:n.verifyUrl});h&&(a.verified.origin=h,a.verified.validation=h===n.url?"VALID":"INVALID")}catch(h){this.client.logger.error(h)}return this.client.logger.info(`Verify context: ${JSON.stringify(a)}`),a},this.validateSessionProps=(i,n)=>{Object.values(i).forEach(a=>{if(!gi(a,!1)){const{message:h}=A("MISSING_OR_INVALID",`${n} must be in Record<string, string> format. Received: ${JSON.stringify(a)}`);throw new Error(h)}})}}isInitialized(){if(!this.initialized){const{message:r}=A("NOT_INITIALIZED",this.name);throw new Error(r)}}registerRelayerEvents(){this.client.core.relayer.on(ue.message,async r=>{const{topic:i,message:n}=r;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(n)))return;const a=await this.client.core.crypto.decode(i,n);try{Ln(a)?(this.client.core.history.set(i,a),this.onRelayEventRequest({topic:i,payload:a})):Un(a)?(await this.client.core.history.resolve(a),await this.onRelayEventResponse({topic:i,payload:a}),this.client.core.history.delete(i,a.id)):this.onRelayEventUnknownPayload({topic:i,payload:a})}catch(h){this.client.logger.error(h)}})}registerExpirerEvents(){this.client.core.expirer.on(Je.expired,async r=>{const{topic:i,id:n}=wu(r.target);if(n&&this.client.pendingRequest.keys.includes(n))return await this.deletePendingSessionRequest(n,A("EXPIRED"),!0);i?this.client.session.keys.includes(i)&&(await this.deleteSession(i,!0),this.client.events.emit("session_expire",{topic:i})):n&&(await this.deleteProposal(n,!0),this.client.events.emit("proposal_expire",{id:n}))})}isValidPairingTopic(r){if(!gi(r,!1)){const{message:i}=A("MISSING_OR_INVALID",`pairing topic should be a string: ${r}`);throw new Error(i)}if(!this.client.core.pairing.pairings.keys.includes(r)){const{message:i}=A("NO_MATCHING_KEY",`pairing topic doesn't exist: ${r}`);throw new Error(i)}if(Tt(this.client.core.pairing.pairings.get(r).expiry)){const{message:i}=A("EXPIRED",`pairing topic: ${r}`);throw new Error(i)}}async isValidSessionTopic(r){if(!gi(r,!1)){const{message:i}=A("MISSING_OR_INVALID",`session topic should be a string: ${r}`);throw new Error(i)}if(!this.client.session.keys.includes(r)){const{message:i}=A("NO_MATCHING_KEY",`session topic doesn't exist: ${r}`);throw new Error(i)}if(Tt(this.client.session.get(r).expiry)){await this.deleteSession(r);const{message:i}=A("EXPIRED",`session topic: ${r}`);throw new Error(i)}}async isValidSessionOrPairingTopic(r){if(this.client.session.keys.includes(r))await this.isValidSessionTopic(r);else if(this.client.core.pairing.pairings.keys.includes(r))this.isValidPairingTopic(r);else if(gi(r,!1)){const{message:i}=A("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${r}`);throw new Error(i)}else{const{message:i}=A("MISSING_OR_INVALID",`session or pairing topic should be a string: ${r}`);throw new Error(i)}}async isValidProposalId(r){if(!Cm(r)){const{message:i}=A("MISSING_OR_INVALID",`proposal id should be a number: ${r}`);throw new Error(i)}if(!this.client.proposal.keys.includes(r)){const{message:i}=A("NO_MATCHING_KEY",`proposal id doesn't exist: ${r}`);throw new Error(i)}if(Tt(this.client.proposal.get(r).expiry)){await this.deleteProposal(r);const{message:i}=A("EXPIRED",`proposal id: ${r}`);throw new Error(i)}}}class S0 extends Qr{constructor(r,i){super(r,i,g0,Gn),this.core=r,this.logger=i}}class C0 extends Qr{constructor(r,i){super(r,i,f0,Gn),this.core=r,this.logger=i}}class x0 extends Qr{constructor(r,i){super(r,i,y0,Gn,n=>n.id),this.core=r,this.logger=i}}class Wn extends Um{constructor(r){super(r),this.protocol=zu,this.version=Lu,this.name=Sn.name,this.events=new Ze.exports.EventEmitter,this.on=(n,a)=>this.events.on(n,a),this.once=(n,a)=>this.events.once(n,a),this.off=(n,a)=>this.events.off(n,a),this.removeListener=(n,a)=>this.events.removeListener(n,a),this.removeAllListeners=n=>this.events.removeAllListeners(n),this.connect=async n=>{try{return await this.engine.connect(n)}catch(a){throw this.logger.error(a.message),a}},this.pair=async n=>{try{return await this.engine.pair(n)}catch(a){throw this.logger.error(a.message),a}},this.approve=async n=>{try{return await this.engine.approve(n)}catch(a){throw this.logger.error(a.message),a}},this.reject=async n=>{try{return await this.engine.reject(n)}catch(a){throw this.logger.error(a.message),a}},this.update=async n=>{try{return await this.engine.update(n)}catch(a){throw this.logger.error(a.message),a}},this.extend=async n=>{try{return await this.engine.extend(n)}catch(a){throw this.logger.error(a.message),a}},this.request=async n=>{try{return await this.engine.request(n)}catch(a){throw this.logger.error(a.message),a}},this.respond=async n=>{try{return await this.engine.respond(n)}catch(a){throw this.logger.error(a.message),a}},this.ping=async n=>{try{return await this.engine.ping(n)}catch(a){throw this.logger.error(a.message),a}},this.emit=async n=>{try{return await this.engine.emit(n)}catch(a){throw this.logger.error(a.message),a}},this.disconnect=async n=>{try{return await this.engine.disconnect(n)}catch(a){throw this.logger.error(a.message),a}},this.find=n=>{try{return this.engine.find(n)}catch(a){throw this.logger.error(a.message),a}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(n){throw this.logger.error(n.message),n}},this.name=r?.name||Sn.name,this.metadata=r?.metadata||xm();const i=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:B.pino(B.getDefaultLoggerOptions({level:r?.logger||Sn.logger}));this.core=r?.core||new d0(r),this.logger=B.generateChildLogger(i,this.name),this.session=new C0(this.core,this.logger),this.proposal=new S0(this.core,this.logger),this.pendingRequest=new x0(this.core,this.logger),this.engine=new P0(this)}static async init(r){const i=new Wn(r);return await i.initialize(),i}get context(){return B.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(r){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(r.message),r}}}var su=Am();const A0={Accept:"application/json","Content-Type":"application/json"},R0="POST",nu={headers:A0,method:R0},au=10;class Jt{constructor(r,i=!1){if(this.url=r,this.disableProviderPing=i,this.events=new Ze.exports.EventEmitter,this.isAvailable=!1,this.registering=!1,!Tc(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);this.url=r,this.disableProviderPing=i}get connected(){return this.isAvailable}get connecting(){return this.registering}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}off(r,i){this.events.off(r,i)}removeListener(r,i){this.events.removeListener(r,i)}async open(r=this.url){await this.register(r)}async close(){if(!this.isAvailable)throw new Error("Connection already closed");this.onClose()}async send(r,i){this.isAvailable||await this.register();try{const n=Fn(r),h=await(await su(this.url,Object.assign(Object.assign({},nu),{body:n}))).json();this.onPayload({data:h})}catch(n){this.onError(r.id,n)}}async register(r=this.url){if(!Tc(r))throw new Error(`Provided URL is not compatible with HTTP connection: ${r}`);if(this.registering){const i=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=i||this.events.listenerCount("open")>=i)&&this.events.setMaxListeners(i+1),new Promise((n,a)=>{this.events.once("register_error",h=>{this.resetMaxListeners(),a(h)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.isAvailable>"u")return a(new Error("HTTP connection is missing or invalid"));n()})})}this.url=r,this.registering=!0;try{if(!this.disableProviderPing){const i=Fn({id:1,jsonrpc:"2.0",method:"test",params:[]});await su(r,Object.assign(Object.assign({},nu),{body:i}))}this.onOpen()}catch(i){const n=this.parseError(i);throw this.events.emit("register_error",n),this.onClose(),n}}onOpen(){this.isAvailable=!0,this.registering=!1,this.events.emit("open")}onClose(){this.isAvailable=!1,this.registering=!1,this.events.emit("close")}onPayload(r){if(typeof r.data>"u")return;const i=typeof r.data=="string"?yu(r.data):r.data;this.events.emit("payload",i)}onError(r,i){const n=this.parseError(i),a=n.message||n.toString(),h=Vn(r,a);this.events.emit("payload",h)}parseError(r,i=this.url){return Rm(r,i,"HTTP")}resetMaxListeners(){this.events.getMaxListeners()>au&&this.events.setMaxListeners(au)}}const ou="error",N0="wss://relay.walletconnect.com",O0="wc",F0="universal_provider",cu=`${O0}@2:${F0}:`,D0="https://rpc.walletconnect.com/v1",zt={DEFAULT_CHAIN_CHANGED:"default_chain_changed"};var Hi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},qn={exports:{}};/**
* @license
* Lodash <https://lodash.com/>
* Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
* Released under MIT license <https://lodash.com/license>
* Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
* Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
*/(function(p,r){(function(){var i,n="4.17.21",a=200,h="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",g="Expected a function",m="Invalid `variable` option passed into `_.template`",b="__lodash_hash_undefined__",S=500,$="__lodash_placeholder__",V=1,M=2,Z=4,T=1,te=2,re=1,se=2,Ie=4,Q=8,G=16,ne=32,Pe=64,he=128,Se=256,It=512,Hu=30,Bu="...",Gu=800,Wu=16,Qn=1,Yu=2,Ju=3,Lt=1/0,Pt=9007199254740991,Qu=17976931348623157e292,Yi=0/0,at=4294967295,Zu=at-1,Xu=at>>>1,eh=[["ary",he],["bind",re],["bindKey",se],["curry",Q],["curryRight",G],["flip",It],["partial",ne],["partialRight",Pe],["rearg",Se]],Qt="[object Arguments]",Ji="[object Array]",th="[object AsyncFunction]",mi="[object Boolean]",wi="[object Date]",ih="[object DOMException]",Qi="[object Error]",Zi="[object Function]",Zn="[object GeneratorFunction]",Xe="[object Map]",_i="[object Number]",rh="[object Null]",pt="[object Object]",Xn="[object Promise]",sh="[object Proxy]",bi="[object RegExp]",et="[object Set]",Ei="[object String]",Xi="[object Symbol]",nh="[object Undefined]",Ii="[object WeakMap]",ah="[object WeakSet]",Pi="[object ArrayBuffer]",Zt="[object DataView]",Zr="[object Float32Array]",Xr="[object Float64Array]",es="[object Int8Array]",ts="[object Int16Array]",is="[object Int32Array]",rs="[object Uint8Array]",ss="[object Uint8ClampedArray]",ns="[object Uint16Array]",as="[object Uint32Array]",oh=/\b__p \+= '';/g,ch=/\b(__p \+=) '' \+/g,uh=/(__e\(.*?\)|\b__t\)) \+\n'';/g,ea=/&(?:amp|lt|gt|quot|#39);/g,ta=/[&<>"']/g,hh=RegExp(ea.source),lh=RegExp(ta.source),ph=/<%-([\s\S]+?)%>/g,dh=/<%([\s\S]+?)%>/g,ia=/<%=([\s\S]+?)%>/g,gh=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,fh=/^\w*$/,vh=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,os=/[\\^$.*+?()[\]{}|]/g,yh=RegExp(os.source),cs=/^\s+/,mh=/\s/,wh=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,_h=/\{\n\/\* \[wrapped with (.+)\] \*/,bh=/,? & /,Eh=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Ih=/[()=,{}\[\]\/\s]/,Ph=/\\(\\)?/g,Sh=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ra=/\w*$/,Ch=/^[-+]0x[0-9a-f]+$/i,xh=/^0b[01]+$/i,Ah=/^\[object .+?Constructor\]$/,Rh=/^0o[0-7]+$/i,Nh=/^(?:0|[1-9]\d*)$/,Oh=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,er=/($^)/,Fh=/['\n\r\u2028\u2029\\]/g,tr="\\ud800-\\udfff",Dh="\\u0300-\\u036f",$h="\\ufe20-\\ufe2f",Th="\\u20d0-\\u20ff",sa=Dh+$h+Th,na="\\u2700-\\u27bf",aa="a-z\\xdf-\\xf6\\xf8-\\xff",qh="\\xac\\xb1\\xd7\\xf7",jh="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Mh="\\u2000-\\u206f",zh=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",oa="A-Z\\xc0-\\xd6\\xd8-\\xde",ca="\\ufe0e\\ufe0f",ua=qh+jh+Mh+zh,us="['\u2019]",Lh="["+tr+"]",ha="["+ua+"]",ir="["+sa+"]",la="\\d+",Uh="["+na+"]",pa="["+aa+"]",da="[^"+tr+ua+la+na+aa+oa+"]",hs="\\ud83c[\\udffb-\\udfff]",kh="(?:"+ir+"|"+hs+")",ga="[^"+tr+"]",ls="(?:\\ud83c[\\udde6-\\uddff]){2}",ps="[\\ud800-\\udbff][\\udc00-\\udfff]",Xt="["+oa+"]",fa="\\u200d",va="(?:"+pa+"|"+da+")",Vh="(?:"+Xt+"|"+da+")",ya="(?:"+us+"(?:d|ll|m|re|s|t|ve))?",ma="(?:"+us+"(?:D|LL|M|RE|S|T|VE))?",wa=kh+"?",_a="["+ca+"]?",Kh="(?:"+fa+"(?:"+[ga,ls,ps].join("|")+")"+_a+wa+")*",Hh="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Bh="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",ba=_a+wa+Kh,Gh="(?:"+[Uh,ls,ps].join("|")+")"+ba,Wh="(?:"+[ga+ir+"?",ir,ls,ps,Lh].join("|")+")",Yh=RegExp(us,"g"),Jh=RegExp(ir,"g"),ds=RegExp(hs+"(?="+hs+")|"+Wh+ba,"g"),Qh=RegExp([Xt+"?"+pa+"+"+ya+"(?="+[ha,Xt,"$"].join("|")+")",Vh+"+"+ma+"(?="+[ha,Xt+va,"$"].join("|")+")",Xt+"?"+va+"+"+ya,Xt+"+"+ma,Bh,Hh,la,Gh].join("|"),"g"),Zh=RegExp("["+fa+tr+sa+ca+"]"),Xh=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,el=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],tl=-1,ie={};ie[Zr]=ie[Xr]=ie[es]=ie[ts]=ie[is]=ie[rs]=ie[ss]=ie[ns]=ie[as]=!0,ie[Qt]=ie[Ji]=ie[Pi]=ie[mi]=ie[Zt]=ie[wi]=ie[Qi]=ie[Zi]=ie[Xe]=ie[_i]=ie[pt]=ie[bi]=ie[et]=ie[Ei]=ie[Ii]=!1;var ee={};ee[Qt]=ee[Ji]=ee[Pi]=ee[Zt]=ee[mi]=ee[wi]=ee[Zr]=ee[Xr]=ee[es]=ee[ts]=ee[is]=ee[Xe]=ee[_i]=ee[pt]=ee[bi]=ee[et]=ee[Ei]=ee[Xi]=ee[rs]=ee[ss]=ee[ns]=ee[as]=!0,ee[Qi]=ee[Zi]=ee[Ii]=!1;var il={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},rl={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},sl={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},nl={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},al=parseFloat,ol=parseInt,Ea=typeof Hi=="object"&&Hi&&Hi.Object===Object&&Hi,cl=typeof self=="object"&&self&&self.Object===Object&&self,me=Ea||cl||Function("return this")(),gs=r&&!r.nodeType&&r,Ut=gs&&!0&&p&&!p.nodeType&&p,Ia=Ut&&Ut.exports===gs,fs=Ia&&Ea.process,Ue=function(){try{var v=Ut&&Ut.require&&Ut.require("util").types;return v||fs&&fs.binding&&fs.binding("util")}catch{}}(),Pa=Ue&&Ue.isArrayBuffer,Sa=Ue&&Ue.isDate,Ca=Ue&&Ue.isMap,xa=Ue&&Ue.isRegExp,Aa=Ue&&Ue.isSet,Ra=Ue&&Ue.isTypedArray;function Te(v,_,w){switch(w.length){case 0:return v.call(_);case 1:return v.call(_,w[0]);case 2:return v.call(_,w[0],w[1]);case 3:return v.call(_,w[0],w[1],w[2])}return v.apply(_,w)}function ul(v,_,w,x){for(var q=-1,W=v==null?0:v.length;++q<W;){var fe=v[q];_(x,fe,w(fe),v)}return x}function ke(v,_){for(var w=-1,x=v==null?0:v.length;++w<x&&_(v[w],w,v)!==!1;);return v}function hl(v,_){for(var w=v==null?0:v.length;w--&&_(v[w],w,v)!==!1;);return v}function Na(v,_){for(var w=-1,x=v==null?0:v.length;++w<x;)if(!_(v[w],w,v))return!1;return!0}function St(v,_){for(var w=-1,x=v==null?0:v.length,q=0,W=[];++w<x;){var fe=v[w];_(fe,w,v)&&(W[q++]=fe)}return W}function rr(v,_){var w=v==null?0:v.length;return!!w&&ei(v,_,0)>-1}function vs(v,_,w){for(var x=-1,q=v==null?0:v.length;++x<q;)if(w(_,v[x]))return!0;return!1}function ae(v,_){for(var w=-1,x=v==null?0:v.length,q=Array(x);++w<x;)q[w]=_(v[w],w,v);return q}function Ct(v,_){for(var w=-1,x=_.length,q=v.length;++w<x;)v[q+w]=_[w];return v}function ys(v,_,w,x){var q=-1,W=v==null?0:v.length;for(x&&W&&(w=v[++q]);++q<W;)w=_(w,v[q],q,v);return w}function ll(v,_,w,x){var q=v==null?0:v.length;for(x&&q&&(w=v[--q]);q--;)w=_(w,v[q],q,v);return w}function ms(v,_){for(var w=-1,x=v==null?0:v.length;++w<x;)if(_(v[w],w,v))return!0;return!1}var pl=ws("length");function dl(v){return v.split("")}function gl(v){return v.match(Eh)||[]}function Oa(v,_,w){var x;return w(v,function(q,W,fe){if(_(q,W,fe))return x=W,!1}),x}function sr(v,_,w,x){for(var q=v.length,W=w+(x?1:-1);x?W--:++W<q;)if(_(v[W],W,v))return W;return-1}function ei(v,_,w){return _===_?Cl(v,_,w):sr(v,Fa,w)}function fl(v,_,w,x){for(var q=w-1,W=v.length;++q<W;)if(x(v[q],_))return q;return-1}function Fa(v){return v!==v}function Da(v,_){var w=v==null?0:v.length;return w?bs(v,_)/w:Yi}function ws(v){return function(_){return _==null?i:_[v]}}function _s(v){return function(_){return v==null?i:v[_]}}function $a(v,_,w,x,q){return q(v,function(W,fe,X){w=x?(x=!1,W):_(w,W,fe,X)}),w}function vl(v,_){var w=v.length;for(v.sort(_);w--;)v[w]=v[w].value;return v}function bs(v,_){for(var w,x=-1,q=v.length;++x<q;){var W=_(v[x]);W!==i&&(w=w===i?W:w+W)}return w}function Es(v,_){for(var w=-1,x=Array(v);++w<v;)x[w]=_(w);return x}function yl(v,_){return ae(_,function(w){return[w,v[w]]})}function Ta(v){return v&&v.slice(0,za(v)+1).replace(cs,"")}function qe(v){return function(_){return v(_)}}function Is(v,_){return ae(_,function(w){return v[w]})}function Si(v,_){return v.has(_)}function qa(v,_){for(var w=-1,x=v.length;++w<x&&ei(_,v[w],0)>-1;);return w}function ja(v,_){for(var w=v.length;w--&&ei(_,v[w],0)>-1;);return w}function ml(v,_){for(var w=v.length,x=0;w--;)v[w]===_&&++x;return x}var wl=_s(il),_l=_s(rl);function bl(v){return"\\"+nl[v]}function El(v,_){return v==null?i:v[_]}function ti(v){return Zh.test(v)}function Il(v){return Xh.test(v)}function Pl(v){for(var _,w=[];!(_=v.next()).done;)w.push(_.value);return w}function Ps(v){var _=-1,w=Array(v.size);return v.forEach(function(x,q){w[++_]=[q,x]}),w}function Ma(v,_){return function(w){return v(_(w))}}function xt(v,_){for(var w=-1,x=v.length,q=0,W=[];++w<x;){var fe=v[w];(fe===_||fe===$)&&(v[w]=$,W[q++]=w)}return W}function nr(v){var _=-1,w=Array(v.size);return v.forEach(function(x){w[++_]=x}),w}function Sl(v){var _=-1,w=Array(v.size);return v.forEach(function(x){w[++_]=[x,x]}),w}function Cl(v,_,w){for(var x=w-1,q=v.length;++x<q;)if(v[x]===_)return x;return-1}function xl(v,_,w){for(var x=w+1;x--;)if(v[x]===_)return x;return x}function ii(v){return ti(v)?Rl(v):pl(v)}function tt(v){return ti(v)?Nl(v):dl(v)}function za(v){for(var _=v.length;_--&&mh.test(v.charAt(_)););return _}var Al=_s(sl);function Rl(v){for(var _=ds.lastIndex=0;ds.test(v);)++_;return _}function Nl(v){return v.match(ds)||[]}function Ol(v){return v.match(Qh)||[]}var Fl=function v(_){_=_==null?me:ri.defaults(me.Object(),_,ri.pick(me,el));var w=_.Array,x=_.Date,q=_.Error,W=_.Function,fe=_.Math,X=_.Object,Ss=_.RegExp,Dl=_.String,Ve=_.TypeError,ar=w.prototype,$l=W.prototype,si=X.prototype,or=_["__core-js_shared__"],cr=$l.toString,J=si.hasOwnProperty,Tl=0,La=function(){var e=/[^.]+$/.exec(or&&or.keys&&or.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),ur=si.toString,ql=cr.call(X),jl=me._,Ml=Ss("^"+cr.call(J).replace(os,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),hr=Ia?_.Buffer:i,At=_.Symbol,lr=_.Uint8Array,Ua=hr?hr.allocUnsafe:i,pr=Ma(X.getPrototypeOf,X),ka=X.create,Va=si.propertyIsEnumerable,dr=ar.splice,Ka=At?At.isConcatSpreadable:i,Ci=At?At.iterator:i,kt=At?At.toStringTag:i,gr=function(){try{var e=Gt(X,"defineProperty");return e({},"",{}),e}catch{}}(),zl=_.clearTimeout!==me.clearTimeout&&_.clearTimeout,Ll=x&&x.now!==me.Date.now&&x.now,Ul=_.setTimeout!==me.setTimeout&&_.setTimeout,fr=fe.ceil,vr=fe.floor,Cs=X.getOwnPropertySymbols,kl=hr?hr.isBuffer:i,Ha=_.isFinite,Vl=ar.join,Kl=Ma(X.keys,X),ve=fe.max,be=fe.min,Hl=x.now,Bl=_.parseInt,Ba=fe.random,Gl=ar.reverse,xs=Gt(_,"DataView"),xi=Gt(_,"Map"),As=Gt(_,"Promise"),ni=Gt(_,"Set"),Ai=Gt(_,"WeakMap"),Ri=Gt(X,"create"),yr=Ai&&new Ai,ai={},Wl=Wt(xs),Yl=Wt(xi),Jl=Wt(As),Ql=Wt(ni),Zl=Wt(Ai),mr=At?At.prototype:i,Ni=mr?mr.valueOf:i,Ga=mr?mr.toString:i;function u(e){if(ce(e)&&!j(e)&&!(e instanceof K)){if(e instanceof Ke)return e;if(J.call(e,"__wrapped__"))return Yo(e)}return new Ke(e)}var oi=function(){function e(){}return function(t){if(!oe(t))return{};if(ka)return ka(t);e.prototype=t;var s=new e;return e.prototype=i,s}}();function wr(){}function Ke(e,t){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!t,this.__index__=0,this.__values__=i}u.templateSettings={escape:ph,evaluate:dh,interpolate:ia,variable:"",imports:{_:u}},u.prototype=wr.prototype,u.prototype.constructor=u,Ke.prototype=oi(wr.prototype),Ke.prototype.constructor=Ke;function K(e){this.__wrapped__=e,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=at,this.__views__=[]}function Xl(){var e=new K(this.__wrapped__);return e.__actions__=Ne(this.__actions__),e.__dir__=this.__dir__,e.__filtered__=this.__filtered__,e.__iteratees__=Ne(this.__iteratees__),e.__takeCount__=this.__takeCount__,e.__views__=Ne(this.__views__),e}function ep(){if(this.__filtered__){var e=new K(this);e.__dir__=-1,e.__filtered__=!0}else e=this.clone(),e.__dir__*=-1;return e}function tp(){var e=this.__wrapped__.value(),t=this.__dir__,s=j(e),o=t<0,c=s?e.length:0,l=dd(0,c,this.__views__),d=l.start,f=l.end,y=f-d,E=o?f:d-1,I=this.__iteratees__,P=I.length,C=0,R=be(y,this.__takeCount__);if(!s||!o&&c==y&&R==y)return mo(e,this.__actions__);var F=[];e:for(;y--&&C<R;){E+=t;for(var L=-1,D=e[E];++L<P;){var k=I[L],H=k.iteratee,ze=k.type,Ae=H(D);if(ze==Yu)D=Ae;else if(!Ae){if(ze==Qn)continue e;break e}}F[C++]=D}return F}K.prototype=oi(wr.prototype),K.prototype.constructor=K;function Vt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function ip(){this.__data__=Ri?Ri(null):{},this.size=0}function rp(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function sp(e){var t=this.__data__;if(Ri){var s=t[e];return s===b?i:s}return J.call(t,e)?t[e]:i}function np(e){var t=this.__data__;return Ri?t[e]!==i:J.call(t,e)}function ap(e,t){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Ri&&t===i?b:t,this}Vt.prototype.clear=ip,Vt.prototype.delete=rp,Vt.prototype.get=sp,Vt.prototype.has=np,Vt.prototype.set=ap;function dt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function op(){this.__data__=[],this.size=0}function cp(e){var t=this.__data__,s=_r(t,e);if(s<0)return!1;var o=t.length-1;return s==o?t.pop():dr.call(t,s,1),--this.size,!0}function up(e){var t=this.__data__,s=_r(t,e);return s<0?i:t[s][1]}function hp(e){return _r(this.__data__,e)>-1}function lp(e,t){var s=this.__data__,o=_r(s,e);return o<0?(++this.size,s.push([e,t])):s[o][1]=t,this}dt.prototype.clear=op,dt.prototype.delete=cp,dt.prototype.get=up,dt.prototype.has=hp,dt.prototype.set=lp;function gt(e){var t=-1,s=e==null?0:e.length;for(this.clear();++t<s;){var o=e[t];this.set(o[0],o[1])}}function pp(){this.size=0,this.__data__={hash:new Vt,map:new(xi||dt),string:new Vt}}function dp(e){var t=Fr(this,e).delete(e);return this.size-=t?1:0,t}function gp(e){return Fr(this,e).get(e)}function fp(e){return Fr(this,e).has(e)}function vp(e,t){var s=Fr(this,e),o=s.size;return s.set(e,t),this.size+=s.size==o?0:1,this}gt.prototype.clear=pp,gt.prototype.delete=dp,gt.prototype.get=gp,gt.prototype.has=fp,gt.prototype.set=vp;function Kt(e){var t=-1,s=e==null?0:e.length;for(this.__data__=new gt;++t<s;)this.add(e[t])}function yp(e){return this.__data__.set(e,b),this}function mp(e){return this.__data__.has(e)}Kt.prototype.add=Kt.prototype.push=yp,Kt.prototype.has=mp;function it(e){var t=this.__data__=new dt(e);this.size=t.size}function wp(){this.__data__=new dt,this.size=0}function _p(e){var t=this.__data__,s=t.delete(e);return this.size=t.size,s}function bp(e){return this.__data__.get(e)}function Ep(e){return this.__data__.has(e)}function Ip(e,t){var s=this.__data__;if(s instanceof dt){var o=s.__data__;if(!xi||o.length<a-1)return o.push([e,t]),this.size=++s.size,this;s=this.__data__=new gt(o)}return s.set(e,t),this.size=s.size,this}it.prototype.clear=wp,it.prototype.delete=_p,it.prototype.get=bp,it.prototype.has=Ep,it.prototype.set=Ip;function Wa(e,t){var s=j(e),o=!s&&Yt(e),c=!s&&!o&&Dt(e),l=!s&&!o&&!c&&li(e),d=s||o||c||l,f=d?Es(e.length,Dl):[],y=f.length;for(var E in e)(t||J.call(e,E))&&!(d&&(E=="length"||c&&(E=="offset"||E=="parent")||l&&(E=="buffer"||E=="byteLength"||E=="byteOffset")||mt(E,y)))&&f.push(E);return f}function Ya(e){var t=e.length;return t?e[zs(0,t-1)]:i}function Pp(e,t){return Dr(Ne(e),Ht(t,0,e.length))}function Sp(e){return Dr(Ne(e))}function Rs(e,t,s){(s!==i&&!rt(e[t],s)||s===i&&!(t in e))&&ft(e,t,s)}function Oi(e,t,s){var o=e[t];(!(J.call(e,t)&&rt(o,s))||s===i&&!(t in e))&&ft(e,t,s)}function _r(e,t){for(var s=e.length;s--;)if(rt(e[s][0],t))return s;return-1}function Cp(e,t,s,o){return Rt(e,function(c,l,d){t(o,c,s(c),d)}),o}function Ja(e,t){return e&&ct(t,ye(t),e)}function xp(e,t){return e&&ct(t,Fe(t),e)}function ft(e,t,s){t=="__proto__"&&gr?gr(e,t,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[t]=s}function Ns(e,t){for(var s=-1,o=t.length,c=w(o),l=e==null;++s<o;)c[s]=l?i:ln(e,t[s]);return c}function Ht(e,t,s){return e===e&&(s!==i&&(e=e<=s?e:s),t!==i&&(e=e>=t?e:t)),e}function He(e,t,s,o,c,l){var d,f=t&V,y=t&M,E=t&Z;if(s&&(d=c?s(e,o,c,l):s(e)),d!==i)return d;if(!oe(e))return e;var I=j(e);if(I){if(d=fd(e),!f)return Ne(e,d)}else{var P=Ee(e),C=P==Zi||P==Zn;if(Dt(e))return bo(e,f);if(P==pt||P==Qt||C&&!c){if(d=y||C?{}:Lo(e),!f)return y?sd(e,xp(d,e)):rd(e,Ja(d,e))}else{if(!ee[P])return c?e:{};d=vd(e,P,f)}}l||(l=new it);var R=l.get(e);if(R)return R;l.set(e,d),fc(e)?e.forEach(function(D){d.add(He(D,t,s,D,e,l))}):dc(e)&&e.forEach(function(D,k){d.set(k,He(D,t,s,k,e,l))});var F=E?y?Js:Ys:y?Fe:ye,L=I?i:F(e);return ke(L||e,function(D,k){L&&(k=D,D=e[k]),Oi(d,k,He(D,t,s,k,e,l))}),d}function Ap(e){var t=ye(e);return function(s){return Qa(s,e,t)}}function Qa(e,t,s){var o=s.length;if(e==null)return!o;for(e=X(e);o--;){var c=s[o],l=t[c],d=e[c];if(d===i&&!(c in e)||!l(d))return!1}return!0}function Za(e,t,s){if(typeof e!="function")throw new Ve(g);return Mi(function(){e.apply(i,s)},t)}function Fi(e,t,s,o){var c=-1,l=rr,d=!0,f=e.length,y=[],E=t.length;if(!f)return y;s&&(t=ae(t,qe(s))),o?(l=vs,d=!1):t.length>=a&&(l=Si,d=!1,t=new Kt(t));e:for(;++c<f;){var I=e[c],P=s==null?I:s(I);if(I=o||I!==0?I:0,d&&P===P){for(var C=E;C--;)if(t[C]===P)continue e;y.push(I)}else l(t,P,o)||y.push(I)}return y}var Rt=Co(ot),Xa=Co(Fs,!0);function Rp(e,t){var s=!0;return Rt(e,function(o,c,l){return s=!!t(o,c,l),s}),s}function br(e,t,s){for(var o=-1,c=e.length;++o<c;){var l=e[o],d=t(l);if(d!=null&&(f===i?d===d&&!Me(d):s(d,f)))var f=d,y=l}return y}function Np(e,t,s,o){var c=e.length;for(s=z(s),s<0&&(s=-s>c?0:c+s),o=o===i||o>c?c:z(o),o<0&&(o+=c),o=s>o?0:yc(o);s<o;)e[s++]=t;return e}function eo(e,t){var s=[];return Rt(e,function(o,c,l){t(o,c,l)&&s.push(o)}),s}function we(e,t,s,o,c){var l=-1,d=e.length;for(s||(s=md),c||(c=[]);++l<d;){var f=e[l];t>0&&s(f)?t>1?we(f,t-1,s,o,c):Ct(c,f):o||(c[c.length]=f)}return c}var Os=xo(),to=xo(!0);function ot(e,t){return e&&Os(e,t,ye)}function Fs(e,t){return e&&to(e,t,ye)}function Er(e,t){return St(t,function(s){return wt(e[s])})}function Bt(e,t){t=Ot(t,e);for(var s=0,o=t.length;e!=null&&s<o;)e=e[ut(t[s++])];return s&&s==o?e:i}function io(e,t,s){var o=t(e);return j(e)?o:Ct(o,s(e))}function Ce(e){return e==null?e===i?nh:rh:kt&&kt in X(e)?pd(e):Sd(e)}function Ds(e,t){return e>t}function Op(e,t){return e!=null&&J.call(e,t)}function Fp(e,t){return e!=null&&t in X(e)}function Dp(e,t,s){return e>=be(t,s)&&e<ve(t,s)}function $s(e,t,s){for(var o=s?vs:rr,c=e[0].length,l=e.length,d=l,f=w(l),y=1/0,E=[];d--;){var I=e[d];d&&t&&(I=ae(I,qe(t))),y=be(I.length,y),f[d]=!s&&(t||c>=120&&I.length>=120)?new Kt(d&&I):i}I=e[0];var P=-1,C=f[0];e:for(;++P<c&&E.length<y;){var R=I[P],F=t?t(R):R;if(R=s||R!==0?R:0,!(C?Si(C,F):o(E,F,s))){for(d=l;--d;){var L=f[d];if(!(L?Si(L,F):o(e[d],F,s)))continue e}C&&C.push(F),E.push(R)}}return E}function $p(e,t,s,o){return ot(e,function(c,l,d){t(o,s(c),l,d)}),o}function Di(e,t,s){t=Ot(t,e),e=Ko(e,t);var o=e==null?e:e[ut(Ge(t))];return o==null?i:Te(o,e,s)}function ro(e){return ce(e)&&Ce(e)==Qt}function Tp(e){return ce(e)&&Ce(e)==Pi}function qp(e){return ce(e)&&Ce(e)==wi}function $i(e,t,s,o,c){return e===t?!0:e==null||t==null||!ce(e)&&!ce(t)?e!==e&&t!==t:jp(e,t,s,o,$i,c)}function jp(e,t,s,o,c,l){var d=j(e),f=j(t),y=d?Ji:Ee(e),E=f?Ji:Ee(t);y=y==Qt?pt:y,E=E==Qt?pt:E;var I=y==pt,P=E==pt,C=y==E;if(C&&Dt(e)){if(!Dt(t))return!1;d=!0,I=!1}if(C&&!I)return l||(l=new it),d||li(e)?jo(e,t,s,o,c,l):hd(e,t,y,s,o,c,l);if(!(s&T)){var R=I&&J.call(e,"__wrapped__"),F=P&&J.call(t,"__wrapped__");if(R||F){var L=R?e.value():e,D=F?t.value():t;return l||(l=new it),c(L,D,s,o,l)}}return C?(l||(l=new it),ld(e,t,s,o,c,l)):!1}function Mp(e){return ce(e)&&Ee(e)==Xe}function Ts(e,t,s,o){var c=s.length,l=c,d=!o;if(e==null)return!l;for(e=X(e);c--;){var f=s[c];if(d&&f[2]?f[1]!==e[f[0]]:!(f[0]in e))return!1}for(;++c<l;){f=s[c];var y=f[0],E=e[y],I=f[1];if(d&&f[2]){if(E===i&&!(y in e))return!1}else{var P=new it;if(o)var C=o(E,I,y,e,t,P);if(!(C===i?$i(I,E,T|te,o,P):C))return!1}}return!0}function so(e){if(!oe(e)||_d(e))return!1;var t=wt(e)?Ml:Ah;return t.test(Wt(e))}function zp(e){return ce(e)&&Ce(e)==bi}function Lp(e){return ce(e)&&Ee(e)==et}function Up(e){return ce(e)&&zr(e.length)&&!!ie[Ce(e)]}function no(e){return typeof e=="function"?e:e==null?De:typeof e=="object"?j(e)?co(e[0],e[1]):oo(e):Ac(e)}function qs(e){if(!ji(e))return Kl(e);var t=[];for(var s in X(e))J.call(e,s)&&s!="constructor"&&t.push(s);return t}function kp(e){if(!oe(e))return Pd(e);var t=ji(e),s=[];for(var o in e)o=="constructor"&&(t||!J.call(e,o))||s.push(o);return s}function js(e,t){return e<t}function ao(e,t){var s=-1,o=Oe(e)?w(e.length):[];return Rt(e,function(c,l,d){o[++s]=t(c,l,d)}),o}function oo(e){var t=Zs(e);return t.length==1&&t[0][2]?ko(t[0][0],t[0][1]):function(s){return s===e||Ts(s,e,t)}}function co(e,t){return en(e)&&Uo(t)?ko(ut(e),t):function(s){var o=ln(s,e);return o===i&&o===t?pn(s,e):$i(t,o,T|te)}}function Ir(e,t,s,o,c){e!==t&&Os(t,function(l,d){if(c||(c=new it),oe(l))Vp(e,t,d,s,Ir,o,c);else{var f=o?o(rn(e,d),l,d+"",e,t,c):i;f===i&&(f=l),Rs(e,d,f)}},Fe)}function Vp(e,t,s,o,c,l,d){var f=rn(e,s),y=rn(t,s),E=d.get(y);if(E){Rs(e,s,E);return}var I=l?l(f,y,s+"",e,t,d):i,P=I===i;if(P){var C=j(y),R=!C&&Dt(y),F=!C&&!R&&li(y);I=y,C||R||F?j(f)?I=f:le(f)?I=Ne(f):R?(P=!1,I=bo(y,!0)):F?(P=!1,I=Eo(y,!0)):I=[]:zi(y)||Yt(y)?(I=f,Yt(f)?I=mc(f):(!oe(f)||wt(f))&&(I=Lo(y))):P=!1}P&&(d.set(y,I),c(I,y,o,l,d),d.delete(y)),Rs(e,s,I)}function uo(e,t){var s=e.length;if(s)return t+=t<0?s:0,mt(t,s)?e[t]:i}function ho(e,t,s){t.length?t=ae(t,function(l){return j(l)?function(d){return Bt(d,l.length===1?l[0]:l)}:l}):t=[De];var o=-1;t=ae(t,qe(N()));var c=ao(e,function(l,d,f){var y=ae(t,function(E){return E(l)});return{criteria:y,index:++o,value:l}});return vl(c,function(l,d){return id(l,d,s)})}function Kp(e,t){return lo(e,t,function(s,o){return pn(e,o)})}function lo(e,t,s){for(var o=-1,c=t.length,l={};++o<c;){var d=t[o],f=Bt(e,d);s(f,d)&&Ti(l,Ot(d,e),f)}return l}function Hp(e){return function(t){return Bt(t,e)}}function Ms(e,t,s,o){var c=o?fl:ei,l=-1,d=t.length,f=e;for(e===t&&(t=Ne(t)),s&&(f=ae(e,qe(s)));++l<d;)for(var y=0,E=t[l],I=s?s(E):E;(y=c(f,I,y,o))>-1;)f!==e&&dr.call(f,y,1),dr.call(e,y,1);return e}function po(e,t){for(var s=e?t.length:0,o=s-1;s--;){var c=t[s];if(s==o||c!==l){var l=c;mt(c)?dr.call(e,c,1):ks(e,c)}}return e}function zs(e,t){return e+vr(Ba()*(t-e+1))}function Bp(e,t,s,o){for(var c=-1,l=ve(fr((t-e)/(s||1)),0),d=w(l);l--;)d[o?l:++c]=e,e+=s;return d}function Ls(e,t){var s="";if(!e||t<1||t>Pt)return s;do t%2&&(s+=e),t=vr(t/2),t&&(e+=e);while(t);return s}function U(e,t){return sn(Vo(e,t,De),e+"")}function Gp(e){return Ya(pi(e))}function Wp(e,t){var s=pi(e);return Dr(s,Ht(t,0,s.length))}function Ti(e,t,s,o){if(!oe(e))return e;t=Ot(t,e);for(var c=-1,l=t.length,d=l-1,f=e;f!=null&&++c<l;){var y=ut(t[c]),E=s;if(y==="__proto__"||y==="constructor"||y==="prototype")return e;if(c!=d){var I=f[y];E=o?o(I,y,f):i,E===i&&(E=oe(I)?I:mt(t[c+1])?[]:{})}Oi(f,y,E),f=f[y]}return e}var go=yr?function(e,t){return yr.set(e,t),e}:De,Yp=gr?function(e,t){return gr(e,"toString",{configurable:!0,enumerable:!1,value:gn(t),writable:!0})}:De;function Jp(e){return Dr(pi(e))}function Be(e,t,s){var o=-1,c=e.length;t<0&&(t=-t>c?0:c+t),s=s>c?c:s,s<0&&(s+=c),c=t>s?0:s-t>>>0,t>>>=0;for(var l=w(c);++o<c;)l[o]=e[o+t];return l}function Qp(e,t){var s;return Rt(e,function(o,c,l){return s=t(o,c,l),!s}),!!s}function Pr(e,t,s){var o=0,c=e==null?o:e.length;if(typeof t=="number"&&t===t&&c<=Xu){for(;o<c;){var l=o+c>>>1,d=e[l];d!==null&&!Me(d)&&(s?d<=t:d<t)?o=l+1:c=l}return c}return Us(e,t,De,s)}function Us(e,t,s,o){var c=0,l=e==null?0:e.length;if(l===0)return 0;t=s(t);for(var d=t!==t,f=t===null,y=Me(t),E=t===i;c<l;){var I=vr((c+l)/2),P=s(e[I]),C=P!==i,R=P===null,F=P===P,L=Me(P);if(d)var D=o||F;else E?D=F&&(o||C):f?D=F&&C&&(o||!R):y?D=F&&C&&!R&&(o||!L):R||L?D=!1:D=o?P<=t:P<t;D?c=I+1:l=I}return be(l,Zu)}function fo(e,t){for(var s=-1,o=e.length,c=0,l=[];++s<o;){var d=e[s],f=t?t(d):d;if(!s||!rt(f,y)){var y=f;l[c++]=d===0?0:d}}return l}function vo(e){return typeof e=="number"?e:Me(e)?Yi:+e}function je(e){if(typeof e=="string")return e;if(j(e))return ae(e,je)+"";if(Me(e))return Ga?Ga.call(e):"";var t=e+"";return t=="0"&&1/e==-Lt?"-0":t}function Nt(e,t,s){var o=-1,c=rr,l=e.length,d=!0,f=[],y=f;if(s)d=!1,c=vs;else if(l>=a){var E=t?null:cd(e);if(E)return nr(E);d=!1,c=Si,y=new Kt}else y=t?[]:f;e:for(;++o<l;){var I=e[o],P=t?t(I):I;if(I=s||I!==0?I:0,d&&P===P){for(var C=y.length;C--;)if(y[C]===P)continue e;t&&y.push(P),f.push(I)}else c(y,P,s)||(y!==f&&y.push(P),f.push(I))}return f}function ks(e,t){return t=Ot(t,e),e=Ko(e,t),e==null||delete e[ut(Ge(t))]}function yo(e,t,s,o){return Ti(e,t,s(Bt(e,t)),o)}function Sr(e,t,s,o){for(var c=e.length,l=o?c:-1;(o?l--:++l<c)&&t(e[l],l,e););return s?Be(e,o?0:l,o?l+1:c):Be(e,o?l+1:0,o?c:l)}function mo(e,t){var s=e;return s instanceof K&&(s=s.value()),ys(t,function(o,c){return c.func.apply(c.thisArg,Ct([o],c.args))},s)}function Vs(e,t,s){var o=e.length;if(o<2)return o?Nt(e[0]):[];for(var c=-1,l=w(o);++c<o;)for(var d=e[c],f=-1;++f<o;)f!=c&&(l[c]=Fi(l[c]||d,e[f],t,s));return Nt(we(l,1),t,s)}function wo(e,t,s){for(var o=-1,c=e.length,l=t.length,d={};++o<c;){var f=o<l?t[o]:i;s(d,e[o],f)}return d}function Ks(e){return le(e)?e:[]}function Hs(e){return typeof e=="function"?e:De}function Ot(e,t){return j(e)?e:en(e,t)?[e]:Wo(Y(e))}var Zp=U;function Ft(e,t,s){var o=e.length;return s=s===i?o:s,!t&&s>=o?e:Be(e,t,s)}var _o=zl||function(e){return me.clearTimeout(e)};function bo(e,t){if(t)return e.slice();var s=e.length,o=Ua?Ua(s):new e.constructor(s);return e.copy(o),o}function Bs(e){var t=new e.constructor(e.byteLength);return new lr(t).set(new lr(e)),t}function Xp(e,t){var s=t?Bs(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.byteLength)}function ed(e){var t=new e.constructor(e.source,ra.exec(e));return t.lastIndex=e.lastIndex,t}function td(e){return Ni?X(Ni.call(e)):{}}function Eo(e,t){var s=t?Bs(e.buffer):e.buffer;return new e.constructor(s,e.byteOffset,e.length)}function Io(e,t){if(e!==t){var s=e!==i,o=e===null,c=e===e,l=Me(e),d=t!==i,f=t===null,y=t===t,E=Me(t);if(!f&&!E&&!l&&e>t||l&&d&&y&&!f&&!E||o&&d&&y||!s&&y||!c)return 1;if(!o&&!l&&!E&&e<t||E&&s&&c&&!o&&!l||f&&s&&c||!d&&c||!y)return-1}return 0}function id(e,t,s){for(var o=-1,c=e.criteria,l=t.criteria,d=c.length,f=s.length;++o<d;){var y=Io(c[o],l[o]);if(y){if(o>=f)return y;var E=s[o];return y*(E=="desc"?-1:1)}}return e.index-t.index}function Po(e,t,s,o){for(var c=-1,l=e.length,d=s.length,f=-1,y=t.length,E=ve(l-d,0),I=w(y+E),P=!o;++f<y;)I[f]=t[f];for(;++c<d;)(P||c<l)&&(I[s[c]]=e[c]);for(;E--;)I[f++]=e[c++];return I}function So(e,t,s,o){for(var c=-1,l=e.length,d=-1,f=s.length,y=-1,E=t.length,I=ve(l-f,0),P=w(I+E),C=!o;++c<I;)P[c]=e[c];for(var R=c;++y<E;)P[R+y]=t[y];for(;++d<f;)(C||c<l)&&(P[R+s[d]]=e[c++]);return P}function Ne(e,t){var s=-1,o=e.length;for(t||(t=w(o));++s<o;)t[s]=e[s];return t}function ct(e,t,s,o){var c=!s;s||(s={});for(var l=-1,d=t.length;++l<d;){var f=t[l],y=o?o(s[f],e[f],f,s,e):i;y===i&&(y=e[f]),c?ft(s,f,y):Oi(s,f,y)}return s}function rd(e,t){return ct(e,Xs(e),t)}function sd(e,t){return ct(e,Mo(e),t)}function Cr(e,t){return function(s,o){var c=j(s)?ul:Cp,l=t?t():{};return c(s,e,N(o,2),l)}}function ci(e){return U(function(t,s){var o=-1,c=s.length,l=c>1?s[c-1]:i,d=c>2?s[2]:i;for(l=e.length>3&&typeof l=="function"?(c--,l):i,d&&xe(s[0],s[1],d)&&(l=c<3?i:l,c=1),t=X(t);++o<c;){var f=s[o];f&&e(t,f,o,l)}return t})}function Co(e,t){return function(s,o){if(s==null)return s;if(!Oe(s))return e(s,o);for(var c=s.length,l=t?c:-1,d=X(s);(t?l--:++l<c)&&o(d[l],l,d)!==!1;);return s}}function xo(e){return function(t,s,o){for(var c=-1,l=X(t),d=o(t),f=d.length;f--;){var y=d[e?f:++c];if(s(l[y],y,l)===!1)break}return t}}function nd(e,t,s){var o=t&re,c=qi(e);function l(){var d=this&&this!==me&&this instanceof l?c:e;return d.apply(o?s:this,arguments)}return l}function Ao(e){return function(t){t=Y(t);var s=ti(t)?tt(t):i,o=s?s[0]:t.charAt(0),c=s?Ft(s,1).join(""):t.slice(1);return o[e]()+c}}function ui(e){return function(t){return ys(Cc(Sc(t).replace(Yh,"")),e,"")}}function qi(e){return function(){var t=arguments;switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3]);case 5:return new e(t[0],t[1],t[2],t[3],t[4]);case 6:return new e(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new e(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}var s=oi(e.prototype),o=e.apply(s,t);return oe(o)?o:s}}function ad(e,t,s){var o=qi(e);function c(){for(var l=arguments.length,d=w(l),f=l,y=hi(c);f--;)d[f]=arguments[f];var E=l<3&&d[0]!==y&&d[l-1]!==y?[]:xt(d,y);if(l-=E.length,l<s)return Do(e,t,xr,c.placeholder,i,d,E,i,i,s-l);var I=this&&this!==me&&this instanceof c?o:e;return Te(I,this,d)}return c}function Ro(e){return function(t,s,o){var c=X(t);if(!Oe(t)){var l=N(s,3);t=ye(t),s=function(f){return l(c[f],f,c)}}var d=e(t,s,o);return d>-1?c[l?t[d]:d]:i}}function No(e){return yt(function(t){var s=t.length,o=s,c=Ke.prototype.thru;for(e&&t.reverse();o--;){var l=t[o];if(typeof l!="function")throw new Ve(g);if(c&&!d&&Or(l)=="wrapper")var d=new Ke([],!0)}for(o=d?o:s;++o<s;){l=t[o];var f=Or(l),y=f=="wrapper"?Qs(l):i;y&&tn(y[0])&&y[1]==(he|Q|ne|Se)&&!y[4].length&&y[9]==1?d=d[Or(y[0])].apply(d,y[3]):d=l.length==1&&tn(l)?d[f]():d.thru(l)}return function(){var E=arguments,I=E[0];if(d&&E.length==1&&j(I))return d.plant(I).value();for(var P=0,C=s?t[P].apply(this,E):I;++P<s;)C=t[P].call(this,C);return C}})}function xr(e,t,s,o,c,l,d,f,y,E){var I=t&he,P=t&re,C=t&se,R=t&(Q|G),F=t&It,L=C?i:qi(e);function D(){for(var k=arguments.length,H=w(k),ze=k;ze--;)H[ze]=arguments[ze];if(R)var Ae=hi(D),Le=ml(H,Ae);if(o&&(H=Po(H,o,c,R)),l&&(H=So(H,l,d,R)),k-=Le,R&&k<E){var pe=xt(H,Ae);return Do(e,t,xr,D.placeholder,s,H,pe,f,y,E-k)}var st=P?s:this,bt=C?st[e]:e;return k=H.length,f?H=Cd(H,f):F&&k>1&&H.reverse(),I&&y<k&&(H.length=y),this&&this!==me&&this instanceof D&&(bt=L||qi(bt)),bt.apply(st,H)}return D}function Oo(e,t){return function(s,o){return $p(s,e,t(o),{})}}function Ar(e,t){return function(s,o){var c;if(s===i&&o===i)return t;if(s!==i&&(c=s),o!==i){if(c===i)return o;typeof s=="string"||typeof o=="string"?(s=je(s),o=je(o)):(s=vo(s),o=vo(o)),c=e(s,o)}return c}}function Gs(e){return yt(function(t){return t=ae(t,qe(N())),U(function(s){var o=this;return e(t,function(c){return Te(c,o,s)})})})}function Rr(e,t){t=t===i?" ":je(t);var s=t.length;if(s<2)return s?Ls(t,e):t;var o=Ls(t,fr(e/ii(t)));return ti(t)?Ft(tt(o),0,e).join(""):o.slice(0,e)}function od(e,t,s,o){var c=t&re,l=qi(e);function d(){for(var f=-1,y=arguments.length,E=-1,I=o.length,P=w(I+y),C=this&&this!==me&&this instanceof d?l:e;++E<I;)P[E]=o[E];for(;y--;)P[E++]=arguments[++f];return Te(C,c?s:this,P)}return d}function Fo(e){return function(t,s,o){return o&&typeof o!="number"&&xe(t,s,o)&&(s=o=i),t=_t(t),s===i?(s=t,t=0):s=_t(s),o=o===i?t<s?1:-1:_t(o),Bp(t,s,o,e)}}function Nr(e){return function(t,s){return typeof t=="string"&&typeof s=="string"||(t=We(t),s=We(s)),e(t,s)}}function Do(e,t,s,o,c,l,d,f,y,E){var I=t&Q,P=I?d:i,C=I?i:d,R=I?l:i,F=I?i:l;t|=I?ne:Pe,t&=~(I?Pe:ne),t&Ie||(t&=~(re|se));var L=[e,t,c,R,P,F,C,f,y,E],D=s.apply(i,L);return tn(e)&&Ho(D,L),D.placeholder=o,Bo(D,e,t)}function Ws(e){var t=fe[e];return function(s,o){if(s=We(s),o=o==null?0:be(z(o),292),o&&Ha(s)){var c=(Y(s)+"e").split("e"),l=t(c[0]+"e"+(+c[1]+o));return c=(Y(l)+"e").split("e"),+(c[0]+"e"+(+c[1]-o))}return t(s)}}var cd=ni&&1/nr(new ni([,-0]))[1]==Lt?function(e){return new ni(e)}:yn;function $o(e){return function(t){var s=Ee(t);return s==Xe?Ps(t):s==et?Sl(t):yl(t,e(t))}}function vt(e,t,s,o,c,l,d,f){var y=t&se;if(!y&&typeof e!="function")throw new Ve(g);var E=o?o.length:0;if(E||(t&=~(ne|Pe),o=c=i),d=d===i?d:ve(z(d),0),f=f===i?f:z(f),E-=c?c.length:0,t&Pe){var I=o,P=c;o=c=i}var C=y?i:Qs(e),R=[e,t,s,o,c,I,P,l,d,f];if(C&&Id(R,C),e=R[0],t=R[1],s=R[2],o=R[3],c=R[4],f=R[9]=R[9]===i?y?0:e.length:ve(R[9]-E,0),!f&&t&(Q|G)&&(t&=~(Q|G)),!t||t==re)var F=nd(e,t,s);else t==Q||t==G?F=ad(e,t,f):(t==ne||t==(re|ne))&&!c.length?F=od(e,t,s,o):F=xr.apply(i,R);var L=C?go:Ho;return Bo(L(F,R),e,t)}function To(e,t,s,o){return e===i||rt(e,si[s])&&!J.call(o,s)?t:e}function qo(e,t,s,o,c,l){return oe(e)&&oe(t)&&(l.set(t,e),Ir(e,t,i,qo,l),l.delete(t)),e}function ud(e){return zi(e)?i:e}function jo(e,t,s,o,c,l){var d=s&T,f=e.length,y=t.length;if(f!=y&&!(d&&y>f))return!1;var E=l.get(e),I=l.get(t);if(E&&I)return E==t&&I==e;var P=-1,C=!0,R=s&te?new Kt:i;for(l.set(e,t),l.set(t,e);++P<f;){var F=e[P],L=t[P];if(o)var D=d?o(L,F,P,t,e,l):o(F,L,P,e,t,l);if(D!==i){if(D)continue;C=!1;break}if(R){if(!ms(t,function(k,H){if(!Si(R,H)&&(F===k||c(F,k,s,o,l)))return R.push(H)})){C=!1;break}}else if(!(F===L||c(F,L,s,o,l))){C=!1;break}}return l.delete(e),l.delete(t),C}function hd(e,t,s,o,c,l,d){switch(s){case Zt:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)return!1;e=e.buffer,t=t.buffer;case Pi:return!(e.byteLength!=t.byteLength||!l(new lr(e),new lr(t)));case mi:case wi:case _i:return rt(+e,+t);case Qi:return e.name==t.name&&e.message==t.message;case bi:case Ei:return e==t+"";case Xe:var f=Ps;case et:var y=o&T;if(f||(f=nr),e.size!=t.size&&!y)return!1;var E=d.get(e);if(E)return E==t;o|=te,d.set(e,t);var I=jo(f(e),f(t),o,c,l,d);return d.delete(e),I;case Xi:if(Ni)return Ni.call(e)==Ni.call(t)}return!1}function ld(e,t,s,o,c,l){var d=s&T,f=Ys(e),y=f.length,E=Ys(t),I=E.length;if(y!=I&&!d)return!1;for(var P=y;P--;){var C=f[P];if(!(d?C in t:J.call(t,C)))return!1}var R=l.get(e),F=l.get(t);if(R&&F)return R==t&&F==e;var L=!0;l.set(e,t),l.set(t,e);for(var D=d;++P<y;){C=f[P];var k=e[C],H=t[C];if(o)var ze=d?o(H,k,C,t,e,l):o(k,H,C,e,t,l);if(!(ze===i?k===H||c(k,H,s,o,l):ze)){L=!1;break}D||(D=C=="constructor")}if(L&&!D){var Ae=e.constructor,Le=t.constructor;Ae!=Le&&"constructor"in e&&"constructor"in t&&!(typeof Ae=="function"&&Ae instanceof Ae&&typeof Le=="function"&&Le instanceof Le)&&(L=!1)}return l.delete(e),l.delete(t),L}function yt(e){return sn(Vo(e,i,Zo),e+"")}function Ys(e){return io(e,ye,Xs)}function Js(e){return io(e,Fe,Mo)}var Qs=yr?function(e){return yr.get(e)}:yn;function Or(e){for(var t=e.name+"",s=ai[t],o=J.call(ai,t)?s.length:0;o--;){var c=s[o],l=c.func;if(l==null||l==e)return c.name}return t}function hi(e){var t=J.call(u,"placeholder")?u:e;return t.placeholder}function N(){var e=u.iteratee||fn;return e=e===fn?no:e,arguments.length?e(arguments[0],arguments[1]):e}function Fr(e,t){var s=e.__data__;return wd(t)?s[typeof t=="string"?"string":"hash"]:s.map}function Zs(e){for(var t=ye(e),s=t.length;s--;){var o=t[s],c=e[o];t[s]=[o,c,Uo(c)]}return t}function Gt(e,t){var s=El(e,t);return so(s)?s:i}function pd(e){var t=J.call(e,kt),s=e[kt];try{e[kt]=i;var o=!0}catch{}var c=ur.call(e);return o&&(t?e[kt]=s:delete e[kt]),c}var Xs=Cs?function(e){return e==null?[]:(e=X(e),St(Cs(e),function(t){return Va.call(e,t)}))}:mn,Mo=Cs?function(e){for(var t=[];e;)Ct(t,Xs(e)),e=pr(e);return t}:mn,Ee=Ce;(xs&&Ee(new xs(new ArrayBuffer(1)))!=Zt||xi&&Ee(new xi)!=Xe||As&&Ee(As.resolve())!=Xn||ni&&Ee(new ni)!=et||Ai&&Ee(new Ai)!=Ii)&&(Ee=function(e){var t=Ce(e),s=t==pt?e.constructor:i,o=s?Wt(s):"";if(o)switch(o){case Wl:return Zt;case Yl:return Xe;case Jl:return Xn;case Ql:return et;case Zl:return Ii}return t});function dd(e,t,s){for(var o=-1,c=s.length;++o<c;){var l=s[o],d=l.size;switch(l.type){case"drop":e+=d;break;case"dropRight":t-=d;break;case"take":t=be(t,e+d);break;case"takeRight":e=ve(e,t-d);break}}return{start:e,end:t}}function gd(e){var t=e.match(_h);return t?t[1].split(bh):[]}function zo(e,t,s){t=Ot(t,e);for(var o=-1,c=t.length,l=!1;++o<c;){var d=ut(t[o]);if(!(l=e!=null&&s(e,d)))break;e=e[d]}return l||++o!=c?l:(c=e==null?0:e.length,!!c&&zr(c)&&mt(d,c)&&(j(e)||Yt(e)))}function fd(e){var t=e.length,s=new e.constructor(t);return t&&typeof e[0]=="string"&&J.call(e,"index")&&(s.index=e.index,s.input=e.input),s}function Lo(e){return typeof e.constructor=="function"&&!ji(e)?oi(pr(e)):{}}function vd(e,t,s){var o=e.constructor;switch(t){case Pi:return Bs(e);case mi:case wi:return new o(+e);case Zt:return Xp(e,s);case Zr:case Xr:case es:case ts:case is:case rs:case ss:case ns:case as:return Eo(e,s);case Xe:return new o;case _i:case Ei:return new o(e);case bi:return ed(e);case et:return new o;case Xi:return td(e)}}function yd(e,t){var s=t.length;if(!s)return e;var o=s-1;return t[o]=(s>1?"& ":"")+t[o],t=t.join(s>2?", ":" "),e.replace(wh,`{
/* [wrapped with `+t+`] */
`)}function md(e){return j(e)||Yt(e)||!!(Ka&&e&&e[Ka])}function mt(e,t){var s=typeof e;return t=t??Pt,!!t&&(s=="number"||s!="symbol"&&Nh.test(e))&&e>-1&&e%1==0&&e<t}function xe(e,t,s){if(!oe(s))return!1;var o=typeof t;return(o=="number"?Oe(s)&&mt(t,s.length):o=="string"&&t in s)?rt(s[t],e):!1}function en(e,t){if(j(e))return!1;var s=typeof e;return s=="number"||s=="symbol"||s=="boolean"||e==null||Me(e)?!0:fh.test(e)||!gh.test(e)||t!=null&&e in X(t)}function wd(e){var t=typeof e;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?e!=="__proto__":e===null}function tn(e){var t=Or(e),s=u[t];if(typeof s!="function"||!(t in K.prototype))return!1;if(e===s)return!0;var o=Qs(s);return!!o&&e===o[0]}function _d(e){return!!La&&La in e}var bd=or?wt:wn;function ji(e){var t=e&&e.constructor,s=typeof t=="function"&&t.prototype||si;return e===s}function Uo(e){return e===e&&!oe(e)}function ko(e,t){return function(s){return s==null?!1:s[e]===t&&(t!==i||e in X(s))}}function Ed(e){var t=jr(e,function(o){return s.size===S&&s.clear(),o}),s=t.cache;return t}function Id(e,t){var s=e[1],o=t[1],c=s|o,l=c<(re|se|he),d=o==he&&s==Q||o==he&&s==Se&&e[7].length<=t[8]||o==(he|Se)&&t[7].length<=t[8]&&s==Q;if(!(l||d))return e;o&re&&(e[2]=t[2],c|=s&re?0:Ie);var f=t[3];if(f){var y=e[3];e[3]=y?Po(y,f,t[4]):f,e[4]=y?xt(e[3],$):t[4]}return f=t[5],f&&(y=e[5],e[5]=y?So(y,f,t[6]):f,e[6]=y?xt(e[5],$):t[6]),f=t[7],f&&(e[7]=f),o&he&&(e[8]=e[8]==null?t[8]:be(e[8],t[8])),e[9]==null&&(e[9]=t[9]),e[0]=t[0],e[1]=c,e}function Pd(e){var t=[];if(e!=null)for(var s in X(e))t.push(s);return t}function Sd(e){return ur.call(e)}function Vo(e,t,s){return t=ve(t===i?e.length-1:t,0),function(){for(var o=arguments,c=-1,l=ve(o.length-t,0),d=w(l);++c<l;)d[c]=o[t+c];c=-1;for(var f=w(t+1);++c<t;)f[c]=o[c];return f[t]=s(d),Te(e,this,f)}}function Ko(e,t){return t.length<2?e:Bt(e,Be(t,0,-1))}function Cd(e,t){for(var s=e.length,o=be(t.length,s),c=Ne(e);o--;){var l=t[o];e[o]=mt(l,s)?c[l]:i}return e}function rn(e,t){if(!(t==="constructor"&&typeof e[t]=="function")&&t!="__proto__")return e[t]}var Ho=Go(go),Mi=Ul||function(e,t){return me.setTimeout(e,t)},sn=Go(Yp);function Bo(e,t,s){var o=t+"";return sn(e,yd(o,xd(gd(o),s)))}function Go(e){var t=0,s=0;return function(){var o=Hl(),c=Wu-(o-s);if(s=o,c>0){if(++t>=Gu)return arguments[0]}else t=0;return e.apply(i,arguments)}}function Dr(e,t){var s=-1,o=e.length,c=o-1;for(t=t===i?o:t;++s<t;){var l=zs(s,c),d=e[l];e[l]=e[s],e[s]=d}return e.length=t,e}var Wo=Ed(function(e){var t=[];return e.charCodeAt(0)===46&&t.push(""),e.replace(vh,function(s,o,c,l){t.push(c?l.replace(Ph,"$1"):o||s)}),t});function ut(e){if(typeof e=="string"||Me(e))return e;var t=e+"";return t=="0"&&1/e==-Lt?"-0":t}function Wt(e){if(e!=null){try{return cr.call(e)}catch{}try{return e+""}catch{}}return""}function xd(e,t){return ke(eh,function(s){var o="_."+s[0];t&s[1]&&!rr(e,o)&&e.push(o)}),e.sort()}function Yo(e){if(e instanceof K)return e.clone();var t=new Ke(e.__wrapped__,e.__chain__);return t.__actions__=Ne(e.__actions__),t.__index__=e.__index__,t.__values__=e.__values__,t}function Ad(e,t,s){(s?xe(e,t,s):t===i)?t=1:t=ve(z(t),0);var o=e==null?0:e.length;if(!o||t<1)return[];for(var c=0,l=0,d=w(fr(o/t));c<o;)d[l++]=Be(e,c,c+=t);return d}function Rd(e){for(var t=-1,s=e==null?0:e.length,o=0,c=[];++t<s;){var l=e[t];l&&(c[o++]=l)}return c}function Nd(){var e=arguments.length;if(!e)return[];for(var t=w(e-1),s=arguments[0],o=e;o--;)t[o-1]=arguments[o];return Ct(j(s)?Ne(s):[s],we(t,1))}var Od=U(function(e,t){return le(e)?Fi(e,we(t,1,le,!0)):[]}),Fd=U(function(e,t){var s=Ge(t);return le(s)&&(s=i),le(e)?Fi(e,we(t,1,le,!0),N(s,2)):[]}),Dd=U(function(e,t){var s=Ge(t);return le(s)&&(s=i),le(e)?Fi(e,we(t,1,le,!0),i,s):[]});function $d(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:z(t),Be(e,t<0?0:t,o)):[]}function Td(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:z(t),t=o-t,Be(e,0,t<0?0:t)):[]}function qd(e,t){return e&&e.length?Sr(e,N(t,3),!0,!0):[]}function jd(e,t){return e&&e.length?Sr(e,N(t,3),!0):[]}function Md(e,t,s,o){var c=e==null?0:e.length;return c?(s&&typeof s!="number"&&xe(e,t,s)&&(s=0,o=c),Np(e,t,s,o)):[]}function Jo(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var c=s==null?0:z(s);return c<0&&(c=ve(o+c,0)),sr(e,N(t,3),c)}function Qo(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var c=o-1;return s!==i&&(c=z(s),c=s<0?ve(o+c,0):be(c,o-1)),sr(e,N(t,3),c,!0)}function Zo(e){var t=e==null?0:e.length;return t?we(e,1):[]}function zd(e){var t=e==null?0:e.length;return t?we(e,Lt):[]}function Ld(e,t){var s=e==null?0:e.length;return s?(t=t===i?1:z(t),we(e,t)):[]}function Ud(e){for(var t=-1,s=e==null?0:e.length,o={};++t<s;){var c=e[t];o[c[0]]=c[1]}return o}function Xo(e){return e&&e.length?e[0]:i}function kd(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var c=s==null?0:z(s);return c<0&&(c=ve(o+c,0)),ei(e,t,c)}function Vd(e){var t=e==null?0:e.length;return t?Be(e,0,-1):[]}var Kd=U(function(e){var t=ae(e,Ks);return t.length&&t[0]===e[0]?$s(t):[]}),Hd=U(function(e){var t=Ge(e),s=ae(e,Ks);return t===Ge(s)?t=i:s.pop(),s.length&&s[0]===e[0]?$s(s,N(t,2)):[]}),Bd=U(function(e){var t=Ge(e),s=ae(e,Ks);return t=typeof t=="function"?t:i,t&&s.pop(),s.length&&s[0]===e[0]?$s(s,i,t):[]});function Gd(e,t){return e==null?"":Vl.call(e,t)}function Ge(e){var t=e==null?0:e.length;return t?e[t-1]:i}function Wd(e,t,s){var o=e==null?0:e.length;if(!o)return-1;var c=o;return s!==i&&(c=z(s),c=c<0?ve(o+c,0):be(c,o-1)),t===t?xl(e,t,c):sr(e,Fa,c,!0)}function Yd(e,t){return e&&e.length?uo(e,z(t)):i}var Jd=U(ec);function ec(e,t){return e&&e.length&&t&&t.length?Ms(e,t):e}function Qd(e,t,s){return e&&e.length&&t&&t.length?Ms(e,t,N(s,2)):e}function Zd(e,t,s){return e&&e.length&&t&&t.length?Ms(e,t,i,s):e}var Xd=yt(function(e,t){var s=e==null?0:e.length,o=Ns(e,t);return po(e,ae(t,function(c){return mt(c,s)?+c:c}).sort(Io)),o});function eg(e,t){var s=[];if(!(e&&e.length))return s;var o=-1,c=[],l=e.length;for(t=N(t,3);++o<l;){var d=e[o];t(d,o,e)&&(s.push(d),c.push(o))}return po(e,c),s}function nn(e){return e==null?e:Gl.call(e)}function tg(e,t,s){var o=e==null?0:e.length;return o?(s&&typeof s!="number"&&xe(e,t,s)?(t=0,s=o):(t=t==null?0:z(t),s=s===i?o:z(s)),Be(e,t,s)):[]}function ig(e,t){return Pr(e,t)}function rg(e,t,s){return Us(e,t,N(s,2))}function sg(e,t){var s=e==null?0:e.length;if(s){var o=Pr(e,t);if(o<s&&rt(e[o],t))return o}return-1}function ng(e,t){return Pr(e,t,!0)}function ag(e,t,s){return Us(e,t,N(s,2),!0)}function og(e,t){var s=e==null?0:e.length;if(s){var o=Pr(e,t,!0)-1;if(rt(e[o],t))return o}return-1}function cg(e){return e&&e.length?fo(e):[]}function ug(e,t){return e&&e.length?fo(e,N(t,2)):[]}function hg(e){var t=e==null?0:e.length;return t?Be(e,1,t):[]}function lg(e,t,s){return e&&e.length?(t=s||t===i?1:z(t),Be(e,0,t<0?0:t)):[]}function pg(e,t,s){var o=e==null?0:e.length;return o?(t=s||t===i?1:z(t),t=o-t,Be(e,t<0?0:t,o)):[]}function dg(e,t){return e&&e.length?Sr(e,N(t,3),!1,!0):[]}function gg(e,t){return e&&e.length?Sr(e,N(t,3)):[]}var fg=U(function(e){return Nt(we(e,1,le,!0))}),vg=U(function(e){var t=Ge(e);return le(t)&&(t=i),Nt(we(e,1,le,!0),N(t,2))}),yg=U(function(e){var t=Ge(e);return t=typeof t=="function"?t:i,Nt(we(e,1,le,!0),i,t)});function mg(e){return e&&e.length?Nt(e):[]}function wg(e,t){return e&&e.length?Nt(e,N(t,2)):[]}function _g(e,t){return t=typeof t=="function"?t:i,e&&e.length?Nt(e,i,t):[]}function an(e){if(!(e&&e.length))return[];var t=0;return e=St(e,function(s){if(le(s))return t=ve(s.length,t),!0}),Es(t,function(s){return ae(e,ws(s))})}function tc(e,t){if(!(e&&e.length))return[];var s=an(e);return t==null?s:ae(s,function(o){return Te(t,i,o)})}var bg=U(function(e,t){return le(e)?Fi(e,t):[]}),Eg=U(function(e){return Vs(St(e,le))}),Ig=U(function(e){var t=Ge(e);return le(t)&&(t=i),Vs(St(e,le),N(t,2))}),Pg=U(function(e){var t=Ge(e);return t=typeof t=="function"?t:i,Vs(St(e,le),i,t)}),Sg=U(an);function Cg(e,t){return wo(e||[],t||[],Oi)}function xg(e,t){return wo(e||[],t||[],Ti)}var Ag=U(function(e){var t=e.length,s=t>1?e[t-1]:i;return s=typeof s=="function"?(e.pop(),s):i,tc(e,s)});function ic(e){var t=u(e);return t.__chain__=!0,t}function Rg(e,t){return t(e),e}function $r(e,t){return t(e)}var Ng=yt(function(e){var t=e.length,s=t?e[0]:0,o=this.__wrapped__,c=function(l){return Ns(l,e)};return t>1||this.__actions__.length||!(o instanceof K)||!mt(s)?this.thru(c):(o=o.slice(s,+s+(t?1:0)),o.__actions__.push({func:$r,args:[c],thisArg:i}),new Ke(o,this.__chain__).thru(function(l){return t&&!l.length&&l.push(i),l}))});function Og(){return ic(this)}function Fg(){return new Ke(this.value(),this.__chain__)}function Dg(){this.__values__===i&&(this.__values__=vc(this.value()));var e=this.__index__>=this.__values__.length,t=e?i:this.__values__[this.__index__++];return{done:e,value:t}}function $g(){return this}function Tg(e){for(var t,s=this;s instanceof wr;){var o=Yo(s);o.__index__=0,o.__values__=i,t?c.__wrapped__=o:t=o;var c=o;s=s.__wrapped__}return c.__wrapped__=e,t}function qg(){var e=this.__wrapped__;if(e instanceof K){var t=e;return this.__actions__.length&&(t=new K(this)),t=t.reverse(),t.__actions__.push({func:$r,args:[nn],thisArg:i}),new Ke(t,this.__chain__)}return this.thru(nn)}function jg(){return mo(this.__wrapped__,this.__actions__)}var Mg=Cr(function(e,t,s){J.call(e,s)?++e[s]:ft(e,s,1)});function zg(e,t,s){var o=j(e)?Na:Rp;return s&&xe(e,t,s)&&(t=i),o(e,N(t,3))}function Lg(e,t){var s=j(e)?St:eo;return s(e,N(t,3))}var Ug=Ro(Jo),kg=Ro(Qo);function Vg(e,t){return we(Tr(e,t),1)}function Kg(e,t){return we(Tr(e,t),Lt)}function Hg(e,t,s){return s=s===i?1:z(s),we(Tr(e,t),s)}function rc(e,t){var s=j(e)?ke:Rt;return s(e,N(t,3))}function sc(e,t){var s=j(e)?hl:Xa;return s(e,N(t,3))}var Bg=Cr(function(e,t,s){J.call(e,s)?e[s].push(t):ft(e,s,[t])});function Gg(e,t,s,o){e=Oe(e)?e:pi(e),s=s&&!o?z(s):0;var c=e.length;return s<0&&(s=ve(c+s,0)),Lr(e)?s<=c&&e.indexOf(t,s)>-1:!!c&&ei(e,t,s)>-1}var Wg=U(function(e,t,s){var o=-1,c=typeof t=="function",l=Oe(e)?w(e.length):[];return Rt(e,function(d){l[++o]=c?Te(t,d,s):Di(d,t,s)}),l}),Yg=Cr(function(e,t,s){ft(e,s,t)});function Tr(e,t){var s=j(e)?ae:ao;return s(e,N(t,3))}function Jg(e,t,s,o){return e==null?[]:(j(t)||(t=t==null?[]:[t]),s=o?i:s,j(s)||(s=s==null?[]:[s]),ho(e,t,s))}var Qg=Cr(function(e,t,s){e[s?0:1].push(t)},function(){return[[],[]]});function Zg(e,t,s){var o=j(e)?ys:$a,c=arguments.length<3;return o(e,N(t,4),s,c,Rt)}function Xg(e,t,s){var o=j(e)?ll:$a,c=arguments.length<3;return o(e,N(t,4),s,c,Xa)}function ef(e,t){var s=j(e)?St:eo;return s(e,Mr(N(t,3)))}function tf(e){var t=j(e)?Ya:Gp;return t(e)}function rf(e,t,s){(s?xe(e,t,s):t===i)?t=1:t=z(t);var o=j(e)?Pp:Wp;return o(e,t)}function sf(e){var t=j(e)?Sp:Jp;return t(e)}function nf(e){if(e==null)return 0;if(Oe(e))return Lr(e)?ii(e):e.length;var t=Ee(e);return t==Xe||t==et?e.size:qs(e).length}function af(e,t,s){var o=j(e)?ms:Qp;return s&&xe(e,t,s)&&(t=i),o(e,N(t,3))}var of=U(function(e,t){if(e==null)return[];var s=t.length;return s>1&&xe(e,t[0],t[1])?t=[]:s>2&&xe(t[0],t[1],t[2])&&(t=[t[0]]),ho(e,we(t,1),[])}),qr=Ll||function(){return me.Date.now()};function cf(e,t){if(typeof t!="function")throw new Ve(g);return e=z(e),function(){if(--e<1)return t.apply(this,arguments)}}function nc(e,t,s){return t=s?i:t,t=e&&t==null?e.length:t,vt(e,he,i,i,i,i,t)}function ac(e,t){var s;if(typeof t!="function")throw new Ve(g);return e=z(e),function(){return--e>0&&(s=t.apply(this,arguments)),e<=1&&(t=i),s}}var on=U(function(e,t,s){var o=re;if(s.length){var c=xt(s,hi(on));o|=ne}return vt(e,o,t,s,c)}),oc=U(function(e,t,s){var o=re|se;if(s.length){var c=xt(s,hi(oc));o|=ne}return vt(t,o,e,s,c)});function cc(e,t,s){t=s?i:t;var o=vt(e,Q,i,i,i,i,i,t);return o.placeholder=cc.placeholder,o}function uc(e,t,s){t=s?i:t;var o=vt(e,G,i,i,i,i,i,t);return o.placeholder=uc.placeholder,o}function hc(e,t,s){var o,c,l,d,f,y,E=0,I=!1,P=!1,C=!0;if(typeof e!="function")throw new Ve(g);t=We(t)||0,oe(s)&&(I=!!s.leading,P="maxWait"in s,l=P?ve(We(s.maxWait)||0,t):l,C="trailing"in s?!!s.trailing:C);function R(pe){var st=o,bt=c;return o=c=i,E=pe,d=e.apply(bt,st),d}function F(pe){return E=pe,f=Mi(k,t),I?R(pe):d}function L(pe){var st=pe-y,bt=pe-E,Rc=t-st;return P?be(Rc,l-bt):Rc}function D(pe){var st=pe-y,bt=pe-E;return y===i||st>=t||st<0||P&&bt>=l}function k(){var pe=qr();if(D(pe))return H(pe);f=Mi(k,L(pe))}function H(pe){return f=i,C&&o?R(pe):(o=c=i,d)}function ze(){f!==i&&_o(f),E=0,o=y=c=f=i}function Ae(){return f===i?d:H(qr())}function Le(){var pe=qr(),st=D(pe);if(o=arguments,c=this,y=pe,st){if(f===i)return F(y);if(P)return _o(f),f=Mi(k,t),R(y)}return f===i&&(f=Mi(k,t)),d}return Le.cancel=ze,Le.flush=Ae,Le}var uf=U(function(e,t){return Za(e,1,t)}),hf=U(function(e,t,s){return Za(e,We(t)||0,s)});function lf(e){return vt(e,It)}function jr(e,t){if(typeof e!="function"||t!=null&&typeof t!="function")throw new Ve(g);var s=function(){var o=arguments,c=t?t.apply(this,o):o[0],l=s.cache;if(l.has(c))return l.get(c);var d=e.apply(this,o);return s.cache=l.set(c,d)||l,d};return s.cache=new(jr.Cache||gt),s}jr.Cache=gt;function Mr(e){if(typeof e!="function")throw new Ve(g);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}function pf(e){return ac(2,e)}var df=Zp(function(e,t){t=t.length==1&&j(t[0])?ae(t[0],qe(N())):ae(we(t,1),qe(N()));var s=t.length;return U(function(o){for(var c=-1,l=be(o.length,s);++c<l;)o[c]=t[c].call(this,o[c]);return Te(e,this,o)})}),cn=U(function(e,t){var s=xt(t,hi(cn));return vt(e,ne,i,t,s)}),lc=U(function(e,t){var s=xt(t,hi(lc));return vt(e,Pe,i,t,s)}),gf=yt(function(e,t){return vt(e,Se,i,i,i,t)});function ff(e,t){if(typeof e!="function")throw new Ve(g);return t=t===i?t:z(t),U(e,t)}function vf(e,t){if(typeof e!="function")throw new Ve(g);return t=t==null?0:ve(z(t),0),U(function(s){var o=s[t],c=Ft(s,0,t);return o&&Ct(c,o),Te(e,this,c)})}function yf(e,t,s){var o=!0,c=!0;if(typeof e!="function")throw new Ve(g);return oe(s)&&(o="leading"in s?!!s.leading:o,c="trailing"in s?!!s.trailing:c),hc(e,t,{leading:o,maxWait:t,trailing:c})}function mf(e){return nc(e,1)}function wf(e,t){return cn(Hs(t),e)}function _f(){if(!arguments.length)return[];var e=arguments[0];return j(e)?e:[e]}function bf(e){return He(e,Z)}function Ef(e,t){return t=typeof t=="function"?t:i,He(e,Z,t)}function If(e){return He(e,V|Z)}function Pf(e,t){return t=typeof t=="function"?t:i,He(e,V|Z,t)}function Sf(e,t){return t==null||Qa(e,t,ye(t))}function rt(e,t){return e===t||e!==e&&t!==t}var Cf=Nr(Ds),xf=Nr(function(e,t){return e>=t}),Yt=ro(function(){return arguments}())?ro:function(e){return ce(e)&&J.call(e,"callee")&&!Va.call(e,"callee")},j=w.isArray,Af=Pa?qe(Pa):Tp;function Oe(e){return e!=null&&zr(e.length)&&!wt(e)}function le(e){return ce(e)&&Oe(e)}function Rf(e){return e===!0||e===!1||ce(e)&&Ce(e)==mi}var Dt=kl||wn,Nf=Sa?qe(Sa):qp;function Of(e){return ce(e)&&e.nodeType===1&&!zi(e)}function Ff(e){if(e==null)return!0;if(Oe(e)&&(j(e)||typeof e=="string"||typeof e.splice=="function"||Dt(e)||li(e)||Yt(e)))return!e.length;var t=Ee(e);if(t==Xe||t==et)return!e.size;if(ji(e))return!qs(e).length;for(var s in e)if(J.call(e,s))return!1;return!0}function Df(e,t){return $i(e,t)}function $f(e,t,s){s=typeof s=="function"?s:i;var o=s?s(e,t):i;return o===i?$i(e,t,i,s):!!o}function un(e){if(!ce(e))return!1;var t=Ce(e);return t==Qi||t==ih||typeof e.message=="string"&&typeof e.name=="string"&&!zi(e)}function Tf(e){return typeof e=="number"&&Ha(e)}function wt(e){if(!oe(e))return!1;var t=Ce(e);return t==Zi||t==Zn||t==th||t==sh}function pc(e){return typeof e=="number"&&e==z(e)}function zr(e){return typeof e=="number"&&e>-1&&e%1==0&&e<=Pt}function oe(e){var t=typeof e;return e!=null&&(t=="object"||t=="function")}function ce(e){return e!=null&&typeof e=="object"}var dc=Ca?qe(Ca):Mp;function qf(e,t){return e===t||Ts(e,t,Zs(t))}function jf(e,t,s){return s=typeof s=="function"?s:i,Ts(e,t,Zs(t),s)}function Mf(e){return gc(e)&&e!=+e}function zf(e){if(bd(e))throw new q(h);return so(e)}function Lf(e){return e===null}function Uf(e){return e==null}function gc(e){return typeof e=="number"||ce(e)&&Ce(e)==_i}function zi(e){if(!ce(e)||Ce(e)!=pt)return!1;var t=pr(e);if(t===null)return!0;var s=J.call(t,"constructor")&&t.constructor;return typeof s=="function"&&s instanceof s&&cr.call(s)==ql}var hn=xa?qe(xa):zp;function kf(e){return pc(e)&&e>=-Pt&&e<=Pt}var fc=Aa?qe(Aa):Lp;function Lr(e){return typeof e=="string"||!j(e)&&ce(e)&&Ce(e)==Ei}function Me(e){return typeof e=="symbol"||ce(e)&&Ce(e)==Xi}var li=Ra?qe(Ra):Up;function Vf(e){return e===i}function Kf(e){return ce(e)&&Ee(e)==Ii}function Hf(e){return ce(e)&&Ce(e)==ah}var Bf=Nr(js),Gf=Nr(function(e,t){return e<=t});function vc(e){if(!e)return[];if(Oe(e))return Lr(e)?tt(e):Ne(e);if(Ci&&e[Ci])return Pl(e[Ci]());var t=Ee(e),s=t==Xe?Ps:t==et?nr:pi;return s(e)}function _t(e){if(!e)return e===0?e:0;if(e=We(e),e===Lt||e===-Lt){var t=e<0?-1:1;return t*Qu}return e===e?e:0}function z(e){var t=_t(e),s=t%1;return t===t?s?t-s:t:0}function yc(e){return e?Ht(z(e),0,at):0}function We(e){if(typeof e=="number")return e;if(Me(e))return Yi;if(oe(e)){var t=typeof e.valueOf=="function"?e.valueOf():e;e=oe(t)?t+"":t}if(typeof e!="string")return e===0?e:+e;e=Ta(e);var s=xh.test(e);return s||Rh.test(e)?ol(e.slice(2),s?2:8):Ch.test(e)?Yi:+e}function mc(e){return ct(e,Fe(e))}function Wf(e){return e?Ht(z(e),-Pt,Pt):e===0?e:0}function Y(e){return e==null?"":je(e)}var Yf=ci(function(e,t){if(ji(t)||Oe(t)){ct(t,ye(t),e);return}for(var s in t)J.call(t,s)&&Oi(e,s,t[s])}),wc=ci(function(e,t){ct(t,Fe(t),e)}),Ur=ci(function(e,t,s,o){ct(t,Fe(t),e,o)}),Jf=ci(function(e,t,s,o){ct(t,ye(t),e,o)}),Qf=yt(Ns);function Zf(e,t){var s=oi(e);return t==null?s:Ja(s,t)}var Xf=U(function(e,t){e=X(e);var s=-1,o=t.length,c=o>2?t[2]:i;for(c&&xe(t[0],t[1],c)&&(o=1);++s<o;)for(var l=t[s],d=Fe(l),f=-1,y=d.length;++f<y;){var E=d[f],I=e[E];(I===i||rt(I,si[E])&&!J.call(e,E))&&(e[E]=l[E])}return e}),ev=U(function(e){return e.push(i,qo),Te(_c,i,e)});function tv(e,t){return Oa(e,N(t,3),ot)}function iv(e,t){return Oa(e,N(t,3),Fs)}function rv(e,t){return e==null?e:Os(e,N(t,3),Fe)}function sv(e,t){return e==null?e:to(e,N(t,3),Fe)}function nv(e,t){return e&&ot(e,N(t,3))}function av(e,t){return e&&Fs(e,N(t,3))}function ov(e){return e==null?[]:Er(e,ye(e))}function cv(e){return e==null?[]:Er(e,Fe(e))}function ln(e,t,s){var o=e==null?i:Bt(e,t);return o===i?s:o}function uv(e,t){return e!=null&&zo(e,t,Op)}function pn(e,t){return e!=null&&zo(e,t,Fp)}var hv=Oo(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=ur.call(t)),e[t]=s},gn(De)),lv=Oo(function(e,t,s){t!=null&&typeof t.toString!="function"&&(t=ur.call(t)),J.call(e,t)?e[t].push(s):e[t]=[s]},N),pv=U(Di);function ye(e){return Oe(e)?Wa(e):qs(e)}function Fe(e){return Oe(e)?Wa(e,!0):kp(e)}function dv(e,t){var s={};return t=N(t,3),ot(e,function(o,c,l){ft(s,t(o,c,l),o)}),s}function gv(e,t){var s={};return t=N(t,3),ot(e,function(o,c,l){ft(s,c,t(o,c,l))}),s}var fv=ci(function(e,t,s){Ir(e,t,s)}),_c=ci(function(e,t,s,o){Ir(e,t,s,o)}),vv=yt(function(e,t){var s={};if(e==null)return s;var o=!1;t=ae(t,function(l){return l=Ot(l,e),o||(o=l.length>1),l}),ct(e,Js(e),s),o&&(s=He(s,V|M|Z,ud));for(var c=t.length;c--;)ks(s,t[c]);return s});function yv(e,t){return bc(e,Mr(N(t)))}var mv=yt(function(e,t){return e==null?{}:Kp(e,t)});function bc(e,t){if(e==null)return{};var s=ae(Js(e),function(o){return[o]});return t=N(t),lo(e,s,function(o,c){return t(o,c[0])})}function wv(e,t,s){t=Ot(t,e);var o=-1,c=t.length;for(c||(c=1,e=i);++o<c;){var l=e==null?i:e[ut(t[o])];l===i&&(o=c,l=s),e=wt(l)?l.call(e):l}return e}function _v(e,t,s){return e==null?e:Ti(e,t,s)}function bv(e,t,s,o){return o=typeof o=="function"?o:i,e==null?e:Ti(e,t,s,o)}var Ec=$o(ye),Ic=$o(Fe);function Ev(e,t,s){var o=j(e),c=o||Dt(e)||li(e);if(t=N(t,4),s==null){var l=e&&e.constructor;c?s=o?new l:[]:oe(e)?s=wt(l)?oi(pr(e)):{}:s={}}return(c?ke:ot)(e,function(d,f,y){return t(s,d,f,y)}),s}function Iv(e,t){return e==null?!0:ks(e,t)}function Pv(e,t,s){return e==null?e:yo(e,t,Hs(s))}function Sv(e,t,s,o){return o=typeof o=="function"?o:i,e==null?e:yo(e,t,Hs(s),o)}function pi(e){return e==null?[]:Is(e,ye(e))}function Cv(e){return e==null?[]:Is(e,Fe(e))}function xv(e,t,s){return s===i&&(s=t,t=i),s!==i&&(s=We(s),s=s===s?s:0),t!==i&&(t=We(t),t=t===t?t:0),Ht(We(e),t,s)}function Av(e,t,s){return t=_t(t),s===i?(s=t,t=0):s=_t(s),e=We(e),Dp(e,t,s)}function Rv(e,t,s){if(s&&typeof s!="boolean"&&xe(e,t,s)&&(t=s=i),s===i&&(typeof t=="boolean"?(s=t,t=i):typeof e=="boolean"&&(s=e,e=i)),e===i&&t===i?(e=0,t=1):(e=_t(e),t===i?(t=e,e=0):t=_t(t)),e>t){var o=e;e=t,t=o}if(s||e%1||t%1){var c=Ba();return be(e+c*(t-e+al("1e-"+((c+"").length-1))),t)}return zs(e,t)}var Nv=ui(function(e,t,s){return t=t.toLowerCase(),e+(s?Pc(t):t)});function Pc(e){return dn(Y(e).toLowerCase())}function Sc(e){return e=Y(e),e&&e.replace(Oh,wl).replace(Jh,"")}function Ov(e,t,s){e=Y(e),t=je(t);var o=e.length;s=s===i?o:Ht(z(s),0,o);var c=s;return s-=t.length,s>=0&&e.slice(s,c)==t}function Fv(e){return e=Y(e),e&&lh.test(e)?e.replace(ta,_l):e}function Dv(e){return e=Y(e),e&&yh.test(e)?e.replace(os,"\\$&"):e}var $v=ui(function(e,t,s){return e+(s?"-":"")+t.toLowerCase()}),Tv=ui(function(e,t,s){return e+(s?" ":"")+t.toLowerCase()}),qv=Ao("toLowerCase");function jv(e,t,s){e=Y(e),t=z(t);var o=t?ii(e):0;if(!t||o>=t)return e;var c=(t-o)/2;return Rr(vr(c),s)+e+Rr(fr(c),s)}function Mv(e,t,s){e=Y(e),t=z(t);var o=t?ii(e):0;return t&&o<t?e+Rr(t-o,s):e}function zv(e,t,s){e=Y(e),t=z(t);var o=t?ii(e):0;return t&&o<t?Rr(t-o,s)+e:e}function Lv(e,t,s){return s||t==null?t=0:t&&(t=+t),Bl(Y(e).replace(cs,""),t||0)}function Uv(e,t,s){return(s?xe(e,t,s):t===i)?t=1:t=z(t),Ls(Y(e),t)}function kv(){var e=arguments,t=Y(e[0]);return e.length<3?t:t.replace(e[1],e[2])}var Vv=ui(function(e,t,s){return e+(s?"_":"")+t.toLowerCase()});function Kv(e,t,s){return s&&typeof s!="number"&&xe(e,t,s)&&(t=s=i),s=s===i?at:s>>>0,s?(e=Y(e),e&&(typeof t=="string"||t!=null&&!hn(t))&&(t=je(t),!t&&ti(e))?Ft(tt(e),0,s):e.split(t,s)):[]}var Hv=ui(function(e,t,s){return e+(s?" ":"")+dn(t)});function Bv(e,t,s){return e=Y(e),s=s==null?0:Ht(z(s),0,e.length),t=je(t),e.slice(s,s+t.length)==t}function Gv(e,t,s){var o=u.templateSettings;s&&xe(e,t,s)&&(t=i),e=Y(e),t=Ur({},t,o,To);var c=Ur({},t.imports,o.imports,To),l=ye(c),d=Is(c,l),f,y,E=0,I=t.interpolate||er,P="__p += '",C=Ss((t.escape||er).source+"|"+I.source+"|"+(I===ia?Sh:er).source+"|"+(t.evaluate||er).source+"|$","g"),R="//# sourceURL="+(J.call(t,"sourceURL")?(t.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++tl+"]")+`
`;e.replace(C,function(D,k,H,ze,Ae,Le){return H||(H=ze),P+=e.slice(E,Le).replace(Fh,bl),k&&(f=!0,P+=`' +
__e(`+k+`) +
'`),Ae&&(y=!0,P+=`';
`+Ae+`;
__p += '`),H&&(P+=`' +
((__t = (`+H+`)) == null ? '' : __t) +
'`),E=Le+D.length,D}),P+=`';
`;var F=J.call(t,"variable")&&t.variable;if(!F)P=`with (obj) {
`+P+`
}
`;else if(Ih.test(F))throw new q(m);P=(y?P.replace(oh,""):P).replace(ch,"$1").replace(uh,"$1;"),P="function("+(F||"obj")+`) {
`+(F?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(f?", __e = _.escape":"")+(y?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+P+`return __p
}`;var L=xc(function(){return W(l,R+"return "+P).apply(i,d)});if(L.source=P,un(L))throw L;return L}function Wv(e){return Y(e).toLowerCase()}function Yv(e){return Y(e).toUpperCase()}function Jv(e,t,s){if(e=Y(e),e&&(s||t===i))return Ta(e);if(!e||!(t=je(t)))return e;var o=tt(e),c=tt(t),l=qa(o,c),d=ja(o,c)+1;return Ft(o,l,d).join("")}function Qv(e,t,s){if(e=Y(e),e&&(s||t===i))return e.slice(0,za(e)+1);if(!e||!(t=je(t)))return e;var o=tt(e),c=ja(o,tt(t))+1;return Ft(o,0,c).join("")}function Zv(e,t,s){if(e=Y(e),e&&(s||t===i))return e.replace(cs,"");if(!e||!(t=je(t)))return e;var o=tt(e),c=qa(o,tt(t));return Ft(o,c).join("")}function Xv(e,t){var s=Hu,o=Bu;if(oe(t)){var c="separator"in t?t.separator:c;s="length"in t?z(t.length):s,o="omission"in t?je(t.omission):o}e=Y(e);var l=e.length;if(ti(e)){var d=tt(e);l=d.length}if(s>=l)return e;var f=s-ii(o);if(f<1)return o;var y=d?Ft(d,0,f).join(""):e.slice(0,f);if(c===i)return y+o;if(d&&(f+=y.length-f),hn(c)){if(e.slice(f).search(c)){var E,I=y;for(c.global||(c=Ss(c.source,Y(ra.exec(c))+"g")),c.lastIndex=0;E=c.exec(I);)var P=E.index;y=y.slice(0,P===i?f:P)}}else if(e.indexOf(je(c),f)!=f){var C=y.lastIndexOf(c);C>-1&&(y=y.slice(0,C))}return y+o}function ey(e){return e=Y(e),e&&hh.test(e)?e.replace(ea,Al):e}var ty=ui(function(e,t,s){return e+(s?" ":"")+t.toUpperCase()}),dn=Ao("toUpperCase");function Cc(e,t,s){return e=Y(e),t=s?i:t,t===i?Il(e)?Ol(e):gl(e):e.match(t)||[]}var xc=U(function(e,t){try{return Te(e,i,t)}catch(s){return un(s)?s:new q(s)}}),iy=yt(function(e,t){return ke(t,function(s){s=ut(s),ft(e,s,on(e[s],e))}),e});function ry(e){var t=e==null?0:e.length,s=N();return e=t?ae(e,function(o){if(typeof o[1]!="function")throw new Ve(g);return[s(o[0]),o[1]]}):[],U(function(o){for(var c=-1;++c<t;){var l=e[c];if(Te(l[0],this,o))return Te(l[1],this,o)}})}function sy(e){return Ap(He(e,V))}function gn(e){return function(){return e}}function ny(e,t){return e==null||e!==e?t:e}var ay=No(),oy=No(!0);function De(e){return e}function fn(e){return no(typeof e=="function"?e:He(e,V))}function cy(e){return oo(He(e,V))}function uy(e,t){return co(e,He(t,V))}var hy=U(function(e,t){return function(s){return Di(s,e,t)}}),ly=U(function(e,t){return function(s){return Di(e,s,t)}});function vn(e,t,s){var o=ye(t),c=Er(t,o);s==null&&!(oe(t)&&(c.length||!o.length))&&(s=t,t=e,e=this,c=Er(t,ye(t)));var l=!(oe(s)&&"chain"in s)||!!s.chain,d=wt(e);return ke(c,function(f){var y=t[f];e[f]=y,d&&(e.prototype[f]=function(){var E=this.__chain__;if(l||E){var I=e(this.__wrapped__),P=I.__actions__=Ne(this.__actions__);return P.push({func:y,args:arguments,thisArg:e}),I.__chain__=E,I}return y.apply(e,Ct([this.value()],arguments))})}),e}function py(){return me._===this&&(me._=jl),this}function yn(){}function dy(e){return e=z(e),U(function(t){return uo(t,e)})}var gy=Gs(ae),fy=Gs(Na),vy=Gs(ms);function Ac(e){return en(e)?ws(ut(e)):Hp(e)}function yy(e){return function(t){return e==null?i:Bt(e,t)}}var my=Fo(),wy=Fo(!0);function mn(){return[]}function wn(){return!1}function _y(){return{}}function by(){return""}function Ey(){return!0}function Iy(e,t){if(e=z(e),e<1||e>Pt)return[];var s=at,o=be(e,at);t=N(t),e-=at;for(var c=Es(o,t);++s<e;)t(s);return c}function Py(e){return j(e)?ae(e,ut):Me(e)?[e]:Ne(Wo(Y(e)))}function Sy(e){var t=++Tl;return Y(e)+t}var Cy=Ar(function(e,t){return e+t},0),xy=Ws("ceil"),Ay=Ar(function(e,t){return e/t},1),Ry=Ws("floor");function Ny(e){return e&&e.length?br(e,De,Ds):i}function Oy(e,t){return e&&e.length?br(e,N(t,2),Ds):i}function Fy(e){return Da(e,De)}function Dy(e,t){return Da(e,N(t,2))}function $y(e){return e&&e.length?br(e,De,js):i}function Ty(e,t){return e&&e.length?br(e,N(t,2),js):i}var qy=Ar(function(e,t){return e*t},1),jy=Ws("round"),My=Ar(function(e,t){return e-t},0);function zy(e){return e&&e.length?bs(e,De):0}function Ly(e,t){return e&&e.length?bs(e,N(t,2)):0}return u.after=cf,u.ary=nc,u.assign=Yf,u.assignIn=wc,u.assignInWith=Ur,u.assignWith=Jf,u.at=Qf,u.before=ac,u.bind=on,u.bindAll=iy,u.bindKey=oc,u.castArray=_f,u.chain=ic,u.chunk=Ad,u.compact=Rd,u.concat=Nd,u.cond=ry,u.conforms=sy,u.constant=gn,u.countBy=Mg,u.create=Zf,u.curry=cc,u.curryRight=uc,u.debounce=hc,u.defaults=Xf,u.defaultsDeep=ev,u.defer=uf,u.delay=hf,u.difference=Od,u.differenceBy=Fd,u.differenceWith=Dd,u.drop=$d,u.dropRight=Td,u.dropRightWhile=qd,u.dropWhile=jd,u.fill=Md,u.filter=Lg,u.flatMap=Vg,u.flatMapDeep=Kg,u.flatMapDepth=Hg,u.flatten=Zo,u.flattenDeep=zd,u.flattenDepth=Ld,u.flip=lf,u.flow=ay,u.flowRight=oy,u.fromPairs=Ud,u.functions=ov,u.functionsIn=cv,u.groupBy=Bg,u.initial=Vd,u.intersection=Kd,u.intersectionBy=Hd,u.intersectionWith=Bd,u.invert=hv,u.invertBy=lv,u.invokeMap=Wg,u.iteratee=fn,u.keyBy=Yg,u.keys=ye,u.keysIn=Fe,u.map=Tr,u.mapKeys=dv,u.mapValues=gv,u.matches=cy,u.matchesProperty=uy,u.memoize=jr,u.merge=fv,u.mergeWith=_c,u.method=hy,u.methodOf=ly,u.mixin=vn,u.negate=Mr,u.nthArg=dy,u.omit=vv,u.omitBy=yv,u.once=pf,u.orderBy=Jg,u.over=gy,u.overArgs=df,u.overEvery=fy,u.overSome=vy,u.partial=cn,u.partialRight=lc,u.partition=Qg,u.pick=mv,u.pickBy=bc,u.property=Ac,u.propertyOf=yy,u.pull=Jd,u.pullAll=ec,u.pullAllBy=Qd,u.pullAllWith=Zd,u.pullAt=Xd,u.range=my,u.rangeRight=wy,u.rearg=gf,u.reject=ef,u.remove=eg,u.rest=ff,u.reverse=nn,u.sampleSize=rf,u.set=_v,u.setWith=bv,u.shuffle=sf,u.slice=tg,u.sortBy=of,u.sortedUniq=cg,u.sortedUniqBy=ug,u.split=Kv,u.spread=vf,u.tail=hg,u.take=lg,u.takeRight=pg,u.takeRightWhile=dg,u.takeWhile=gg,u.tap=Rg,u.throttle=yf,u.thru=$r,u.toArray=vc,u.toPairs=Ec,u.toPairsIn=Ic,u.toPath=Py,u.toPlainObject=mc,u.transform=Ev,u.unary=mf,u.union=fg,u.unionBy=vg,u.unionWith=yg,u.uniq=mg,u.uniqBy=wg,u.uniqWith=_g,u.unset=Iv,u.unzip=an,u.unzipWith=tc,u.update=Pv,u.updateWith=Sv,u.values=pi,u.valuesIn=Cv,u.without=bg,u.words=Cc,u.wrap=wf,u.xor=Eg,u.xorBy=Ig,u.xorWith=Pg,u.zip=Sg,u.zipObject=Cg,u.zipObjectDeep=xg,u.zipWith=Ag,u.entries=Ec,u.entriesIn=Ic,u.extend=wc,u.extendWith=Ur,vn(u,u),u.add=Cy,u.attempt=xc,u.camelCase=Nv,u.capitalize=Pc,u.ceil=xy,u.clamp=xv,u.clone=bf,u.cloneDeep=If,u.cloneDeepWith=Pf,u.cloneWith=Ef,u.conformsTo=Sf,u.deburr=Sc,u.defaultTo=ny,u.divide=Ay,u.endsWith=Ov,u.eq=rt,u.escape=Fv,u.escapeRegExp=Dv,u.every=zg,u.find=Ug,u.findIndex=Jo,u.findKey=tv,u.findLast=kg,u.findLastIndex=Qo,u.findLastKey=iv,u.floor=Ry,u.forEach=rc,u.forEachRight=sc,u.forIn=rv,u.forInRight=sv,u.forOwn=nv,u.forOwnRight=av,u.get=ln,u.gt=Cf,u.gte=xf,u.has=uv,u.hasIn=pn,u.head=Xo,u.identity=De,u.includes=Gg,u.indexOf=kd,u.inRange=Av,u.invoke=pv,u.isArguments=Yt,u.isArray=j,u.isArrayBuffer=Af,u.isArrayLike=Oe,u.isArrayLikeObject=le,u.isBoolean=Rf,u.isBuffer=Dt,u.isDate=Nf,u.isElement=Of,u.isEmpty=Ff,u.isEqual=Df,u.isEqualWith=$f,u.isError=un,u.isFinite=Tf,u.isFunction=wt,u.isInteger=pc,u.isLength=zr,u.isMap=dc,u.isMatch=qf,u.isMatchWith=jf,u.isNaN=Mf,u.isNative=zf,u.isNil=Uf,u.isNull=Lf,u.isNumber=gc,u.isObject=oe,u.isObjectLike=ce,u.isPlainObject=zi,u.isRegExp=hn,u.isSafeInteger=kf,u.isSet=fc,u.isString=Lr,u.isSymbol=Me,u.isTypedArray=li,u.isUndefined=Vf,u.isWeakMap=Kf,u.isWeakSet=Hf,u.join=Gd,u.kebabCase=$v,u.last=Ge,u.lastIndexOf=Wd,u.lowerCase=Tv,u.lowerFirst=qv,u.lt=Bf,u.lte=Gf,u.max=Ny,u.maxBy=Oy,u.mean=Fy,u.meanBy=Dy,u.min=$y,u.minBy=Ty,u.stubArray=mn,u.stubFalse=wn,u.stubObject=_y,u.stubString=by,u.stubTrue=Ey,u.multiply=qy,u.nth=Yd,u.noConflict=py,u.noop=yn,u.now=qr,u.pad=jv,u.padEnd=Mv,u.padStart=zv,u.parseInt=Lv,u.random=Rv,u.reduce=Zg,u.reduceRight=Xg,u.repeat=Uv,u.replace=kv,u.result=wv,u.round=jy,u.runInContext=v,u.sample=tf,u.size=nf,u.snakeCase=Vv,u.some=af,u.sortedIndex=ig,u.sortedIndexBy=rg,u.sortedIndexOf=sg,u.sortedLastIndex=ng,u.sortedLastIndexBy=ag,u.sortedLastIndexOf=og,u.startCase=Hv,u.startsWith=Bv,u.subtract=My,u.sum=zy,u.sumBy=Ly,u.template=Gv,u.times=Iy,u.toFinite=_t,u.toInteger=z,u.toLength=yc,u.toLower=Wv,u.toNumber=We,u.toSafeInteger=Wf,u.toString=Y,u.toUpper=Yv,u.trim=Jv,u.trimEnd=Qv,u.trimStart=Zv,u.truncate=Xv,u.unescape=ey,u.uniqueId=Sy,u.upperCase=ty,u.upperFirst=dn,u.each=rc,u.eachRight=sc,u.first=Xo,vn(u,function(){var e={};return ot(u,function(t,s){J.call(u.prototype,s)||(e[s]=t)}),e}(),{chain:!1}),u.VERSION=n,ke(["bind","bindKey","curry","curryRight","partial","partialRight"],function(e){u[e].placeholder=u}),ke(["drop","take"],function(e,t){K.prototype[e]=function(s){s=s===i?1:ve(z(s),0);var o=this.__filtered__&&!t?new K(this):this.clone();return o.__filtered__?o.__takeCount__=be(s,o.__takeCount__):o.__views__.push({size:be(s,at),type:e+(o.__dir__<0?"Right":"")}),o},K.prototype[e+"Right"]=function(s){return this.reverse()[e](s).reverse()}}),ke(["filter","map","takeWhile"],function(e,t){var s=t+1,o=s==Qn||s==Ju;K.prototype[e]=function(c){var l=this.clone();return l.__iteratees__.push({iteratee:N(c,3),type:s}),l.__filtered__=l.__filtered__||o,l}}),ke(["head","last"],function(e,t){var s="take"+(t?"Right":"");K.prototype[e]=function(){return this[s](1).value()[0]}}),ke(["initial","tail"],function(e,t){var s="drop"+(t?"":"Right");K.prototype[e]=function(){return this.__filtered__?new K(this):this[s](1)}}),K.prototype.compact=function(){return this.filter(De)},K.prototype.find=function(e){return this.filter(e).head()},K.prototype.findLast=function(e){return this.reverse().find(e)},K.prototype.invokeMap=U(function(e,t){return typeof e=="function"?new K(this):this.map(function(s){return Di(s,e,t)})}),K.prototype.reject=function(e){return this.filter(Mr(N(e)))},K.prototype.slice=function(e,t){e=z(e);var s=this;return s.__filtered__&&(e>0||t<0)?new K(s):(e<0?s=s.takeRight(-e):e&&(s=s.drop(e)),t!==i&&(t=z(t),s=t<0?s.dropRight(-t):s.take(t-e)),s)},K.prototype.takeRightWhile=function(e){return this.reverse().takeWhile(e).reverse()},K.prototype.toArray=function(){return this.take(at)},ot(K.prototype,function(e,t){var s=/^(?:filter|find|map|reject)|While$/.test(t),o=/^(?:head|last)$/.test(t),c=u[o?"take"+(t=="last"?"Right":""):t],l=o||/^find/.test(t);c&&(u.prototype[t]=function(){var d=this.__wrapped__,f=o?[1]:arguments,y=d instanceof K,E=f[0],I=y||j(d),P=function(k){var H=c.apply(u,Ct([k],f));return o&&C?H[0]:H};I&&s&&typeof E=="function"&&E.length!=1&&(y=I=!1);var C=this.__chain__,R=!!this.__actions__.length,F=l&&!C,L=y&&!R;if(!l&&I){d=L?d:new K(this);var D=e.apply(d,f);return D.__actions__.push({func:$r,args:[P],thisArg:i}),new Ke(D,C)}return F&&L?e.apply(this,f):(D=this.thru(P),F?o?D.value()[0]:D.value():D)})}),ke(["pop","push","shift","sort","splice","unshift"],function(e){var t=ar[e],s=/^(?:push|sort|unshift)$/.test(e)?"tap":"thru",o=/^(?:pop|shift)$/.test(e);u.prototype[e]=function(){var c=arguments;if(o&&!this.__chain__){var l=this.value();return t.apply(j(l)?l:[],c)}return this[s](function(d){return t.apply(j(d)?d:[],c)})}}),ot(K.prototype,function(e,t){var s=u[t];if(s){var o=s.name+"";J.call(ai,o)||(ai[o]=[]),ai[o].push({name:t,func:s})}}),ai[xr(i,se).name]=[{name:"wrapper",func:i}],K.prototype.clone=Xl,K.prototype.reverse=ep,K.prototype.value=tp,u.prototype.at=Ng,u.prototype.chain=Og,u.prototype.commit=Fg,u.prototype.next=Dg,u.prototype.plant=Tg,u.prototype.reverse=qg,u.prototype.toJSON=u.prototype.valueOf=u.prototype.value=jg,u.prototype.first=u.prototype.head,Ci&&(u.prototype[Ci]=$g),u},ri=Fl();Ut?((Ut.exports=ri)._=ri,gs._=ri):me._=ri}).call(Hi)})(qn,qn.exports);var $0=Object.defineProperty,T0=Object.defineProperties,q0=Object.getOwnPropertyDescriptors,uu=Object.getOwnPropertySymbols,j0=Object.prototype.hasOwnProperty,M0=Object.prototype.propertyIsEnumerable,hu=(p,r,i)=>r in p?$0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Vr=(p,r)=>{for(var i in r||(r={}))j0.call(r,i)&&hu(p,i,r[i]);if(uu)for(var i of uu(r))M0.call(r,i)&&hu(p,i,r[i]);return p},z0=(p,r)=>T0(p,q0(r));function Qe(p,r,i){let n;const a=jn(p);return r.rpcMap&&(n=r.rpcMap[a]),n||(n=`${D0}?chainId=eip155:${a}&projectId=${i}`),n}function jn(p){return p.includes("eip155")?Number(p.split(":")[1]):Number(p)}function Vu(p){return p.map(r=>`${r.split(":")[0]}:${r.split(":")[1]}`)}function L0(p,r){const i=Object.keys(r.namespaces).filter(a=>a.includes(p));if(!i.length)return[];const n=[];return i.forEach(a=>{const h=r.namespaces[a].accounts;n.push(...h)}),n}function U0(p={},r={}){const i=lu(p),n=lu(r);return qn.exports.merge(i,n)}function lu(p){var r,i,n,a;const h={};if(!Br(p))return h;for(const[g,m]of Object.entries(p)){const b=Pu(g)?[g]:m.chains,S=m.methods||[],$=m.events||[],V=m.rpcMap||{},M=Gr(g);h[M]=z0(Vr(Vr({},h[M]),m),{chains:bn(b,(r=h[M])==null?void 0:r.chains),methods:bn(S,(i=h[M])==null?void 0:i.methods),events:bn($,(n=h[M])==null?void 0:n.events),rpcMap:Vr(Vr({},V),(a=h[M])==null?void 0:a.rpcMap)})}return h}function k0(p){return p.includes(":")?p.split(":")[2]:p}function V0(p){const r={};for(const[i,n]of Object.entries(p)){const a=n.methods||[],h=n.events||[],g=n.accounts||[],m=Pu(i)?[i]:n.chains?n.chains:Vu(n.accounts);r[i]={chains:m,methods:a,events:h,accounts:g}}return r}const Ku={},de=p=>Ku[p],An=(p,r)=>{Ku[p]=r};class K0{constructor(r){this.name="polkadot",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Qe(`${this.name}:${r}`,this.namespace);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2])||[]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Qe(r,this.namespace);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}class H0{constructor(r){this.name="eip155",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.httpProviders=this.createHttpProviders(),this.chainId=parseInt(this.getDefaultChain())}async request(r){switch(r.request.method){case"eth_requestAccounts":return this.getAccounts();case"eth_accounts":return this.getAccounts();case"wallet_switchEthereumChain":return await this.handleSwitchChain(r);case"eth_chainId":return parseInt(this.getDefaultChain())}return this.namespace.methods.includes(r.request.method)?await this.client.request(r):this.getHttpProvider().request(r.request)}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}setDefaultChain(r,i){const n=jn(r);if(!this.httpProviders[n]){const a=i||Qe(`${this.name}:${n}`,this.namespace,this.client.core.projectId);if(!a)throw new Error(`No RPC url provided for chainId: ${n}`);this.setHttpProvider(n,a)}this.chainId=n,this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${n}`)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId.toString();if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}createHttpProvider(r,i){const n=i||Qe(`${this.name}:${r}`,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;const a=jn(i);r[a]=this.createHttpProvider(a,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}getHttpProvider(){const r=this.chainId,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}async handleSwitchChain(r){var i,n;let a=r.request.params?(i=r.request.params[0])==null?void 0:i.chainId:"0x0";a=a.startsWith("0x")?a:`0x${a}`;const h=parseInt(a,16);if(this.isChainApproved(h))this.setDefaultChain(`${h}`);else if(this.namespace.methods.includes("wallet_switchEthereumChain"))await this.client.request({topic:r.topic,request:{method:r.request.method,params:[{chainId:a}]},chainId:(n=this.namespace.chains)==null?void 0:n[0]}),this.setDefaultChain(`${h}`);else throw new Error(`Failed to switch to chain 'eip155:${h}'. The chain is not approved or the wallet does not support 'wallet_switchEthereumChain' method.`);return null}isChainApproved(r){return this.namespace.chains.includes(`${this.name}:${r}`)}}class B0{constructor(r){this.name="solana",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||Qe(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Qe(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}class G0{constructor(r){this.name="cosmos",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||Qe(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Qe(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}class W0{constructor(r){this.name="cip34",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(this.chainId=r,!this.httpProviders[r]){const n=i||this.getCardanoRPCUrl(r);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{const n=this.getCardanoRPCUrl(i);r[i]=this.createHttpProvider(i,n)}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}getCardanoRPCUrl(r){const i=this.namespace.rpcMap;if(i)return i[r]}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||this.getCardanoRPCUrl(r);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}class Y0{constructor(r){this.name="elrond",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||Qe(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Qe(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}class J0{constructor(r){this.name="multiversx",this.namespace=r.namespace,this.events=de("events"),this.client=de("client"),this.chainId=this.getDefaultChain(),this.httpProviders=this.createHttpProviders()}updateNamespace(r){this.namespace=Object.assign(this.namespace,r)}requestAccounts(){return this.getAccounts()}request(r){return this.namespace.methods.includes(r.request.method)?this.client.request(r):this.getHttpProvider().request(r.request)}setDefaultChain(r,i){if(!this.httpProviders[r]){const n=i||Qe(`${this.name}:${r}`,this.namespace,this.client.core.projectId);if(!n)throw new Error(`No RPC url provided for chainId: ${r}`);this.setHttpProvider(r,n)}this.chainId=r,this.events.emit(zt.DEFAULT_CHAIN_CHANGED,`${this.name}:${this.chainId}`)}getDefaultChain(){if(this.chainId)return this.chainId;if(this.namespace.defaultChain)return this.namespace.defaultChain;const r=this.namespace.chains[0];if(!r)throw new Error("ChainId not found");return r.split(":")[1]}getAccounts(){const r=this.namespace.accounts;return r?[...new Set(r.filter(i=>i.split(":")[1]===this.chainId.toString()).map(i=>i.split(":")[2]))]:[]}createHttpProviders(){const r={};return this.namespace.chains.forEach(i=>{var n;r[i]=this.createHttpProvider(i,(n=this.namespace.rpcMap)==null?void 0:n[i])}),r}getHttpProvider(){const r=`${this.name}:${this.chainId}`,i=this.httpProviders[r];if(typeof i>"u")throw new Error(`JSON-RPC provider for ${r} not found`);return i}setHttpProvider(r,i){const n=this.createHttpProvider(r,i);n&&(this.httpProviders[r]=n)}createHttpProvider(r,i){const n=i||Qe(r,this.namespace,this.client.core.projectId);return typeof n>"u"?void 0:new Mt(new Jt(n,de("disableProviderPing")))}}var Q0=Object.defineProperty,Z0=Object.defineProperties,X0=Object.getOwnPropertyDescriptors,pu=Object.getOwnPropertySymbols,e_=Object.prototype.hasOwnProperty,t_=Object.prototype.propertyIsEnumerable,du=(p,r,i)=>r in p?Q0(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Kr=(p,r)=>{for(var i in r||(r={}))e_.call(r,i)&&du(p,i,r[i]);if(pu)for(var i of pu(r))t_.call(r,i)&&du(p,i,r[i]);return p},Rn=(p,r)=>Z0(p,X0(r));class Yn{constructor(r){this.events=new Ze.exports,this.rpcProviders={},this.shouldAbortPairingAttempt=!1,this.maxPairingAttempts=10,this.disableProviderPing=!1,this.providerOpts=r,this.logger=typeof r?.logger<"u"&&typeof r?.logger!="string"?r.logger:B.pino(B.getDefaultLoggerOptions({level:r?.logger||ou})),this.disableProviderPing=r?.disableProviderPing||!1}static async init(r){const i=new Yn(r);return await i.initialize(),i}async request(r,i){const[n,a]=this.validateChain(i);if(!this.session)throw new Error("Please call connect() before request()");return await this.getProvider(n).request({request:Kr({},r),chainId:`${n}:${a}`,topic:this.session.topic})}sendAsync(r,i,n){this.request(r,n).then(a=>i(null,a)).catch(a=>i(a,void 0))}async enable(){if(!this.client)throw new Error("Sign Client not initialized");return this.session||await this.connect({namespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties}),await this.requestAccounts()}async disconnect(){var r;if(!this.session)throw new Error("Please call connect() before enable()");await this.client.disconnect({topic:(r=this.session)==null?void 0:r.topic,reason:Re("USER_DISCONNECTED")}),await this.cleanup()}async connect(r){if(!this.client)throw new Error("Sign Client not initialized");if(this.setNamespaces(r),await this.cleanupPendingPairings(),!r.skipPairing)return await this.pair(r.pairingTopic)}on(r,i){this.events.on(r,i)}once(r,i){this.events.once(r,i)}removeListener(r,i){this.events.removeListener(r,i)}off(r,i){this.events.off(r,i)}get isWalletConnect(){return!0}async pair(r){this.shouldAbortPairingAttempt=!1;let i=0;do{if(this.shouldAbortPairingAttempt)throw new Error("Pairing aborted");if(i>=this.maxPairingAttempts)throw new Error("Max auto pairing attempts reached");const{uri:n,approval:a}=await this.client.connect({pairingTopic:r,requiredNamespaces:this.namespaces,optionalNamespaces:this.optionalNamespaces,sessionProperties:this.sessionProperties});n&&(this.uri=n,this.events.emit("display_uri",n)),await a().then(h=>{this.session=h,this.namespaces||(this.namespaces=V0(h.namespaces),this.persist("namespaces",this.namespaces))}).catch(h=>{if(h.message!==ku)throw h;i++})}while(!this.session);return this.onConnect(),this.session}setDefaultChain(r,i){try{if(!this.session)return;const[n,a]=this.validateChain(r);this.getProvider(n).setDefaultChain(a,i)}catch(n){if(!/Please call connect/.test(n.message))throw n}}async cleanupPendingPairings(r={}){this.logger.info("Cleaning up inactive pairings...");const i=this.client.pairing.getAll();if(vi(i)){for(const n of i)r.deletePairings?this.client.core.expirer.set(n.topic,0):await this.client.core.relayer.subscriber.unsubscribe(n.topic);this.logger.info(`Inactive pairings cleared: ${i.length}`)}}abortPairingAttempt(){this.shouldAbortPairingAttempt=!0}async checkStorage(){if(this.namespaces=await this.getFromStore("namespaces"),this.optionalNamespaces=await this.getFromStore("optionalNamespaces")||{},this.client.session.length){const r=this.client.session.keys.length-1;this.session=this.client.session.get(this.client.session.keys[r]),this.createProviders()}}async initialize(){this.logger.trace("Initialized"),await this.createClient(),await this.checkStorage(),this.registerEventListeners()}async createClient(){this.client=this.providerOpts.client||await Wn.init({logger:this.providerOpts.logger||ou,relayUrl:this.providerOpts.relayUrl||N0,projectId:this.providerOpts.projectId,metadata:this.providerOpts.metadata,storageOptions:this.providerOpts.storageOptions,storage:this.providerOpts.storage,name:this.providerOpts.name}),this.logger.trace("SignClient Initialized")}createProviders(){if(!this.client)throw new Error("Sign Client not initialized");if(!this.session)throw new Error("Session not initialized. Please call connect() before enable()");const r=[...new Set(Object.keys(this.session.namespaces).map(i=>Gr(i)))];An("client",this.client),An("events",this.events),An("disableProviderPing",this.disableProviderPing),r.forEach(i=>{if(!this.session)return;const n=L0(i,this.session),a=Vu(n),h=U0(this.namespaces,this.optionalNamespaces),g=Rn(Kr({},h[i]),{accounts:n,chains:a});switch(i){case"eip155":this.rpcProviders[i]=new H0({namespace:g});break;case"solana":this.rpcProviders[i]=new B0({namespace:g});break;case"cosmos":this.rpcProviders[i]=new G0({namespace:g});break;case"polkadot":this.rpcProviders[i]=new K0({namespace:g});break;case"cip34":this.rpcProviders[i]=new W0({namespace:g});break;case"elrond":this.rpcProviders[i]=new Y0({namespace:g});break;case"multiversx":this.rpcProviders[i]=new J0({namespace:g});break}})}registerEventListeners(){if(typeof this.client>"u")throw new Error("Sign Client is not initialized");this.client.on("session_ping",r=>{this.events.emit("session_ping",r)}),this.client.on("session_event",r=>{const{params:i}=r,{event:n}=i;if(n.name==="accountsChanged"){const a=n.data;a&&vi(a)&&this.events.emit("accountsChanged",a.map(k0))}else n.name==="chainChanged"?this.onChainChanged(i.chainId):this.events.emit(n.name,n.data);this.events.emit("session_event",r)}),this.client.on("session_update",({topic:r,params:i})=>{var n;const{namespaces:a}=i,h=(n=this.client)==null?void 0:n.session.get(r);this.session=Rn(Kr({},h),{namespaces:a}),this.onSessionUpdate(),this.events.emit("session_update",{topic:r,params:i})}),this.client.on("session_delete",async r=>{await this.cleanup(),this.events.emit("session_delete",r),this.events.emit("disconnect",Rn(Kr({},Re("USER_DISCONNECTED")),{data:r.topic}))}),this.on(zt.DEFAULT_CHAIN_CHANGED,r=>{this.onChainChanged(r,!0)})}getProvider(r){if(!this.rpcProviders[r])throw new Error(`Provider not found: ${r}`);return this.rpcProviders[r]}onSessionUpdate(){Object.keys(this.rpcProviders).forEach(r=>{var i;this.getProvider(r).updateNamespace((i=this.session)==null?void 0:i.namespaces[r])})}setNamespaces(r){const{namespaces:i,optionalNamespaces:n,sessionProperties:a}=r;i&&Object.keys(i).length&&(this.namespaces=i),n&&Object.keys(n).length&&(this.optionalNamespaces=n),this.sessionProperties=a,this.persist("namespaces",i),this.persist("optionalNamespaces",n)}validateChain(r){const[i,n]=r?.split(":")||["",""];if(!this.namespaces||!Object.keys(this.namespaces).length)return[i,n];if(i&&!Object.keys(this.namespaces||{}).map(g=>Gr(g)).includes(i))throw new Error(`Namespace '${i}' is not configured. Please call connect() first with namespace config.`);if(i&&n)return[i,n];const a=Gr(Object.keys(this.namespaces)[0]),h=this.rpcProviders[a].getDefaultChain();return[a,h]}async requestAccounts(){const[r]=this.validateChain();return await this.getProvider(r).requestAccounts()}onChainChanged(r,i=!1){var n;if(!this.namespaces)return;const[a,h]=this.validateChain(r);i||this.getProvider(a).setDefaultChain(h),((n=this.namespaces[a])!=null?n:this.namespaces[`${a}:${h}`]).defaultChain=h,this.persist("namespaces",this.namespaces),this.events.emit("chainChanged",h)}onConnect(){this.createProviders(),this.events.emit("connect",{session:this.session})}async cleanup(){this.session=void 0,this.namespaces=void 0,this.optionalNamespaces=void 0,this.sessionProperties=void 0,this.persist("namespaces",void 0),this.persist("optionalNamespaces",void 0),this.persist("sessionProperties",void 0),await this.cleanupPendingPairings({deletePairings:!0})}persist(r,i){this.client.core.storage.setItem(`${cu}/${r}`,i)}async getFromStore(r){return await this.client.core.storage.getItem(`${cu}/${r}`)}}const i_=Yn,r_="wc",s_="ethereum_provider",n_=`${r_}@2:${s_}:`,a_="https://rpc.walletconnect.com/v1/",Mn=["eth_sendTransaction","personal_sign"],o_=["eth_accounts","eth_requestAccounts","eth_sendRawTransaction","eth_sign","eth_signTransaction","eth_signTypedData","eth_signTypedData_v3","eth_signTypedData_v4","wallet_switchEthereumChain","wallet_addEthereumChain","wallet_getPermissions","wallet_requestPermissions","wallet_registerOnboarding","wallet_watchAsset","wallet_scanQRCode"],zn=["chainChanged","accountsChanged"],c_=["message","disconnect","connect"];var u_=Object.defineProperty,h_=Object.defineProperties,l_=Object.getOwnPropertyDescriptors,gu=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,d_=Object.prototype.propertyIsEnumerable,fu=(p,r,i)=>r in p?u_(p,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):p[r]=i,Bi=(p,r)=>{for(var i in r||(r={}))p_.call(r,i)&&fu(p,i,r[i]);if(gu)for(var i of gu(r))d_.call(r,i)&&fu(p,i,r[i]);return p},vu=(p,r)=>h_(p,l_(r));function Yr(p){return Number(p[0].split(":")[1])}function Nn(p){return`0x${p.toString(16)}`}function g_(p){const{chains:r,optionalChains:i,methods:n,optionalMethods:a,events:h,optionalEvents:g,rpcMap:m}=p;if(!vi(r))throw new Error("Invalid chains");const b={chains:r,methods:n||Mn,events:h||zn,rpcMap:Bi({},r.length?{[Yr(r)]:m[Yr(r)]}:{})},S=h?.filter(Z=>!zn.includes(Z)),$=n?.filter(Z=>!Mn.includes(Z));if(!i&&!g&&!a&&!(S!=null&&S.length)&&!($!=null&&$.length))return{required:r.length?b:void 0};const V=S?.length&&$?.length||!i,M={chains:[...new Set(V?b.chains.concat(i||[]):i)],methods:[...new Set(b.methods.concat(a!=null&&a.length?a:o_))],events:[...new Set(b.events.concat(g||c_))],rpcMap:m};return{required:r.length?b:void 0,optional:i.length?M:void 0}}class Jn{constructor(){this.events=new Ze.exports.EventEmitter,this.namespace="eip155",this.accounts=[],this.chainId=1,this.STORAGE_KEY=n_,this.on=(r,i)=>(this.events.on(r,i),this),this.once=(r,i)=>(this.events.once(r,i),this),this.removeListener=(r,i)=>(this.events.removeListener(r,i),this),this.off=(r,i)=>(this.events.off(r,i),this),this.parseAccount=r=>this.isCompatibleChainId(r)?this.parseAccountId(r).address:r,this.signer={},this.rpc={}}static async init(r){const i=new Jn;return await i.initialize(r),i}async request(r){return await this.signer.request(r,this.formatChainId(this.chainId))}sendAsync(r,i){this.signer.sendAsync(r,i,this.formatChainId(this.chainId))}get connected(){return this.signer.client?this.signer.client.core.relayer.connected:!1}get connecting(){return this.signer.client?this.signer.client.core.relayer.connecting:!1}async enable(){return this.session||await this.connect(),await this.request({method:"eth_requestAccounts"})}async connect(r){if(!this.signer.client)throw new Error("Provider not initialized. Call init() first");this.loadConnectOpts(r);const{required:i,optional:n}=g_(this.rpc);try{const a=await new Promise(async(g,m)=>{var b;this.rpc.showQrModal&&((b=this.modal)==null||b.subscribeModal(S=>{!S.open&&!this.signer.session&&(this.signer.abortPairingAttempt(),m(new Error("Connection request reset. Please try again.")))})),await this.signer.connect(vu(Bi({namespaces:Bi({},i&&{[this.namespace]:i})},n&&{optionalNamespaces:{[this.namespace]:n}}),{pairingTopic:r?.pairingTopic})).then(S=>{g(S)}).catch(S=>{m(new Error(S.message))})});if(!a)return;this.setChainIds(this.rpc.chains);const h=Nm(a.namespaces,[this.namespace]);this.setAccounts(h),this.events.emit("connect",{chainId:Nn(this.chainId)})}catch(a){throw this.signer.logger.error(a),a}finally{this.modal&&this.modal.closeModal()}}async disconnect(){this.session&&await this.signer.disconnect(),this.reset()}get isWalletConnect(){return!0}get session(){return this.signer.session}registerEventListeners(){this.signer.on("session_event",r=>{const{params:i}=r,{event:n}=i;n.name==="accountsChanged"?(this.accounts=this.parseAccounts(n.data),this.events.emit("accountsChanged",this.accounts)):n.name==="chainChanged"?this.setChainId(this.formatChainId(n.data)):this.events.emit(n.name,n.data),this.events.emit("session_event",r)}),this.signer.on("chainChanged",r=>{const i=parseInt(r);this.chainId=i,this.events.emit("chainChanged",Nn(this.chainId)),this.persist()}),this.signer.on("session_update",r=>{this.events.emit("session_update",r)}),this.signer.on("session_delete",r=>{this.reset(),this.events.emit("session_delete",r),this.events.emit("disconnect",vu(Bi({},Re("USER_DISCONNECTED")),{data:r.topic,name:"USER_DISCONNECTED"}))}),this.signer.on("display_uri",r=>{var i,n;this.rpc.showQrModal&&((i=this.modal)==null||i.closeModal(),(n=this.modal)==null||n.openModal({uri:r})),this.events.emit("display_uri",r)})}switchEthereumChain(r){this.request({method:"wallet_switchEthereumChain",params:[{chainId:r.toString(16)}]})}isCompatibleChainId(r){return typeof r=="string"?r.startsWith(`${this.namespace}:`):!1}formatChainId(r){return`${this.namespace}:${r}`}parseChainId(r){return Number(r.split(":")[1])}setChainIds(r){const i=r.filter(n=>this.isCompatibleChainId(n)).map(n=>this.parseChainId(n));i.length&&(this.chainId=i[0],this.events.emit("chainChanged",Nn(this.chainId)),this.persist())}setChainId(r){if(this.isCompatibleChainId(r)){const i=this.parseChainId(r);this.chainId=i,this.switchEthereumChain(i)}}parseAccountId(r){const[i,n,a]=r.split(":");return{chainId:`${i}:${n}`,address:a}}setAccounts(r){this.accounts=r.filter(i=>this.parseChainId(this.parseAccountId(i).chainId)===this.chainId).map(i=>this.parseAccountId(i).address),this.events.emit("accountsChanged",this.accounts)}getRpcConfig(r){var i,n;const a=(i=r?.chains)!=null?i:[],h=(n=r?.optionalChains)!=null?n:[],g=a.concat(h);if(!g.length)throw new Error("No chains specified in either `chains` or `optionalChains`");const m=a.length?r?.methods||Mn:[],b=a.length?r?.events||zn:[],S=r?.optionalMethods||[],$=r?.optionalEvents||[],V=r?.rpcMap||this.buildRpcMap(g,r.projectId),M=r?.qrModalOptions||void 0;return{chains:a?.map(Z=>this.formatChainId(Z)),optionalChains:h.map(Z=>this.formatChainId(Z)),methods:m,events:b,optionalMethods:S,optionalEvents:$,rpcMap:V,showQrModal:!!(r!=null&&r.showQrModal),qrModalOptions:M,projectId:r.projectId,metadata:r.metadata}}buildRpcMap(r,i){const n={};return r.forEach(a=>{n[a]=this.getRpcUrl(a,i)}),n}async initialize(r){if(this.rpc=this.getRpcConfig(r),this.chainId=this.rpc.chains.length?Yr(this.rpc.chains):Yr(this.rpc.optionalChains),this.signer=await i_.init({projectId:this.rpc.projectId,metadata:this.rpc.metadata,disableProviderPing:r.disableProviderPing,relayUrl:r.relayUrl,storageOptions:r.storageOptions}),this.registerEventListeners(),await this.loadPersistedSession(),this.rpc.showQrModal){let i;try{const{WalletConnectModal:n}=await Om(()=>import("./index.b6c78bfd.js").then(a=>a.i),["assets/index.b6c78bfd.js","assets/index.710421da.js","assets/index.3e595510.css"]);i=n}catch{throw new Error("To use QR modal, please install @walletconnect/modal package")}if(i)try{this.modal=new i(Bi({walletConnectVersion:2,projectId:this.rpc.projectId,standaloneChains:this.rpc.chains},this.rpc.qrModalOptions))}catch(n){throw this.signer.logger.error(n),new Error("Could not generate WalletConnectModal Instance")}}}loadConnectOpts(r){if(!r)return;const{chains:i,optionalChains:n,rpcMap:a}=r;i&&vi(i)&&(this.rpc.chains=i.map(h=>this.formatChainId(h)),i.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)})),n&&vi(n)&&(this.rpc.optionalChains=[],this.rpc.optionalChains=n?.map(h=>this.formatChainId(h)),n.forEach(h=>{this.rpc.rpcMap[h]=a?.[h]||this.getRpcUrl(h)}))}getRpcUrl(r,i){var n;return((n=this.rpc.rpcMap)==null?void 0:n[r])||`${a_}?chainId=eip155:${r}&projectId=${i||this.rpc.projectId}`}async loadPersistedSession(){if(!this.session)return;const r=await this.signer.client.core.storage.getItem(`${this.STORAGE_KEY}/chainId`),i=this.session.namespaces[`${this.namespace}:${r}`]?this.session.namespaces[`${this.namespace}:${r}`]:this.session.namespaces[this.namespace];this.setChainIds(r?[this.formatChainId(r)]:i?.accounts),this.setAccounts(i?.accounts)}reset(){this.chainId=1,this.accounts=[]}persist(){this.session&&this.signer.client.core.storage.setItem(`${this.STORAGE_KEY}/chainId`,this.chainId)}parseAccounts(r){return typeof r=="string"||r instanceof String?[this.parseAccount(r)]:r.map(i=>this.parseAccount(i))}}const v_=Jn;export{v_ as EthereumProvider,c_ as OPTIONAL_EVENTS,o_ as OPTIONAL_METHODS,zn as REQUIRED_EVENTS,Mn as REQUIRED_METHODS,Jn as default};
